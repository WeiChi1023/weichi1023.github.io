(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-83af99f8"],{"0318":function(t,e,r){},"0360":function(t,e,r){t.exports=r.p+"static/img/19.db8a2b71.jpeg"},"0405":function(t,e,r){"use strict";r("6438")},"0a25":function(t,e,r){},"0fc0":function(t,e,r){},1065:function(t,e,r){},"124a":function(t,e,r){"use strict";r("1263")},1263:function(t,e,r){},1311:function(t,e,r){"use strict";r("0fc0")},"144f":function(t,e,r){t.exports=r.p+"static/img/18.9801848a.jpeg"},1756:function(t,e,r){t.exports=r.p+"static/img/20.d7d8f6e6.jpeg"},"19ab":function(t,e,r){!function(e,r){t.exports=r()}(0,(function(){return function(t){function e(a){if(r[a])return r[a].exports;var o=r[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=7)}([function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var r=this[e];r[2]?t.push("@media "+r[2]+"{"+r[1]+"}"):t.push(r[1])}return t.join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},o=0;o<this.length;o++){var n=this[o][0];"number"==typeof n&&(a[n]=!0)}for(o=0;o<e.length;o++){var i=e[o];"number"==typeof i[0]&&a[i[0]]||(r&&!i[2]?i[2]=r:r&&(i[2]="("+i[2]+") and ("+r+")"),t.push(i))}},t}},function(t,e){t.exports=function(t,e,r,a){var o,n=t=t||{},i=typeof t.default;"object"!==i&&"function"!==i||(o=t,n=t.default);var s="function"==typeof n?n.options:n;if(e&&(s.render=e.render,s.staticRenderFns=e.staticRenderFns),r&&(s._scopeId=r),a){var c=Object.create(s.computed||null);Object.keys(a).forEach((function(t){var e=a[t];c[t]=function(){return e}})),s.computed=c}return{esModule:o,exports:n,options:s}}},function(t,e,r){function a(t){for(var e=0;e<t.length;e++){var r=t[e],a=u[r.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](r.parts[o]);for(;o<r.parts.length;o++)a.parts.push(n(r.parts[o]));a.parts.length>r.parts.length&&(a.parts.length=r.parts.length)}else{var i=[];for(o=0;o<r.parts.length;o++)i.push(n(r.parts[o]));u[r.id]={id:r.id,refs:1,parts:i}}}}function o(){var t=document.createElement("style");return t.type="text/css",d.appendChild(t),t}function n(t){var e,r,a=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(a){if(f)return h;a.parentNode.removeChild(a)}if(b){var n=m++;a=p||(p=o()),e=i.bind(null,a,n,!1),r=i.bind(null,a,n,!0)}else a=o(),e=s.bind(null,a),r=function(){a.parentNode.removeChild(a)};return e(t),function(a){if(a){if(a.css===t.css&&a.media===t.media&&a.sourceMap===t.sourceMap)return;e(t=a)}else r()}}function i(t,e,r,a){var o=r?"":a.css;if(t.styleSheet)t.styleSheet.cssText=v(e,o);else{var n=document.createTextNode(o),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(n,i[e]):t.appendChild(n)}}function s(t,e){var r=e.css,a=e.media,o=e.sourceMap;if(a&&t.setAttribute("media",a),o&&(r+="\n/*# sourceURL="+o.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var l=r(19),u={},d=c&&(document.head||document.getElementsByTagName("head")[0]),p=null,m=0,f=!1,h=function(){},b="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,r){f=r;var o=l(t,e);return a(o),function(e){for(var r=[],n=0;n<o.length;n++){var i=o[n],s=u[i.id];s.refs--,r.push(s)}e?(o=l(t,e),a(o)):o=[];for(n=0;n<r.length;n++){s=r[n];if(0===s.refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete u[s.id]}}}};var v=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}()},function(t,e,r){r(17);var a=r(1)(r(4),r(14),"data-v-566a42b8",null);t.exports=a.exports},function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=r(12),n=a(o),i=r(11),s=a(i);e.default={name:"splitPane",components:{Resizer:n.default,Pane:s.default},props:{minPercent:{type:Number,default:10},defaultPercent:{type:Number,default:50},split:{validator:function(t){return["vertical","horizontal"].indexOf(t)>=0},required:!0},className:String},computed:{userSelect:function(){return this.active?"none":""},cursor:function(){return this.active?"vertical"===this.split?"col-resize":"row-resize":""}},watch:{defaultPercent:function(t,e){this.percent=t}},data:function(){return{active:!1,hasMoved:!1,height:null,percent:this.defaultPercent,type:"vertical"===this.split?"width":"height",resizeType:"vertical"===this.split?"left":"top"}},methods:{onClick:function(){this.hasMoved||(this.percent=50,this.$emit("resize",this.percent))},onMouseDown:function(){this.active=!0,this.hasMoved=!1},onMouseUp:function(){this.active=!1},onMouseMove:function(t){if(0!==t.buttons&&0!==t.which||(this.active=!1),this.active){var e=0,r=t.currentTarget;if("vertical"===this.split)for(;r;)e+=r.offsetLeft,r=r.offsetParent;else for(;r;)e+=r.offsetTop,r=r.offsetParent;var a="vertical"===this.split?t.pageX:t.pageY,o="vertical"===this.split?t.currentTarget.offsetWidth:t.currentTarget.offsetHeight,n=Math.floor((a-e)/o*1e4)/100;n>this.minPercent&&n<100-this.minPercent&&(this.percent=n),this.$emit("resize",this.percent),this.hasMoved=!0}}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"Pane",props:{className:String},data:function(){return{classes:[this.$parent.split,this.className].join(" "),percent:50}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{split:{validator:function(t){return["vertical","horizontal"].indexOf(t)>=0},required:!0},className:String},computed:{classes:function(){return["splitter-pane-resizer",this.split,this.className].join(" ")}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r(3),o=function(t){return t&&t.__esModule?t:{default:t}}(a);e.default=o.default,"undefined"!=typeof window&&window.Vue&&window.Vue.component("split-pane",o.default)},function(t,e,r){e=t.exports=r(0)(),e.push([t.i,".splitter-pane-resizer[data-v-212fa2a4]{box-sizing:border-box;background:#000;position:absolute;opacity:.2;z-index:1;background-clip:padding-box}.splitter-pane-resizer.horizontal[data-v-212fa2a4]{height:11px;margin:-5px 0;border-top:5px solid hsla(0,0%,100%,0);border-bottom:5px solid hsla(0,0%,100%,0);cursor:row-resize;width:100%}.splitter-pane-resizer.vertical[data-v-212fa2a4]{width:11px;height:100%;margin-left:-5px;border-left:5px solid hsla(0,0%,100%,0);border-right:5px solid hsla(0,0%,100%,0);cursor:col-resize}",""])},function(t,e,r){e=t.exports=r(0)(),e.push([t.i,'.clearfix[data-v-566a42b8]:after{visibility:hidden;display:block;font-size:0;content:" ";clear:both;height:0}.vue-splitter-container[data-v-566a42b8]{height:100%;position:relative}.vue-splitter-container-mask[data-v-566a42b8]{z-index:9999;width:100%;height:100%;position:absolute;top:0;left:0}',""])},function(t,e,r){e=t.exports=r(0)(),e.push([t.i,".splitter-pane.vertical.splitter-paneL[data-v-815c801c]{position:absolute;left:0;height:100%;padding-right:3px}.splitter-pane.vertical.splitter-paneR[data-v-815c801c]{position:absolute;right:0;height:100%;padding-left:3px}.splitter-pane.horizontal.splitter-paneL[data-v-815c801c]{position:absolute;top:0;width:100%}.splitter-pane.horizontal.splitter-paneR[data-v-815c801c]{position:absolute;bottom:0;width:100%;padding-top:3px}",""])},function(t,e,r){r(18);var a=r(1)(r(5),r(15),"data-v-815c801c",null);t.exports=a.exports},function(t,e,r){r(16);var a=r(1)(r(6),r(13),"data-v-212fa2a4",null);t.exports=a.exports},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{class:t.classes})},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t,e,r,a=this,o=a.$createElement,n=a._self._c||o;return n("div",{staticClass:"vue-splitter-container clearfix",style:{cursor:a.cursor,userSelect:a.userSelect},on:{mouseup:a.onMouseUp,mousemove:a.onMouseMove}},[n("pane",{staticClass:"splitter-pane splitter-paneL",style:(t={},t[a.type]=a.percent+"%",t),attrs:{split:a.split}},[a._t("paneL")],2),a._v(" "),n("resizer",{style:(e={},e[a.resizeType]=a.percent+"%",e),attrs:{className:a.className,split:a.split},nativeOn:{mousedown:function(t){return a.onMouseDown(t)},click:function(t){return a.onClick(t)}}}),a._v(" "),n("pane",{staticClass:"splitter-pane splitter-paneR",style:(r={},r[a.type]=100-a.percent+"%",r),attrs:{split:a.split}},[a._t("paneR")],2),a._v(" "),a.active?n("div",{staticClass:"vue-splitter-container-mask"}):a._e()],1)},staticRenderFns:[]}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{class:t.classes},[t._t("default")],2)},staticRenderFns:[]}},function(t,e,r){var a=r(8);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals),r(2)("a82a4610",a,!0)},function(t,e,r){var a=r(9);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals),r(2)("033d59ad",a,!0)},function(t,e,r){var a=r(10);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals),r(2)("6816c93c",a,!0)},function(t,e){t.exports=function(t,e){for(var r=[],a={},o=0;o<e.length;o++){var n=e[o],i=n[0],s=n[1],c=n[2],l=n[3],u={id:t+":"+o,css:s,media:c,sourceMap:l};a[i]?a[i].parts.push(u):r.push(a[i]={id:i,parts:[u]})}return r}}])}))},"1bd5":function(t,e,r){t.exports=r.p+"static/img/22.1a26d6c3.jpeg"},"1f78":function(t,e,r){t.exports=r.p+"static/img/15.9e17b96b.jpeg"},"293e":function(t,e,r){"use strict";r("aa2c")},"2aed":function(t,e,r){"use strict";r("de40")},3045:function(t,e,r){t.exports=r.p+"static/img/foodpanda.6979fc67.png"},"313a":function(t,e,r){t.exports=r.p+"static/img/23.4916215a.jpeg"},3314:function(t,e,r){t.exports=r.p+"static/img/dinersclub.c46530f7.png"},"331c":function(t,e,r){t.exports=r.p+"static/img/9.2cc83057.jpeg"},"36bd":function(t,e,r){"use strict";var a=r("4bf8"),o=r("77f1"),n=r("9def");t.exports=function(t){var e=a(this),r=n(e.length),i=arguments.length,s=o(i>1?arguments[1]:void 0,r),c=i>2?arguments[2]:void 0,l=void 0===c?r:o(c,r);while(l>s)e[s++]=t;return e}},3817:function(t,e,r){"use strict";r("4478")},"386b5":function(t,e,r){var a=r("5ca1"),o=r("79e5"),n=r("be13"),i=/"/g,s=function(t,e,r,a){var o=String(n(t)),s="<"+e;return""!==r&&(s+=" "+r+'="'+String(a).replace(i,"&quot;")+'"'),s+">"+o+"</"+e+">"};t.exports=function(t,e){var r={};r[t]=e(s),a(a.P+a.F*o((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",r)}},"386d":function(t,e,r){"use strict";var a=r("cb7c"),o=r("83a1"),n=r("5f1b");r("214f")("search",1,(function(t,e,r,i){return[function(r){var a=t(this),o=void 0==r?void 0:r[e];return void 0!==o?o.call(r,a):new RegExp(r)[e](String(a))},function(t){var e=i(r,t,this);if(e.done)return e.value;var s=a(t),c=String(this),l=s.lastIndex;o(l,0)||(s.lastIndex=0);var u=n(s,c);return o(s.lastIndex,l)||(s.lastIndex=l),null===u?-1:u.index}]}))},4095:function(t,e,r){t.exports=r.p+"static/img/mastercard.cdaba15c.png"},"41bd":function(t,e,r){"use strict";r("fea4")},"41fa":function(t,e,r){},4226:function(t,e,r){t.exports=r.p+"static/img/discover.62706277.png"},"43b7":function(t,e,r){t.exports=r.p+"static/img/unionpay.40ead9ad.png"},4478:function(t,e,r){},4678:function(t,e,r){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"73332","./en-il.js":"73332","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df48","./fa.js":"8df48","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b46","./gd.js":"f6b46","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"64030","./ms-my.js":"64030","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e9","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e9","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function o(t){var e=n(t);return r(e)}function n(t){var e=a[t];if(!(e+1)){var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}return e}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="4678"},"469f":function(t,e,r){r("6c1c"),r("1654"),t.exports=r("7d7b")},4917:function(t,e,r){"use strict";var a=r("cb7c"),o=r("9def"),n=r("0390"),i=r("5f1b");r("214f")("match",1,(function(t,e,r,s){return[function(r){var a=t(this),o=void 0==r?void 0:r[e];return void 0!==o?o.call(r,a):new RegExp(r)[e](String(a))},function(t){var e=s(r,t,this);if(e.done)return e.value;var c=a(t),l=String(this);if(!c.global)return i(c,l);var u=c.unicode;c.lastIndex=0;var d,p=[],m=0;while(null!==(d=i(c,l))){var f=String(d[0]);p[m]=f,""===f&&(c.lastIndex=n(l,o(c.lastIndex),u)),m++}return 0===m?null:p}]}))},"4ac3":function(t,e,r){"use strict";r("0318")},"4b81":function(t,e,r){t.exports=r.p+"static/img/chip.2c37b1d3.png"},"504c":function(t,e,r){var a=r("9e1e"),o=r("0d58"),n=r("6821"),i=r("52a7").f;t.exports=function(t){return function(e){var r,s=n(e),c=o(s),l=c.length,u=0,d=[];while(l>u)r=c[u++],a&&!i.call(s,r)||d.push(t?[r,s[r]]:s[r]);return d}}},"565a":function(t,e,r){t.exports=r.p+"static/img/24.2555dbb5.jpeg"},"5a22":function(t,e,r){},"5d73":function(t,e,r){t.exports=r("469f")},"630a":function(t,e,r){t.exports=r.p+"static/img/3.96fa375f.jpeg"},"634b":function(t,e,r){t.exports=r.p+"static/img/6.c55f380c.jpeg"},6438:function(t,e,r){},"69fb":function(t,e,r){t.exports=r.p+"static/img/5.c5d4f6f5.jpeg"},"6c7b":function(t,e,r){var a=r("5ca1");a(a.P,"Array",{fill:r("36bd")}),r("9c6c")("fill")},"6d14":function(t,e,r){t.exports=r.p+"static/img/11.7347d170.jpeg"},7514:function(t,e,r){"use strict";var a=r("5ca1"),o=r("0a49")(5),n="find",i=!0;n in[]&&Array(1)[n]((function(){i=!1})),a(a.P+a.F*i,"Array",{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),r("9c6c")(n)},"7b0a":function(t,e,r){"use strict";r.d(e,"h",(function(){return a})),r.d(e,"i",(function(){return o})),r.d(e,"d",(function(){return n})),r.d(e,"f",(function(){return i})),r.d(e,"g",(function(){return s})),r.d(e,"e",(function(){return l})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return d})),r.d(e,"a",(function(){return m})),r.d(e,"j",(function(){return f})),r.d(e,"k",(function(){return h}));r("28a5"),r("3b2b"),r("6b54");function a(t){var e=[1,2,1,2,1,2,4,1];try{var r=t.toString(),a=new RegExp(/^\d{8}$/);if(!a.test(r))throw new Error("統一編號需要8碼");var o=e.reduce((function(t,e,a){var o=e*parseInt(r.charAt(a),10);return t+o%10+Math.floor(o/10)}),0);return o%10===0||7===parseInt(r.charAt(6),10)&&(o+1)%10===0}catch(n){return console.error(n.message),!1}}function o(t){try{if("string"!==typeof t)throw new Error("Input type should be string.");var e=new RegExp(/^[A-Z][1,2]\d{8}$/);if(!e.test(t))throw new Error("National identification number format incorrect.");return c(t)}catch(r){return console.error(r.message),!1}}function n(t){try{if("string"!==typeof t)throw new Error("Input type should be string.");var e=t.toString(),r=new RegExp(/^[A-Z]{2}\d{14}$/);if(!r.test(e))throw new Error("Citizen digital certificate format incorrect.");return!0}catch(a){return console.error(a.message),!1}}function i(t){try{if("string"!==typeof t)throw new Error("Input type should be string.");var e=t.toString(),r=new RegExp(/^\/[\dA-Z.\-+]{7}$/);if(!r.test(e))throw new Error("E-Invoice cell phone barcode format incorrect.");return!0}catch(a){return console.error(a.message),!1}}function s(t){try{if("string"!==typeof t)throw new Error("Input type should be string.");var e=t.toString(),r=new RegExp(/^[\d]{3,7}$/);if(!r.test(e))throw new Error("E-Invoice donate code format incorrect.");return!0}catch(a){return console.error(a.message),!1}}function c(t){var e=t.split(""),r=10,a=[1,10,19,28,37,46,55,64,39,73,82,2,11,20,48,29,38,47,56,65,74,83,21,3,12,30],o=["0","1","2","3","4","5","6","7","4","8","9","0","1","2","5","3","4","5","6","7","8","9","2","0","1","3"];isNaN(parseInt(e[1],r))&&(e[1]=o[t.charCodeAt(1)-"A".charCodeAt(0)]);var n=e.reduce((function(t,o,n){return 0===n?t+a[e[0].charCodeAt(0)-"A".charCodeAt(0)]:9===n?t+parseInt(e[9],r):t+parseInt(e[n],r)*(9-n)}),0);return n%10===0}function l(t){try{var e=t.toString(),r=new RegExp(/^\d{8}$/),a=new RegExp(/^2990\d{9}$/),o=new RegExp(/^2990\d{8}$/);if(a.test(e)||o.test(e)){if(a.test(e)){var n=p(e),i=t.toString().split("");if(n!==1*i[i.length-1])throw new Error("13碼卡號驗證錯誤")}}else if(!r.test(e))throw new Error("卡號格式輸入錯誤，需8、12、13碼");return!0}catch(s){return console.error(s.message),!1}}function u(t){var e=4,r=new RegExp(/^\d{8}$/),a=new RegExp(/^2990\d{9}$/),o=new RegExp(/^2990\d{8}$/),n=new RegExp(/^[A-Z][1,2]\d{8}$/),i=new RegExp(/^09\d{2}-?\d{3}-?\d{3}$/),s=new RegExp(/(\d{2,3}|\d{2,3}-?|\(\d{2,3}\))\d{3,4}\d{4}/);return r.test(t)||a.test(t)||o.test(t)?e=1:n.test(t)?e=2:i.test(t)?e=3:s.test(t)&&(e=4),e}function d(t){var e="0";return 8==t.length&&(t="2990"+t),e=t+p(t).toString(),e}function p(t){var e=t.toString().split(""),r=0,a=0,o=0;return e.every((function(t,e,o){return 12!==e&&(e%2===0?r+=1*t:a+=1*t,!0)})),o=(r+3*a).toString(),o=1*o.charAt(o.length-1),0===o?o:10-o}function m(t){var e=!1,r=/^[0-9]*[1-9][0-9]*$/;return e=r.test(t),e}function f(t){var e=/^[0-9\s]*$/;return e.test(t)}function h(t){if(16!==t.length)return!1;var e,r=0,a=!1,o=t.length-1;while(o>=0)e=parseInt(t.charAt(o),10),a&&(e*=2,e>9&&(e=e%10+1)),a=!a,r+=e,o--;return r%10===0}},"7d7b":function(t,e,r){var a=r("e4ae"),o=r("7cd6");t.exports=r("584a").getIterator=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return a(e.call(t))}},"7def":function(t,e,r){"use strict";r("41fa")},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"8a99":function(t,e,r){t.exports=r.p+"static/img/7.87daa240.jpeg"},"8ed5":function(t,e,r){"use strict";r("1065")},"960d":function(t,e,r){t.exports=r.p+"static/img/17.625d9dfd.jpeg"},"97a2":function(t,e,r){var a={"./1.jpeg":"eaf7","./10.jpeg":"efa8","./11.jpeg":"6d14","./12.jpeg":"f04b","./13.jpeg":"b3bc","./14.jpeg":"f70b","./15.jpeg":"1f78","./16.jpeg":"c2f1","./17.jpeg":"960d","./18.jpeg":"144f","./19.jpeg":"0360","./2.jpeg":"ba04","./20.jpeg":"1756","./21.jpeg":"99b5","./22.jpeg":"1bd5","./23.jpeg":"313a","./24.jpeg":"565a","./25.jpeg":"df52","./3.jpeg":"630a","./4.jpeg":"de35","./5.jpeg":"69fb","./6.jpeg":"634b","./7.jpeg":"8a99","./8.jpeg":"f67c","./9.jpeg":"331c"};function o(t){var e=n(t);return r(e)}function n(t){var e=a[t];if(!(e+1)){var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}return e}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="97a2"},"99b5":function(t,e,r){t.exports=r.p+"static/img/21.cd0636da.jpeg"},a350:function(t,e,r){t.exports=r.p+"static/img/troy.70cc58fa.png"},a6ba:function(t,e,r){t.exports=r.p+"static/img/jcb.87087e5e.png"},aa2c:function(t,e,r){},aada:function(t,e,r){"use strict";r("0a25")},b3bc:function(t,e,r){t.exports=r.p+"static/img/13.d8d7c0e5.jpeg"},b54a:function(t,e,r){"use strict";r("386b5")("link",(function(t){return function(e){return t(this,"a","href",e)}}))},b579:function(t,e,r){t.exports=r.p+"static/img/035-warranty.d4db143b.png"},b615:function(t,e,r){"use strict";r("5a22")},b656:function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"g",(function(){return i})),r.d(e,"a",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return u})),r.d(e,"b",(function(){return d})),r.d(e,"h",(function(){return p}));var a=r("b775"),o=r("7b0f");function n(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction/dailyAccount/".concat(t),method:"get"})}function i(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction",method:"post",headers:{"Content-Type":"application/json"},data:t})}function s(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction/void/reason",method:"post",headers:{"Content-Type":"application/json"},data:t})}function c(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction/so",method:"post",headers:{"Content-Type":"application/json"},data:t})}function l(){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction/so",method:"get",headers:{"Content-Type":"application/json"}})}function u(t,e,r){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/transaction/so/reprint/".concat(t,"/").concat(e),method:"post",headers:{"Content-Type":"application/json"},data:r})}function d(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/repair/".concat(t),method:"get"})}function p(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/status/printer/testprint",method:"post",headers:{"Content-Type":"application/json"},data:t})}},ba04:function(t,e,r){t.exports=r.p+"static/img/2.0a55c9d5.jpeg"},be95:function(t,e,r){t.exports=r.p+"static/img/visa.2bc1a543.png"},c2f1:function(t,e,r){t.exports=r.p+"static/img/16.eef3dd17.jpeg"},c470:function(t,e,r){var a={"./amex.png":"c972","./chip.png":"4b81","./dinersclub.png":"3314","./discover.png":"4226","./jcb.png":"a6ba","./mastercard.png":"4095","./troy.png":"a350","./unionpay.png":"43b7","./visa.png":"be95"};function o(t){var e=n(t);return r(e)}function n(t){var e=a[t];if(!(e+1)){var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}return e}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="c470"},c4c8:function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return i})),r.d(e,"d",(function(){return s})),r.d(e,"c",(function(){return c}));var a=r("b775"),o=r("7b0f");function n(t,e){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/product/promotion/".concat(t).concat(e),method:"get"})}function i(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/product/".concat(t),method:"get"})}function s(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/product/checkSeq",method:"post",headers:{"Content-Type":"application/json"},data:t})}function c(t){return Object(a["a"])({baseURL:Object(o["a"])(),url:"/mPOS/installment/product/".concat(t),method:"get"})}},c593:function(t,e,r){"use strict";r("c9e0")},c972:function(t,e,r){t.exports=r.p+"static/img/amex.d06ee9b4.png"},c9e0:function(t,e,r){},d417:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Tabs",{ref:"Tabs"})},o=[],n=r("db72"),i=r("2f62"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tab-container"},[a("el-tabs",{ref:"eltabs",style:{height:t.tab_size.height+"px"},attrs:{type:"border-card"},model:{value:t.pos_tab,callback:function(e){t.pos_tab=e},expression:"pos_tab"}},t._l(t.tabMapOptions,(function(e){return a("el-tab-pane",{key:e.key,attrs:{name:e.key}},["FoodPanda"===e.label?a("span",{attrs:{slot:"label"},slot:"label"},[a("img",{staticStyle:{height:"1em"},attrs:{slot:"label",src:r("3045")},slot:"label"}),t._v("\n        "+t._s(e.label)+"\n      ")]):a("span",{attrs:{slot:"label"},slot:"label"},[t._v(t._s(e.label))]),t._v(" "),a("keep-alive",[t.pos_tab==e.key?a(e.content,{tag:"component",staticStyle:{"overflow-y":"auto","overflow-x":"hidden"},style:{height:t.tab_size.height+"px"},attrs:{type:e.key}}):t._e()],1)],1)})),1)],1)},c=[],l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("PosSplitPane",{ref:"paneContainer",attrs:{resize:t.resize,"left-percent":t.leftPercent},scopedSlots:t._u([{key:"Top",fn:function(){return[r("TopPane",{attrs:{"pane-data":t.topPaneData}})]},proxy:!0},{key:"Left",fn:function(){return[r("LeftPane",{attrs:{"left-pane-size":t.leftPaneSize.height,"toggle-goods-drawer":t.toggleGoodsDrawer,"handle-delete":t.handleDelete,promote:t.promote,"data-count":t.shopCart.items.length,"pos-type":t.pos_tab,"clear-product-and-promotion":t.clearProductAndPromotion,"shop-cart":t.shopCart}})]},proxy:!0},{key:"Right",fn:function(){return[r("RightPane",{attrs:{"pane-data":t.rightPaneData},on:{update:t.updateSize}})]},proxy:!0},{key:"Bottom",fn:function(){return[r("BottomPane",{attrs:{"pane-data":t.bottomPaneData}})]},proxy:!0}])}),t._v(" "),r("CheckoutDrawer",{attrs:{"show-drawer":t.showCheckoutDrawer,"open-promotion":t.openPromotion,"shop-cart":t.shopCart,"pos-type":t.pos_tab},on:{"update:showDrawer":function(e){t.showCheckoutDrawer=e},"update:show-drawer":function(e){t.showCheckoutDrawer=e}}}),t._v(" "),r("MemberDialog",{attrs:{"member-info":t.memberInfo,"show-dialog":t.showMemberDialog},on:{"update:memberInfo":function(e){t.memberInfo=e},"update:member-info":function(e){t.memberInfo=e},"update:showDialog":function(e){t.showMemberDialog=e},"update:show-dialog":function(e){t.showMemberDialog=e}}}),t._v(" "),r("AddGoodsDrawer",{attrs:{pid:t.pid,"show-drawer":t.showAddGoodsDrawer,"add-goods":t.addGoods,promote:t.promote},on:{"update:pid":function(e){t.pid=e},"update:showDrawer":function(e){t.showAddGoodsDrawer=e},"update:show-drawer":function(e){t.showAddGoodsDrawer=e}}}),t._v(" "),r("Installment",{attrs:{"pay-info":t.payInfo,"show-dialog":t.showPayOptionDialog,"update-pay-info":t.updatePayInfo},on:{"update:payInfo":function(e){t.payInfo=e},"update:pay-info":function(e){t.payInfo=e},"update:showDialog":function(e){t.showPayOptionDialog=e},"update:show-dialog":function(e){t.showPayOptionDialog=e}}}),t._v(" "),r("MenuDrawer",{attrs:{"show-drawer":t.showMenuDrawer,products:t.ff_menu_products,menukey:t.ff_menu_key,"add-goods":t.addGoods},on:{"update:showDrawer":function(e){t.showMenuDrawer=e},"update:show-drawer":function(e){t.showMenuDrawer=e},"update:products":function(e){t.ff_menu_products=e},"update:menukey":function(e){t.ff_menu_key=e}}}),t._v(" "),r("PromotionDrawer",{attrs:{"show-drawer":t.showPromotionDrawer,products:t.promotionProducts,"promotion-info":t.typeFpromotionInfo,"add-goods":t.addGoods,"add-promote":t.addPromote,"checkout-launch":t.checkoutLaunch,"clear-promotion-option":t.clearPromotionOption,"clear-product-and-promotion":t.clearProductAndPromotion,"call-back":function(){t.showCheckoutDrawer=!0}},on:{"update:showDrawer":function(e){t.showPromotionDrawer=e},"update:show-drawer":function(e){t.showPromotionDrawer=e},"update:products":function(e){t.promotionProducts=e}}}),t._v(" "),r("PromoteDialog",{attrs:{"dialog-visible":t.promoteDialogVisible,"promotion-info":t.promotionInfo,"add-goods":t.addGoods,"add-promote":t.addPromote,"checkout-launch":t.checkoutLaunch},on:{"update:dialogVisible":function(e){t.promoteDialogVisible=e},"update:dialog-visible":function(e){t.promoteDialogVisible=e},"update:checkoutLaunch":function(e){t.checkoutLaunch=e},"update:checkout-launch":function(e){t.checkoutLaunch=e}}}),t._v(" "),r("VATDialog",{attrs:{"dialog-visible":t.showVATDialog},on:{"update:dialogVisible":function(e){t.showVATDialog=e},"update:dialog-visible":function(e){t.showVATDialog=e}}}),t._v(" "),r("salerDialog",{attrs:{"dialog-visible":t.showSalerDialog},on:{"update:dialogVisible":function(e){t.showSalerDialog=e},"update:dialog-visible":function(e){t.showSalerDialog=e}}}),t._v(" "),r("PaymentRefund",{attrs:{"dialog-visible":t.showPaymentRefundDialog},on:{"update:dialogVisible":function(e){t.showPaymentRefundDialog=e},"update:dialog-visible":function(e){t.showPaymentRefundDialog=e}}})],1)},u=[],d=(r("5df3"),r("7514"),r("a745")),p=r.n(d);function m(t){if(p()(t))return t}var f=r("5d73"),h=r.n(f),b=r("c8bb"),v=r.n(b);function y(t,e){if(v()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],a=!0,o=!1,n=void 0;try{for(var i,s=h()(t);!(a=(i=s.next()).done);a=!0)if(r.push(i.value),e&&r.length===e)break}catch(c){o=!0,n=c}finally{try{a||null==s["return"]||s["return"]()}finally{if(o)throw n}}return r}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function w(t,e){return m(t)||y(t,e)||g()}r("ffc1"),r("b54a"),r("ac6a"),r("a481"),r("7f7f");var _=r("b775"),k=r("7b0f");function N(){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/ff",method:"get"})}var C=r("c4c8"),D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"會員查詢",visible:t.showDialog,"before-close":t.beforeClose},on:{"update:visible":function(e){t.showDialog=e}}},[r("div",{attrs:{slot:"title"},slot:"title"},[r("span",{staticClass:"el-dialog__title"},[t._v("會員查詢")])]),t._v(" "),""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error"},on:{close:function(){return t.errorMsg=""}}}):t._e(),t._v(" "),r("el-card",{directives:[{name:"show",rawName:"v-show",value:0==t.memberInfo.status&&0===t.cardList.length||!0===t.updateCheck,expression:"(memberInfo.status == false && cardList.length === 0)||(updateCheck===true)"}],staticClass:"box-card"},[r("el-form",{ref:"inputForm1",attrs:{"label-position":"left"}},[r("el-form-item",[r("el-input",{ref:"ipt",staticStyle:{width:"65%"},attrs:{inputmode:"numeric"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submitMember(e))}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),t._v(" "),r("el-button",{staticStyle:{width:"33%"},attrs:{type:"danger"},on:{click:t.clearInput}},[t._v("清除")])],1),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submitMember}},[t._v("確定")])],1)],1)],1),t._v(" "),t.cardList.length>0?r("el-card",{staticClass:"box-card"},[r("el-form",{ref:"inputForm2",attrs:{"label-position":"left"}},[r("el-form-item",[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"未選擇"},model:{value:t.selectValue,callback:function(e){t.selectValue=e},expression:"selectValue"}},t._l(t.cardList,(function(t,e){return r("el-option",{key:t.CustNo,attrs:{label:t.CustNo,value:e}})})),1)],1),t._v(" "),null!==t.selectValue?r("div",[r("el-form-item",{attrs:{label:"姓名:"}},[t._v(t._s(t.cardList[t.selectValue].CustName))]),t._v(" "),r("el-form-item",{attrs:{label:"EndDate:"}},[t._v(t._s(t.cardList[t.selectValue].EndDate))]),t._v(" "),r("el-form-item",{attrs:{label:"手機號碼:"}},[t._v(t._s(t.cardList[t.selectValue].MobileNo))]),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.selectCard}},[t._v("確定")])],1)],1):t._e()],1)],1):t._e(),t._v(" "),1==t.memberInfo.status?r("el-card",{staticClass:"box-card"},["offline"===t.status?r("el-alert",{attrs:{title:"離線查詢",type:"warning",effect:"dark",center:"","show-icon":"",closable:!1}}):t._e(),t._v(" "),r("el-form",{ref:"memberInfo",attrs:{"label-position":"left"}},[r("el-form-item",{attrs:{label:"會員ID:"}},[t._v(t._s(t.memberInfo.CustNo))]),t._v(" "),r("el-form-item",{attrs:{label:"會員姓名:"}},[t._v(t._s(t.memberInfo.CustName))]),t._v(" "),r("el-form-item",{attrs:{label:"手機號碼:"}},[t._v(t._s(t.memberInfo.MobileNo))]),t._v(" "),r("el-form-item",{attrs:{label:"還元金:"}},[t._v(t._s(t.memberInfo.UnuseAmt))]),t._v(" "),r("el-form-item",["DLV_ACC"!==t.opFuncSub?r("el-button",{staticStyle:{width:"100%"},attrs:{type:"danger"},on:{click:t.clearMember}},[t._v("清除會員資料")]):r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.updateMember}},[t._v("更換會員")])],1)],1)],1):t._e()],1)},I=[],P=(r("6b54"),r("96cf"),r("3b8d")),O=r("d225"),x=r("b0b4"),j=r("4360");function S(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/member",method:"post",data:t})}function T(t){return Object(_["a"])({url:"/vue-element-admin/member/city",method:"get"})}var $=r("7b0a"),A=r("4328"),M=r.n(A),F=function(){function t(){Object(O["a"])(this,t)}return Object(x["a"])(t,null,[{key:"Login",value:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(e){var r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var a=r.InputValid(e),o=[],n="";""===a.errorMsg&&S(M.a.stringify({queryType:a.inputType,queryData:a.input})).then((function(e){if(e.length>0){if(o=e,n="online",1===o.length){if(o[0].isMember=!0,o[0].valid=!0,1!==a.inputType)return r.Login(o[0].CustNo);"DLV_ACC"!==j["a"].state.pos.opFuncSub?j["a"].dispatch("member/memberLogin",o[0]):j["a"].dispatch("member/memberUpdate",o[0]),o=[]}}else r.offline(a.input),n="offline";t({status:n,cardList:o,errorMsg:a.errorMsg})})).catch((function(e){console.error(e),Object($["e"])(a.input)&&(r.offline(a.input),n="offline"),t({status:n,cardList:o,errorMsg:a.errorMsg})}))})));case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"Logout",value:function(){j["a"].dispatch("member/memberLogout")}},{key:"InputValid",value:function(t){var e=Object($["b"])(t),r="";switch(e){case 1:Object($["e"])(t)?t.length<13&&(t=Object($["c"])(t)):r="會員卡號輸入錯誤";break;case 2:Object($["i"])(t)||(r="身分證輸入錯誤");break;case 3:case 4:break;default:r="輸入格式錯誤";break}return{input:t,inputType:e,errorMsg:r}}},{key:"offline",value:function(t){var e={CustNo:t,CustName:"",EndDate:"",MobileNo:"",UnuseAmt:"",status:!0,level:"01"};"DLV_ACC"!==j["a"].state.pos.opFuncSub?j["a"].dispatch("member/memberLogin",e):j["a"].dispatch("member/memberUpdate",e)}}]),t}(),E={name:"MemberDialog",props:{showDialog:{type:Boolean,required:!1}},data:function(){return{cardList:[],selectValue:null,input:"",errorMsg:"",status:"",valid:!1,onCamera:!1,camera:"auto",error:"",updateCheck:!1}},computed:Object(n["a"])({},Object(i["c"])({memberInfo:function(t){return t.member},order:function(t){return t.order}}),{},Object(i["b"])(["opFuncSub"])),watch:{input:function(t){this.input=t.toUpperCase()}},created:function(){},updated:function(){this.$nextTick((function(){this.showDialog&&this.$refs.ipt.focus()}))},methods:{submitMember:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.input.indexOf("LEAD=[")>-1&&this.onDecode(),this.order.salesOrder.items.length>0&&"DLV_ACC"!==this.opFuncSub?this.$confirm("此操作將清空商品,是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){e.memberLogin()})).catch((function(){e.$message({type:"info",message:"已取消登入會員"})})):this.memberLogin();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),memberLogin:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,F.Login(this.input);case 2:e=t.sent,this.errorMsg=e.errorMsg,this.status=e.status,this.cardList=e.cardList;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),selectCard:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.cardList[this.selectValue].status=!0,this.input=this.cardList[this.selectValue].CustNo,this.memberLogin();case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),clearMember:function(){F.Logout(),this.$emit("update:showDialog",!1),Object.assign(this.$data,this.$options.data())},updateMember:function(){this.updateCheck=!0},beforeClose:function(){this.onCamera=!1,this.error="",this.$emit("update:showDialog",!1)},clearInput:function(){this.input="",this.camera="auto",this.$refs.ipt.focus()},onDecode:function(t){var e=JSON.parse('{"'.concat(this.input.toString().replaceAll("=[",'":"').replaceAll("]",'"').replaceAll(",",',"'),"}"));void 0!==e.CUSTID?this.input=e.CUSTID:this.input=""},onInit:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),"NotAllowedError"===t.t0.name?this.error="ERROR: you need to grant camera access permisson":"NotFoundError"===t.t0.name?this.error="ERROR: no camera on this device":"NotSupportedError"===t.t0.name?this.error="ERROR: secure context required (HTTPS, localhost)":"NotReadableError"===t.t0.name?this.error="ERROR: is the camera already in use?":"OverconstrainedError"===t.t0.name?this.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===t.t0.name?this.error="ERROR: Stream API is not supported in this browser":this.error="ERROR: ".concat(t.t0.name);case 8:case"end":return t.stop()}}),t,this,[[0,5]])})));function e(e){return t.apply(this,arguments)}return e}()}},L=E,q=r("2877"),V=Object(q["a"])(L,D,I,!1,null,null,null),R=V.exports,z=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-drawer",{attrs:{title:"",visible:t.showDrawer,direction:"btt","before-close":t.drawerHandleClose,size:"100%",height:"200px"},on:{"update:visible":function(e){t.showDrawer=e}}},[r("div",{staticClass:"checkout-card"},[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("div",{staticClass:"text item"},[r("h3",[t._v("應收金額: "+t._s(t.payableAmt))])])]),t._v(" "),r("div",{staticStyle:{height:"180px",overflow:"auto"}},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""},on:{close:t.alertClose}}):t._e(),t._v(" "),t._l(t.payInfo.data,(function(e,a){return r("div",{key:a,staticClass:"text item"},[r("h3",[t._v(t._s(e.name)+": "+t._s(e.amount)+"\n              "),"creditCard"!==e.type&&"ecPaymentAmt"!==e.type&&"pointsAmt"!==e.type?r("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.remove(a)}}}):t._e()],1)])}))],2),t._v(" "),r("el-divider"),t._v(" "),t.remainAmt>=0?r("div",{staticClass:"text item"},[r("h2",[t._v("剩餘金額: "+t._s(t.remainAmt))]),t._v(" "),r("el-divider")],1):r("div",{staticClass:"text item"},[r("h2",[t._v("剩餘金額: 0     找零: "+t._s(Math.abs(t.remainAmt)))]),t._v(" "),r("el-divider"),t._v(" "),r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning"},on:{click:function(e){return t.giveChange()}}},[t._v("找零")])],1)],1)],1),t._v(" "),r("div",{staticClass:"checkout-card"},[r("el-card",[r("el-form",{ref:"form",attrs:{model:t.form}},t._l(t.formData,(function(e){return r("el-form-item",{key:e.label},[r("el-button-group",t._l(e.item,(function(e){return r("el-button",t._g({directives:[{name:"show",rawName:"v-show",value:e.visible||t.checkInstall,expression:"btn.visible || checkInstall"}],key:e.name,attrs:{type:"primary"},model:{value:t.payInfo.info.installmentNumber,callback:function(e){t.$set(t.payInfo.info,"installmentNumber",e)},expression:"payInfo.info.installmentNumber"}},null!=e.event?{click:e.event}:{}),[t._v(t._s(e.name))])})),1),t._v(" "),r("el-divider")],1)})),1),t._v(" "),"service"!==t.pos_tab&&"DLV_ACC"!==t.opFuncSub?r("el-button",{staticStyle:{width:"100%"},attrs:{type:"danger"},on:{click:function(e){return t.toggleTransSoDrawer()}}},[t._v("轉櫃台結帳")]):t._e()],1)],1)]),t._v(" "),r("ticketDialog",{attrs:{"ticket-info":t.ticketInfo,"dialog-visible":t.dialog.showTicketDialog,"add-pay-info":t.addPayInfo},on:{"update:dialogVisible":function(e){return t.$set(t.dialog,"showTicketDialog",e)},"update:dialog-visible":function(e){return t.$set(t.dialog,"showTicketDialog",e)}}}),t._v(" "),r("invoiceDialog",{attrs:{"dialog-visible":t.dialog.showInvoiceDialog,"clear-pay-info":t.clearPayInfo,"pay-data":t.payInfo.data,"shop-cart":t.shopCart},on:{"update:dialogVisible":function(e){return t.$set(t.dialog,"showInvoiceDialog",e)},"update:dialog-visible":function(e){return t.$set(t.dialog,"showInvoiceDialog",e)}}}),t._v(" "),r("paybackDialog",{attrs:{"dialog-visible":t.dialog.showPaybackDialog,"add-pay-info":t.addPayInfo,"order-amt":t.calcAmount(t.memberInfo.status,t.shopCart.items)},on:{"update:dialogVisible":function(e){return t.$set(t.dialog,"showPaybackDialog",e)},"update:dialog-visible":function(e){return t.$set(t.dialog,"showPaybackDialog",e)}}}),t._v(" "),r("paymentInputDialog",{attrs:{"pay-type":t.dialog.inputType,"dialog-visible":t.dialog.showInputDialog,"add-pay-info":t.addPayInfo,amount:t.remainAmt},on:{"update:dialogVisible":function(e){return t.$set(t.dialog,"showInputDialog",e)},"update:dialog-visible":function(e){return t.$set(t.dialog,"showInputDialog",e)}}}),t._v(" "),r("creditCard",{attrs:{"dialog-visible":t.dialog.showCreditCardDialog,"pay-info":t.payInfo,"add-pay-info":t.addPayInfo,amount:t.remainAmt},on:{"update:dialogVisible":function(e){return t.$set(t.dialog,"showCreditCardDialog",e)},"update:dialog-visible":function(e){return t.$set(t.dialog,"showCreditCardDialog",e)}}}),t._v(" "),r("SoDialog",{attrs:{"dialog-visible":t.showTranSoDialog,"shop-cart":t.shopCart},on:{"update:dialogVisible":function(e){t.showTranSoDialog=e},"update:dialog-visible":function(e){t.showTranSoDialog=e}}}),t._v(" "),r("DeliverDataDialog",{attrs:{"dialog-visible":t.showDeliverDataDialog,"check-data":t.checkDeliverData,"fetch-so":t.toggleTransSoDrawer},on:{"update:dialogVisible":function(e){t.showDeliverDataDialog=e},"update:dialog-visible":function(e){t.showDeliverDataDialog=e},"update:checkData":function(e){t.checkDeliverData=e},"update:check-data":function(e){t.checkDeliverData=e}}})],1)},B=[],U=(r("c5f6"),r("6762"),r("28a5"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:t.ticketInfo.name,visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),r("el-form",{ref:"inputForm",attrs:{"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"券號"}},[r("el-input",{model:{value:t.ticketNo,callback:function(e){t.ticketNo=e},expression:"ticketNo"}})],1),t._v(" "),!0===t.valid?r("el-form-item",{attrs:{label:"金額"}},[t._v("\n        "+t._s(t.discount)+"\n      ")]):t._e(),t._v(" "),!1===t.valid?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.verify}},[t._v("驗證")])],1):r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("使用")])],1)],1)],1)],1)}),G=[];function Q(t){return Object(_["a"])({url:"/vue-element-admin/ticket/verifyTicket",method:"post",params:{params:t}})}var Y=r("f110"),H={name:"TicketDialog",props:{dialogVisible:{type:Boolean,required:!1},ticketInfo:{type:Object,default:function(){return{}}},addPayInfo:{type:Function,default:function(){}}},data:function(){return{ticketNo:null,valid:!1,discount:0,errorMsg:""}},created:function(){},methods:{verify:function(){var t=this;Q().then((function(e){e.valid?(t.valid=e.valid,t.discount=e.discount,t.errorMsg=""):t.errorMsg="券號無效"})).catch((function(t){console.error(t)}))},submit:function(){var t=new Y["e"];t.type=this.ticketInfo.type,t.name=this.ticketInfo.name,t.amount=this.discount,this.addPayInfo(t),Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},beforeClose:function(){Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)}}},W=H,J=Object(q["a"])(W,U,G,!1,null,null,null),Z=J.exports,X=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"發票",visible:t.dialogVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[r("el-form",{ref:"inputForm",attrs:{model:t.inputForm,rules:t.rules,"status-icon":"","label-position":"left"}},[r("el-form-item",[r("el-radio-group",{model:{value:t.inputForm.donate,callback:function(e){t.$set(t.inputForm,"donate",e)},expression:"inputForm.donate"}},[r("el-radio-button",{attrs:{label:!0}},[t._v("捐贈發票")]),t._v(" "),r("el-radio-button",{attrs:{label:!1}},[t._v("不捐贈發票")])],1)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!0===t.inputForm.donate,expression:"inputForm.donate === true"}],attrs:{prop:"heartcode"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"不輸入使用燦坤預設",inputmode:"numeric",autocomplete:"off"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.inputForm.heartcode,callback:function(e){t.$set(t.inputForm,"heartcode",e)},expression:"inputForm.heartcode"}},[r("template",{slot:"prepend"},[t._v("捐贈碼")])],2)],1),t._v(" "),!1===t.inputForm.donate?r("el-form-item",[r("el-radio-group",{model:{value:t.inputForm.print,callback:function(e){t.$set(t.inputForm,"print",e)},expression:"inputForm.print"}},[r("el-radio-button",{attrs:{label:!0}},[t._v("列印紙本")]),t._v(" "),r("el-radio-button",{attrs:{label:!1}},[t._v("使用載具")])],1)],1):t._e(),t._v(" "),!1===t.inputForm.donate&&!1===t.inputForm.print?r("el-form-item",[r("el-radio-group",{model:{value:t.inputForm.ecInvoice,callback:function(e){t.$set(t.inputForm,"ecInvoice",e)},expression:"inputForm.ecInvoice"}},[r("el-radio-button",{attrs:{label:"commcode"}},[t._v("載具碼")]),t._v(" "),r("el-radio-button",{attrs:{label:"MOICANo"}},[t._v("自然人憑證")])],1)],1):t._e(),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1===t.inputForm.donate&&!0===t.inputForm.print&&t.systemInfo.passport,expression:"inputForm.donate === false &&inputForm.print === true && systemInfo.passport"}],attrs:{prop:"passportNo"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{maxlength:"4",autocomplete:"off"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.inputForm.passportNo,callback:function(e){t.$set(t.inputForm,"passportNo",e)},expression:"inputForm.passportNo"}},[r("template",{slot:"prepend"},[t._v("護照後4碼")])],2)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1===t.inputForm.donate&&!1===t.inputForm.print&&"commcode"===t.inputForm.ecInvoice,expression:"inputForm.donate === false && inputForm.print === false && inputForm.ecInvoice === 'commcode'"}],attrs:{prop:"commcode"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{inputmode:"numeric",autocomplete:"off"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.inputForm.commcode,callback:function(e){t.$set(t.inputForm,"commcode",e)},expression:"inputForm.commcode"}},[r("template",{slot:"prepend"},[t._v("載具碼")])],2)],1),t._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1===t.inputForm.donate&&!1===t.inputForm.print&&"MOICANo"===t.inputForm.ecInvoice,expression:"inputForm.donate === false && inputForm.print === false && inputForm.ecInvoice === 'MOICANo'"}],attrs:{prop:"MOICANo"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{inputmode:"numeric",autocomplete:"off"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.inputForm.MOICANo,callback:function(e){t.$set(t.inputForm,"MOICANo",e)},expression:"inputForm.MOICANo"}},[r("template",{slot:"prepend"},[t._v("自然人憑證")])],2)],1),t._v(" "),!0===t.inputForm.donate||null!==t.inputForm.print?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(e){return t.submit(t.inputForm)}}},[t._v("確定")])],1):t._e()],1)],1),t._v(" "),t.testModel?r("el-card",[t._v(t._s(t.showModel))]):t._e()],1)},K=[],tt=r("7baa"),et={name:"InvoiceDialog",props:{dialogVisible:{type:Boolean,required:!1},clearPayInfo:{type:Function,default:function(){}},payData:{type:Array,default:function(){return[]}},shopCart:{type:Object,default:function(){return new tt["c"]}}},data:function(){var t=this,e=function(e,r,a){!1===t.inputForm.donate||""===r||Object($["g"])(r)?a():a(new Error("捐贈碼輸入錯誤"))},r=function(e,r,a){!0===t.inputForm.print?a():"commcode"===t.inputForm.ecInvoice?Object($["f"])(r)?a():a(new Error("載具號碼輸入錯誤")):a()},a=function(e,r,a){!0===t.inputForm.print?a():"MOICANo"===t.inputForm.ecInvoice?Object($["d"])(r)?a():a(new Error("自然人憑證輸入錯誤")):a()};return{showModel:"",testModel:!1,finish:!1,rules:{heartcode:[{validator:e,trigger:"blur"}],commcode:[{validator:r,trigger:"blur"}],MOICANo:[{validator:a,trigger:"blur"}]}}},computed:Object(n["a"])({},Object(i["c"])({inputForm:function(t){return t.order.invoice},systemInfo:function(t){return t.systemInfo}}),{},Object(i["b"])(["","termNo","memberInfo","invoice","storeNo","serialNo","serviceNo"])),watch:{"inputForm.ecInvoice":{handler:function(t){this.inputForm.commcode="",this.inputForm.MOICANo="",this.inputForm.passportNo=""},deep:!0},"inputForm.print":{handler:function(t){this.inputForm.commcode="",this.inputForm.MOICANo="",this.inputForm.passportNo=""},deep:!0}},created:function(){},methods:{submit:function(t){var e=this;this.$refs["inputForm"].validate((function(t){t&&e.$emit("update:dialogVisible",!1)}))}}},rt=et,at=(r("3817"),Object(q["a"])(rt,X,K,!1,null,"6ceb4f0c",null)),ot=at.exports,nt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{ref:"payback",attrs:{title:"還元金",visible:t.dialogVisible,"before-close":t.close},on:{"update:visible":function(e){t.dialogVisible=e}}},[1==t.memberInfo.status?r("el-card",[r("el-form",{ref:"memberInfo",attrs:{"label-position":"left"}},[r("el-form-item",{attrs:{label:"會員ID:"}},[t._v(t._s(t.memberInfo.CustNo))]),t._v(" "),r("el-form-item",{attrs:{label:"可使用還元金:"}},[t._v(t._s(t.memberInfo.UnuseAmt))]),t._v(" "),r("el-form-item",[r("el-input",{attrs:{placeholder:"請輸入使用金額"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submit(e))}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),t._v(" "),r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("送出")])],1)],1)],1):t._e()],1)},it=[],st=r("7618");r("4917");function ct(){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/installment",method:"get"})}function lt(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/installment/bank/".concat(t),method:"get"})}function ut(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/member/useFB",method:"post",headers:{"Content-Type":"application/json"},data:t})}function dt(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/member/validateWishFB",method:"post",headers:{"Content-Type":"application/json"},data:t})}function pt(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/member/useWishFB",method:"post",headers:{"Content-Type":"application/json"},data:t})}function mt(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/pr/payment",method:"post",headers:{"Content-Type":"application/json"},data:t})}function ft(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/pr/cancel",method:"post",headers:{"Content-Type":"application/json"},data:t})}function ht(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/pr/query",method:"post",headers:{"Content-Type":"application/json"},data:t})}function bt(t){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/pr/creditCardIssuer",method:"post",headers:{"Content-Type":"application/json"},data:t})}var vt=r("5c96"),yt=r("c1df"),gt=r.n(yt);function wt(t){var e=JSON.parse('{"'.concat(t.toString().replaceAll("=[",'":"').replaceAll("]",'"').replaceAll(",",',"'),"}")),r=new Y["h"];return r.CardNo=e.cardno,r.OrdDate=gt()().format("YYYYMMDD"),r.OrdAmt=e.orderAmt,r.UseAmt=e.useamt,r.pincode=e.pincode,r}function _t(t){var e=[];return t.forEach((function(t){switch(t.type){case"creditCard":e.push(new Promise((function(e){var r=new Y["d"];r.orderNumber=t.detail.bankOrderNo;var a=ft(r).then((function(t){return Object(vt["Message"])({message:"信用卡退授權成功，單號:".concat(t.orderNumber),type:"error",duration:6e3,showClose:!0}),!0})).catch((function(t){return console.log(t),Object(vt["Message"])({message:"信用卡退授權失敗，錯誤訊息:".concat(t.message),type:"error",duration:6e3,showClose:!0}),!1}));e(a)})));break}})),e}var kt={name:"PaybackDialog",props:{dialogVisible:{type:Boolean,required:!1},addPayInfo:{type:Function,default:function(){}},orderAmt:{type:Number,default:0}},data:function(){return{input:null,errorMsg:"",activeName:"first",imageUrl:null,error:"",camera:"auto"}},computed:Object(n["a"])({},Object(i["b"])(["businessDate","invoice"]),{},Object(i["c"])({memberInfo:function(t){return t.member},serialNo:function(t){return t.systemInfo.serialNo}})),created:function(){},methods:{submit:function(){if(this.input.indexOf("LEAD=[")>-1)this.onDecode();else{if(this.errorMsg="",this.input>1*this.memberInfo.UnuseAmt)this.errorMsg="超出可使用金額",this.input=this.memberInfo.UnuseAmt;else if(null===this.input)this.errorMsg="未輸入折抵金額";else if(Object($["a"])(this.input)){var t=Object.assign(new Y["g"],{CardNo:this.memberInfo.CustNo.substring(4,12),OrdNo:(Array(5).join("0")+1*this.serialNo).slice(-5),OrdDate:this.businessDate.replaceAll("/",""),OrdAmt:this.orderAmt,UseAmt:this.input});this.$store.dispatch("payback/updatePayback",t),this.addToPayment(this.input)}else this.errorMsg="請輸入正確金額格式";""!==this.errorMsg&&this.$message({showClose:!0,message:this.errorMsg,type:"error"})}},onDecode:function(){var t=this;this.camera="off";var e=wt(this.input);e.OrdNo=this.invoice,e.OrdAmt=this.orderAmt;var r=Object.assign(new Y["g"],e);dt(r).then((function(r){t.$store.dispatch("payback/updatePayback",e),t.addToPayment(r.returnMoney)})).catch((function(e){t.$message({showClose:!0,message:e,type:"error"})})).finally((function(){t.close()}))},onInit:function(){var t=Object(P["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),"NotAllowedError"===t.t0.name?this.error="ERROR: you need to grant camera access permisson":"NotFoundError"===t.t0.name?this.error="ERROR: no camera on this device":"NotSupportedError"===t.t0.name?this.error="ERROR: secure context required (HTTPS, localhost)":"NotReadableError"===t.t0.name?this.error="ERROR: is the camera already in use?":"OverconstrainedError"===t.t0.name?this.error="ERROR: installed cameras are not suitable":"StreamApiNotSupportedError"===t.t0.name?this.error="ERROR: Stream API is not supported in this browser":this.error="ERROR: ".concat(t.t0.name);case 8:case"end":return t.stop()}}),t,this,[[0,5]])})));function e(e){return t.apply(this,arguments)}return e}(),close:function(){Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},addToPayment:function(t){var e=new Y["e"];e.type="FBAmt",e.name="還元金",e.amount=t,this.addPayInfo(e),this.$emit("update:dialogVisible",!1)}}},Nt=kt,Ct=(r("4ac3"),Object(q["a"])(Nt,nt,it,!1,null,"266dd007",null)),Dt=Ct.exports,It=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"",visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),r("el-form",{ref:"inputForm",attrs:{"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"金額"}},[r("el-input",{attrs:{inputmode:"numeric"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submit(e))}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}})],1),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("確定")])],1)],1)],1)],1)},Pt=[],Ot={name:"PaymentInputDialog",props:{payType:{type:String,default:"cash"},dialogVisible:{type:Boolean,required:!1},addPayInfo:{type:Function,default:function(){}},amount:{type:Number,default:0}},data:function(){return{input:"",valid:!1,errorMsg:""}},watch:{amount:function(t){this.input=t}},created:function(){},updated:function(){},methods:{submit:function(){var t=new Y["e"];switch(this.payType){case"creditAmt":t.type="creditAmt",t.name="賒帳";break;default:t.type="cash",t.name="現金";break}t.amount=this.input,this.addPayInfo(t),Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},beforeClose:function(){Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)}}},xt=Ot,jt=Object(q["a"])(xt,It,Pt,!1,null,null,null),St=jt.exports,Tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-dialog",{attrs:{title:"信用卡",visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[!1===t.waitAuthResult?r("el-form",{ref:"inputForm",attrs:{"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{"v-show":!1}},[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v("交易序號:"+t._s(t.systemInfo.serialNo))])],1),t._v(" "),1!==t.payInfo.info.credit.installmentNumber?r("el-form-item",[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v(t._s(t.payInfo.info.credit.installmentName))])],1):r("el-form-item",[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v("一次付清")])],1),t._v(" "),r("el-form-item",{attrs:{label:"金額"}},[r("el-input",{attrs:{inputmode:"numeric",disabled:!0},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.RequestAuth(e))}},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}})],1),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.RequestAuth}},[t._v("開始付款")])],1)],1):r("el-form",{ref:"inputForm",attrs:{"label-position":"left","label-width":"80px"}},[1!==t.payInfo.info.credit.installmentNumber?r("el-form-item",{attrs:{label:"單號"}},[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v(t._s(t.payInfo.info.credit.installmentName))])],1):r("el-form-item",[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v(t._s(t.creditCard.orderNo))])],1),t._v(" "),r("el-form-item",{attrs:{label:"金額"}},[t._v("\n          "+t._s(t.input)+"\n        ")])],1)],1)],1),t._v(" "),r("Paycard",{attrs:{"on-drawer":t.drawer.PaycardDrawer,"order-data":t.orderData,callback:t.callback},on:{"update:onDrawer":function(e){return t.$set(t.drawer,"PaycardDrawer",e)},"update:on-drawer":function(e){return t.$set(t.drawer,"PaycardDrawer",e)}}})],1)},$t=[],At=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-drawer",{attrs:{visible:t.onDrawer,"before-close":t.beforeClose,size:"100%",direction:"btt"},on:{"update:visible":function(e){t.onDrawer=e}}},[r("CardForm",{attrs:{"form-data":t.formData,"order-data":t.orderData,callback:t.callback},on:{"input-card-number":t.updateCardNumber,"input-card-name":t.updateCardName,"input-card-month":t.updateCardMonth,"input-card-year":t.updateCardYear,"input-card-cvv":t.updateCardCvv}})],1)},Mt=[],Ft=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"card-form"},[r("order-info",{attrs:{"order-data":t.orderData}}),t._v(" "),r("div",{staticClass:"card-list"},[r("Card",{attrs:{fields:t.fields,labels:t.formData,"is-card-number-masked":t.isCardNumberMasked,"random-backgrounds":t.randomBackgrounds,"background-image":t.backgroundImage}})],1),t._v(" "),r("div",{staticClass:"card-form__inner"},[r("div",{staticClass:"card-input"},[r("div",[r("label",{staticClass:"card-input__label",attrs:{for:"cardNumber"}},[t._v(t._s(t.cardForm.cardNumber))]),t._v(" "),r("input",{staticClass:"card-input__input",attrs:{id:t.fields.cardNumber,type:"tel",maxlength:t.cardNumberMaxLength,"data-card-field":"",autocomplete:"off"},domProps:{value:t.formData.cardNumber},on:{input:t.changeNumber,focus:t.focusCardNumber,blur:t.blurCardNumber}}),t._v(" "),r("div",{staticClass:"card-form__row"},[r("div",{staticClass:"card-form__col"},[r("div",{staticClass:"card-form__group"},[r("label",{staticClass:"card-input__label",attrs:{for:"cardMonth"}},[t._v(t._s(t.cardForm.expirationDate))]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.formData.cardMonth,expression:"formData.cardMonth"}],staticClass:"card-input__input -select",attrs:{id:t.fields.cardMonth,"data-card-field":""},on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.formData,"cardMonth",e.target.multiple?r:r[0])},t.changeMonth]}},[r("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(t._s(t.cardForm.month))]),t._v(" "),t._l(12,(function(e){return r("option",{key:e,attrs:{disabled:e<t.minCardMonth},domProps:{value:e<10?"0"+e:e}},[t._v(t._s(t.generateMonthValue(e)))])}))],2),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.formData.cardYear,expression:"formData.cardYear"}],staticClass:"card-input__input -select",attrs:{id:t.fields.cardYear,"data-card-field":""},on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.formData,"cardYear",e.target.multiple?r:r[0])},t.changeYear]}},[r("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(t._s(t.cardForm.year))]),t._v(" "),t._l(12,(function(e,a){return r("option",{key:e,domProps:{value:a+t.minCardYear}},[t._v(t._s(a+t.minCardYear))])}))],2)])]),t._v(" "),r("div",{staticClass:"card-form__col -cvv"},[r("div",{staticClass:"card-input"},[r("label",{staticClass:"card-input__label",attrs:{for:"cardCvv"}},[t._v(t._s(t.cardForm.CVV))]),t._v(" "),r("input",{directives:[{name:"number-only",rawName:"v-number-only"}],staticClass:"card-input__input",attrs:{id:t.fields.cardCvv,type:"tel",maxlength:"4","data-card-field":"",autocomplete:"off"},domProps:{value:t.formData.cardCvv},on:{input:t.changeCvv}})])])])]),t._v(" "),r("button",{staticClass:"card-input__eye",class:{"-active":!t.isCardNumberMasked},attrs:{title:"Show/Hide card number",tabindex:"-1",disabled:""===t.formData.cardNumber},on:{click:t.toggleMask}})]),t._v(" "),1!==t.orderData.installments?r("div",[r("el-divider",[r("i",{staticClass:"el-icon-s-order"}),t._v("分期設定")]),t._v(" "),r("div",{staticClass:"card-form__row"},[r("div",{staticClass:"card-form__col"},[r("div",[r("label",{staticClass:"card-input__label"},[t._v("銀行")]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.bank,expression:"bank"}],staticClass:"card-input__input -select",attrs:{disabled:""},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.bank=e.target.multiple?r:r[0]}}},t._l(t.bankOptions,(function(e){return r("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.label))])})),0)])]),t._v(" "),r("div",{staticClass:"card-form__col"},[r("div",[r("label",{staticClass:"card-input__label"},[t._v("分期數")]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.ins,expression:"ins"}],staticClass:"card-input__input -select",on:{change:[function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.ins=e.target.multiple?r:r[0]},function(e){return t.insChange()}]}},t._l(t.insOptions,(function(e){return r("option",{key:e.value,domProps:{value:e.value}},[t._v(t._s(e.label))])})),0)])])])],1):t._e(),t._v(" "),r("button",{staticClass:"card-form__button",on:{click:t.invaildCard}},[t._v(t._s(t.cardForm.submit))])]),t._v(" "),r("vueFrame",{attrs:{"raw-html":t.rawHtml,src:t.src,"show-drawer":t.onOTP,callback:t.iframeCallback,"handle-close":t.handleIframeClose},on:{"update:showDrawer":function(e){t.onOTP=e},"update:show-drawer":function(e){t.onOTP=e}}})],1)},Et=[],Lt=(r("386d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-item",class:{"-active":t.isCardFlipped}},[a("div",{staticClass:"card-item__side -front"},[a("div",{ref:"focusElement",staticClass:"card-item__focus",class:{"-active":t.focusElementStyle},style:t.focusElementStyle}),t._v(" "),a("div",{staticClass:"card-item__cover"},[t.imgSrc?a("img",{staticClass:"card-item__bg",attrs:{src:t.imgSrc}}):t._e()]),t._v(" "),a("div",{staticClass:"card-item__wrapper"},[a("div",{staticClass:"card-item__top"},[a("img",{staticClass:"card-item__chip",attrs:{src:r("4b81")}}),t._v(" "),a("div",{staticClass:"card-item__type"},[a("transition",{attrs:{name:"slide-fade-up"}},[t.cardType?a("img",{key:t.cardType,staticClass:"card-item__typeImg",attrs:{src:t.getCardTypeImg(t.cardType),alt:""}}):t._e()])],1)]),t._v(" "),a("label",{ref:t.fields.cardNumber,staticClass:"card-item__number",attrs:{for:t.fields.cardNumber}},[t._l(t.currentPlaceholder,(function(e,r){return a("span",{key:r},[a("transition",{attrs:{name:"slide-fade-up"}},[t.getIsNumberMasked(r,e)?a("div",{staticClass:"card-item__numberItem"},[t._v("*")]):t.labels.cardNumber.length>r?a("div",{key:t.currentPlaceholder,staticClass:"card-item__numberItem",class:{"-active":""===e.trim()}},[t._v(t._s(t.labels.cardNumber[r]))]):a("div",{key:t.currentPlaceholder+1,staticClass:"card-item__numberItem",class:{"-active":""===e.trim()}},[t._v(t._s(e))])])],1)}))],2),t._v(" "),a("div",{staticClass:"card-item__content"},[a("div",{ref:"cardDate",staticClass:"card-item__date"},[a("label",{staticClass:"card-item__dateTitle",attrs:{for:t.fields.cardMonth}},[t._v(t._s(t.card.expires))]),t._v(" "),a("label",{staticClass:"card-item__dateItem",attrs:{for:t.fields.cardMonth}},[a("transition",{attrs:{name:"slide-fade-up"}},[t.labels.cardMonth?a("span",{key:t.labels.cardMonth},[t._v(t._s(t.labels.cardMonth))]):a("span",{key:"2"},[t._v(t._s(t.card.MM))])])],1),t._v("\n          /\n          "),a("label",{staticClass:"card-item__dateItem",attrs:{for:"cardYear"}},[a("transition",{attrs:{name:"slide-fade-up"}},[t.labels.cardYear?a("span",{key:t.labels.cardYear},[t._v(t._s(String(t.labels.cardYear).slice(2,4)))]):a("span",{key:"2"},[t._v(t._s(t.card.YY))])])],1)])])])]),t._v(" "),a("div",{staticClass:"card-item__side -back"},[a("div",{staticClass:"card-item__cover"},[t.imgSrc?a("img",{staticClass:"card-item__bg",attrs:{src:t.imgSrc}}):t._e()]),t._v(" "),a("div",{staticClass:"card-item__band"}),t._v(" "),a("div",{staticClass:"card-item__cvv"},[a("div",{staticClass:"card-item__cvvTitle"},[t._v("CVV")]),t._v(" "),a("div",{staticClass:"card-item__cvvBand"},t._l(t.labels.cardCvv,(function(e,r){return a("span",{key:r},[t._v("*")])})),0),t._v(" "),a("div",{staticClass:"card-item__type"},[t.cardType?a("img",{staticClass:"card-item__typeImg",attrs:{src:t.getCardTypeImg(t.cardType)}}):t._e()])])])])}),qt=[],Vt=(r("3b2b"),{name:"Card",props:{labels:Object,fields:Object,isCardNumberMasked:Boolean,randomBackgrounds:{type:Boolean,default:!0},backgroundImage:[String,Object]},data:function(){return{focusElementStyle:null,currentFocus:null,isFocused:!1,isCardFlipped:!1,amexCardPlaceholder:"#### ###### #####",dinersCardPlaceholder:"#### ###### ####",defaultCardPlaceholder:"#### #### #### ####",currentPlaceholder:"",card:{cardHolder:"Card Holder",fullName:"Full Name",expires:"Expires",MM:"MM",YY:"YY"},imgSrc:r("97a2")("./".concat(Math.floor(25*Math.random()+1),".jpeg"))}},computed:{cardType:function(){var t=this.labels.cardNumber,e=new RegExp("^4");return null!=t.match(e)?"visa":(e=new RegExp("^(34|37)"),null!=t.match(e)?"amex":(e=new RegExp("^5[1-5]"),null!=t.match(e)?"mastercard":(e=new RegExp("^6011"),null!=t.match(e)?"discover":(e=new RegExp("^62"),null!=t.match(e)?"unionpay":(e=new RegExp("^9792"),null!=t.match(e)?"troy":(e=new RegExp("^3(?:0([0-5]|9)|[689]\\d?)\\d{0,11}"),null!=t.match(e)?"dinersclub":(e=new RegExp("^35(2[89]|[3-8])"),null!=t.match(e)?"jcb":"")))))))},currentCardBackground:function(){if(this.randomBackgrounds&&!this.backgroundImage){var t=Math.floor(25*Math.random()+1);return"/icons/paycard/images/".concat(t,".jpeg")}return this.backgroundImage?this.backgroundImage:null}},watch:{currentFocus:function(){this.currentFocus?this.changeFocus():this.focusElementStyle=null},cardType:function(){this.changePlaceholder()}},mounted:function(){var t=this;this.changePlaceholder();var e=this,r=document.querySelectorAll("[data-card-field]");r.forEach((function(r){r.addEventListener("focus",(function(){t.isFocused=!0,r.id===t.fields.cardYear||r.id===t.fields.cardMonth?t.currentFocus="cardDate":t.currentFocus=r.id,t.isCardFlipped=r.id===t.fields.cardCvv})),r.addEventListener("blur",(function(){t.isCardFlipped=!r.id===t.fields.cardCvv,setTimeout((function(){e.isFocused||(e.currentFocus=null)}),300),e.isFocused=!1}))}))},methods:{changeFocus:function(){var t=this.$refs[this.currentFocus];this.focusElementStyle=t?{width:"".concat(t.offsetWidth,"px"),height:"".concat(t.offsetHeight,"px"),transform:"translateX(".concat(t.offsetLeft,"px) translateY(").concat(t.offsetTop,"px)")}:null},getIsNumberMasked:function(t,e){return t>4&&t<14&&this.labels.cardNumber.length>t&&""!==e.trim()&&this.isCardNumberMasked},changePlaceholder:function(){var t=this;"amex"===this.cardType?this.currentPlaceholder=this.amexCardPlaceholder:"dinersclub"===this.cardType?this.currentPlaceholder=this.dinersCardPlaceholder:this.currentPlaceholder=this.defaultCardPlaceholder,this.$store.dispatch("creditCard/update",{cardType:this.cardType}),this.$nextTick((function(){t.changeFocus()}))},getCardTypeImg:function(t){var e=r("c470");return e("./".concat(t,".png"))}}}),Rt=Vt,zt=Object(q["a"])(Rt,Lt,qt,!1,null,null,null),Bt=zt.exports,Ut=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"order-item"},[r("div",{staticClass:"card-item__cover"}),t._v(" "),r("div",{staticClass:"card-item__side -front"},[r("div",{staticClass:"card-item__wrapper"},[r("div",{staticClass:"card-item__content"},[r("label",{staticClass:"card-item__info"},[t._m(0),t._v(" "),r("div",{staticClass:"card-item__name"},[r("label",[t._v("\n              "+t._s(t.serialNo)+"\n            ")])])])]),t._v(" "),r("div",{staticClass:"card-item__content"},[r("label",{staticClass:"card-item__info"},[t._m(1),t._v(" "),r("div",{staticClass:"card-item__name"},[r("label",[t._v("\n              "+t._s(t.orderNo)+"\n            ")])])])]),t._v(" "),r("div",{staticClass:"card-item__content"},[r("label",{staticClass:"card-item__info"},[t._m(2),t._v(" "),r("div",{staticClass:"card-item__name"},[r("label",[t._v("NTD "+t._s(t._f("toCurrency")(1*t.orderData.amount)))])])])]),t._v(" "),1!==t.orderData.installments?r("div",{staticClass:"card-item__content"},[r("label",{staticClass:"card-item__info"},[r("div",{staticClass:"card-item__name"},[r("label",[r("el-tag",{attrs:{type:"info"}},[t._v("此訂單需分期")])],1)])])]):t._e()])])])},Gt=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"card-item__name"},[r("label",[t._v("\n              交易序號\n            ")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"card-item__name"},[r("label",[t._v("\n              授權單號\n            ")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"card-item__name"},[r("label",[t._v("\n              金額\n            ")])])}],Qt={name:"OrderInfo",props:{orderData:{type:Object,required:!0}},data:function(){return{focusElementStyle:null}},computed:Object(n["a"])({},Object(i["c"])({orderNo:function(t){return t.creditCard.orderNo}}),{},Object(i["b"])(["serialNo"]))},Yt=Qt,Ht=Object(q["a"])(Yt,Ut,Gt,!1,null,null,null),Wt=Ht.exports,Jt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-drawer",{attrs:{"show-close":!0,"append-to-body":!0,visible:t.showDrawer,direction:"ttb",size:"100%","before-close":t.handleClose},on:{"update:visible":function(e){t.showDrawer=e}}},[""!==t.src?r("iframe",{ref:"vueFrame",staticStyle:{width:"100%",height:"100%"},attrs:{src:t.src,sandbox:"allow-scripts allow-forms allow-popups allow-modals",onload:t.iframeLoad(this)}}):r("iframe",{ref:"vueFrame",staticStyle:{width:"100%",height:"100%"},attrs:{srcdoc:t.rawHtml,sandbox:"allow-scripts allow-forms allow-popups allow-modals",onload:t.iframeLoad(this)}})])},Zt=[],Xt=void 0,Kt={name:"VueFrame",props:{message:{type:Object,default:function(){return{}}},showDrawer:{type:Boolean,default:function(){return!1}},src:{type:String,default:""},rawHtml:{type:String,default:""},callback:{type:Function,default:function(){}},handleClose:{type:Function,default:function(){Xt.$emit("update:showDrawer",!1)}}},watch:{},methods:{iframeLoad:function(t){}}},te=Kt,ee=(r("c593"),Object(q["a"])(te,Jt,Zt,!1,null,"6f867167",null)),re=ee.exports,ae={name:"CardForm",directives:{"number-only":{bind:function(t){function e(t){if(t.target.value=t.target.value.replace(/[^0-9]/g,""),t.charCode>=48&&t.charCode<=57)return!0;t.preventDefault()}t.addEventListener("keypress",e)}},"letter-only":{bind:function(t){function e(t){return t.charCode>=48&&t.charCode<=57&&t.preventDefault(),!0}t.addEventListener("keypress",e)}}},components:{Card:Bt,OrderInfo:Wt,vueFrame:re},props:{formData:{type:Object,default:function(){return{cardName:"",cardNumber:"",cardNumberNotMask:"",cardMonth:"",cardYear:"",cardCvv:""}}},backgroundImage:[String,Object],randomBackgrounds:{type:Boolean,default:!0},orderData:{type:Object,default:function(){return{amount:""}}},callback:{type:Function,required:!0}},data:function(){return{fields:{cardNumber:"cardNumber-CC",cardName:"v-card-name",cardMonth:"v-card-month",cardYear:"v-card-year",cardCvv:"v-card-cvv"},minCardYear:(new Date).getFullYear(),isCardNumberMasked:!0,mainCardNumber:this.cardNumber,cardNumberMaxLength:19,cardForm:{cardNumber:"Card Number",cardName:"Card Name",expirationDate:"Expiration Date",month:"Month",year:"Year",CVV:"CVV",submit:"付款",invalidCardNumber:"卡號無效"},bank:"",bankOptions:[],ins:1,insOptions:[],rawHtml:"",src:"",onOTP:!1}},computed:Object(n["a"])({},Object(i["c"])({userId:function(t){return t.user.userId},systemInfo:function(t){return t.systemInfo},orderNo:function(t){return t.creditCard.orderNo},member:function(t){return t.member}}),{minCardMonth:function(){return this.formData.cardYear===this.minCardYear?(new Date).getMonth()+1:1}}),watch:{orderData:{handler:function(t,e){this.bank=this.orderData.issuingBank,this.ins=this.orderData.installments},deep:!0},bank:function(t,e){var r=this;void 0!==t&&""!==t&&this.orderData.installments>1&&lt(t).then((function(a){r.insOptions=[],t!==e&&t!==r.orderData.issuingBank&&(r.ins=1*a[0].installmentNumber),a.forEach((function(t){r.insOptions.push({value:1*t.installmentNumber,label:t.installmentName,id:t.installmentID})}))})).catch((function(t){console.error(t)}))}},created:function(){var t=this;this.bank=this.orderData.issuingBank,this.ins=this.orderData.installments,ct().then((function(e){e.forEach((function(e){t.bankOptions.push({value:e.bankID,label:e.bankName})}))})).catch((function(t){console.error(t)}))},mounted:function(){this.maskCardNumber()},methods:{generateMonthValue:function(t){return t<10?"0".concat(t):t},changeName:function(t){this.formData.cardName=t.target.value,this.$emit("input-card-name",this.formData.cardName)},changeNumber:function(t){this.formData.cardNumber=t.target.value;var e=this.formData.cardNumber.replace(/\D/g,"");if(/^3[47]\d{0,13}$/.test(e)?(this.formData.cardNumber=e.replace(/(\d{4})/,"$1 ").replace(/(\d{4}) (\d{6})/,"$1 $2 "),this.cardNumberMaxLength=17):/^3(?:0[0-5]|[68]\d)\d{0,11}$/.test(e)?(this.formData.cardNumber=e.replace(/(\d{4})/,"$1 ").replace(/(\d{4}) (\d{6})/,"$1 $2 "),this.cardNumberMaxLength=16):/^\d{0,16}$/.test(e)&&(this.formData.cardNumber=e.replace(/(\d{4})/,"$1 ").replace(/(\d{4}) (\d{4})/,"$1 $2 ").replace(/(\d{4}) (\d{4}) (\d{4})/,"$1 $2 $3 "),this.cardNumberMaxLength=19),"deleteContentBackward"==t.inputType){var r=this.formData.cardNumber.substring(this.formData.cardNumber.length,this.formData.cardNumber.length-1);" "==r&&(this.formData.cardNumber=this.formData.cardNumber.substring(0,this.formData.cardNumber.length-1))}this.$emit("input-card-number",this.formData.cardNumber)},changeMonth:function(){this.$emit("input-card-month",this.formData.cardMonth)},changeYear:function(){this.$emit("input-card-year",this.formData.cardYear)},changeCvv:function(t){this.formData.cardCvv=t.target.value,this.$emit("input-card-cvv",this.formData.cardCvv)},insChange:function(){var t=this,e=this.insOptions.find((function(e){return e.value===t.ins}));this.$store.dispatch("payInfo/updatePayInfo",{info:{credit:{installmentID:e.id,installmentName:e.label,installmentNumber:e.value}}})},invaildCard:function(){var t=this,e="";void 0!==this.formData.cardNumberNotMask&&(e=this.formData.cardNumberNotMask.replace(/ /g,""));var r="".concat(this.formData.cardYear.toString().substring(2)).concat(this.formData.cardMonth);if(3!==this.formData.cardCvv.length)this.$message({type:"error",message:"CVV輸入錯誤",closable:"true"});else if(4!==r.length)this.$message({type:"error",message:"信用卡日期輸入錯誤",closable:"true"});else if(Object($["k"])(e)){this.$nextTick((function(){window.addEventListener("message",(function(e){if(t.onOTP)try{var r=JSON.parse(e.data);r.hasOwnProperty("orderNumber")&&r.orderNumber===t.orderNo&&(t.onOTP=!1,t.callback(r))}catch(a){}}))}));var a=new Y["c"]({orderNumber:this.orderNo,amount:this.orderData.amount,creditCardNumber:e,expirationDate:r,cvc:this.formData.cardCvv,installments:this.ins,memberID:this.member.CustNo,store:this.systemInfo.storeNo});mt(JSON.stringify(a)).then((function(e){e.hppUrl.search("<html>")>-1?t.rawHtml=e.hppUrl.replaceAll('"',"'"):e.hppUrl.search("https://")>-1?t.src=e.hppUrl:(t.$message({type:"error",message:"hppUrl格式錯誤",closable:"true"}),t.$store.dispatch("errorLog/addErrorLog",{err:{message:"hppUrl格式錯誤",stack:e.hppUrl},vm:"3D驗證",info:"",url:""})),t.onOTP=!0})).catch((function(e){t.$message({type:"error",message:e.message,closable:"true"}),t.$store.dispatch("creditCard/update",{orderNo:Object(Y["i"])({dateT:t.systemInfo.businessDate.replaceAll("/",""),storeNo:t.systemInfo.storeNo,termNo:t.systemInfo.termNo})}),t.$notify({title:"信用卡授權",message:"授權單號已更新",type:"info"})}))}else this.$message({type:"error",message:this.cardForm.invalidCardNumber,closable:"true"})},blurCardNumber:function(){var t,e=this;if(this.isCardNumberMasked&&this.maskCardNumber(),this.formData.cardNumber.indexOf("*")<0)t=this.formData.cardNumber.replace(/ /g,"");else{if(void 0===this.formData.cardNumberNotMask)return;t=this.formData.cardNumberNotMask.replace(/ /g,"")}if(16===t.length){var r=Object.assign(new Y["b"],{creditCardNumber:t});bt(JSON.stringify(r)).then((function(t){e.bank=t.bankID,e.$store.dispatch("creditCard/update",t)})).catch((function(t){e.$message({type:"error",message:t.message,closable:"true"}),e.$store.dispatch("creditCard/update",{bankID:"",bankName:""})}))}},maskCardNumber:function(){if(!(this.formData.cardNumber.indexOf("*")>=1)){this.formData.cardNumberNotMask=this.formData.cardNumber,this.mainCardNumber=this.formData.cardNumber;var t=this.formData.cardNumber.split("");t.forEach((function(e,r){r>4&&r<14&&""!==e.trim()&&(t[r]="*")})),this.formData.cardNumber=t.join("")}},unMaskCardNumber:function(){this.formData.cardNumber=this.mainCardNumber},focusCardNumber:function(){this.unMaskCardNumber()},toggleMask:function(){this.isCardNumberMasked=!this.isCardNumberMasked,this.isCardNumberMasked?this.maskCardNumber():this.unMaskCardNumber()},iframeCallback:function(){this.callback({OrderID:this.orderNo})},handleIframeClose:function(t){var e=this;this.$confirm("確定要中斷信用卡授權嗎?").then((function(t){e.onOTP=!1,e.iframeCallback()})).catch((function(t){}))}}},oe=ae,ne=Object(q["a"])(oe,Ft,Et,!1,null,null,null),ie=ne.exports,se={name:"Paycard",components:{CardForm:ie},props:{onDrawer:{type:Boolean,default:!1},orderData:{type:Object,default:function(){return{orderNo:"",amount:""}}},callback:{type:Function,required:!0}},data:function(){return{formData:{cardName:"",cardNumber:"",cardMonth:"",cardYear:"",cardCvv:""}}},mounted:function(){},methods:{updateCardNumber:function(t){},updateCardName:function(t){},updateCardMonth:function(t){},updateCardYear:function(t){},updateCardCvv:function(t){},beforeClose:function(){this.$emit("update:onDrawer",!1),Object.assign(this.$data,this.$options.data())}}},ce=se,le=(r("aada"),Object(q["a"])(ce,At,Mt,!1,null,null,null)),ue=le.exports,de={name:"CreditDialog",components:{Paycard:ue},props:{dialogVisible:{type:Boolean,required:!1},addPayInfo:{type:Function,default:function(){}},amount:{type:Number,default:0}},data:function(){return{input:"",waitAuthResult:!1,drawer:{PaycardDrawer:!1},orderData:{amount:""}}},computed:Object(n["a"])({},Object(i["c"])({payInfo:function(t){return t.payInfo},systemInfo:function(t){return t.systemInfo},creditCard:function(t){return t.creditCard}})),watch:{amount:function(t){this.input=t},dialogVisible:function(t){t&&(this.orderNo=Object(Y["i"])({dateT:this.systemInfo.businessDate.replaceAll("/",""),storeNo:this.systemInfo.storeNo,termNo:this.systemInfo.termNo}),this.orderData={amount:this.input,issuingBank:this.payInfo.info.credit.bankNo,issuingBankName:this.payInfo.info.credit.bankName,installments:this.payInfo.info.credit.installmentNumber},this.$store.dispatch("creditCard/update",{orderNo:this.orderNo}))}},created:function(){},updated:function(){""===this.input&&(this.input=this.amount)},methods:{RequestAuth:function(){return this.input>this.amount?(this.$message({type:"error",message:"使用信用卡不得超出剩餘金額",closable:"true"}),!1):Object($["a"])(this.input)?(this.orderData={amount:this.input,issuingBank:this.payInfo.info.credit.bankNo,issuingBankName:this.payInfo.info.credit.bankName,installments:this.payInfo.info.credit.installmentNumber},void(this.drawer.PaycardDrawer=!0)):(this.$message({type:"error",message:"請輸入正確金額格式",closable:"true"}),this.input,!1)},QuaryAuth:function(){var t=this,e=new Y["f"]({queryType:2,orderNumber:this.creditCard.orderNo});ht(JSON.stringify(e)).then((function(e){var r=e.transactions[0];if("00"===r.transCode){var a=new Y["e"];a.type="creditCard",a.name="信用卡",a.amount=r.amount,a.detail=new Y["a"],a.detail.creditCardAmt=r.amount,a.detail.creditCardConnectStatus="1",a.detail.bankOrderNo=r.orderNumber,a.detail.creditCardNo=r.creditcardNumber,a.detail.unionPayFlag="0",a.detail.cardType=t.creditCard.cardType,a.detail.bankNo=t.creditCard.bankID,a.detail.approveCode=r.approveCode,a.detail.installmentFlag="N",1!==r.installments&&(a.detail.installmentFlag="Y",a.detail.installmentID=t.payInfo.info.credit.installmentID,a.detail.installmentNumber=r.installments,a.detail.installmentName=t.payInfo.info.credit.installmentName),t.addPayInfo(a)}else{var o="";o=""!==r.transCode?"[".concat(r.transCode,"]").concat(r.transMsg):"查無銀行交易資料",t.$message({type:"error",message:o,showClose:!0})}})).catch((function(t){console.error(t)})).finally((function(){t.$store.dispatch("creditCard/clear")})),Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},beforeClose:function(){this.$emit("update:dialogVisible",!1)},callback:function(t){this.drawer.PaycardDrawer=!1,this.QuaryAuth()}}},pe=de,me=Object(q["a"])(pe,Tt,$t,!1,null,null,null),fe=me.exports,he=function(){function t(e){Object(O["a"])(this,t),Object.assign(this,e)}return Object(x["a"])(t,[{key:"getPaymentList",value:function(){var t=this.header.payment,e=[];for(var r in t){var a=this.getPaymentName(r);switch(Object(st["a"])(t[r])){case"number":if(t[r]<=0||""===a)break;e.push({type:r,name:a,amount:t[r]});break;case"object":if("linePay"===r){if(t[r].linePayAmt<=0)break;e.push({type:r,name:a,amount:t[r].linePayAmt})}if("creditCard"===r){if(t[r].creditCardAmt<=0)break;e.push({type:r,name:a,amount:t[r].creditCardAmt,detail:{bankOrderNo:t[r].bankOrderNo}})}break}}return e}},{key:"getPaymentName",value:function(t){switch(t.toLowerCase()){case"cash":return"現金";case"tkgoodsamt":return"提貨券";case"sponsoramt":return"廠商贊助";case"pointsamt":return"紅利";case"pgamt":return"他店禮券";case"othergoodsamt":return"他店提貨券";case"oldgoodsamt":return"舊提貨券";case"bankpointsamt":return"銀行紅利";case"discountamt":return"折價券";case"shoppingamt":return"消費券";case"creditamt":return"賒帳";case"fbamt":return"還元金";case"invoicerewamt":return"發票兌獎";case"couponchange":return"提貨卷找零";case"excessamt":return"溢收金額";case"linepay":return"LinePay";case"creditcard":return"信用卡";case"cashchange":return"現金找零";default:return""}}}],[{key:"bargain",value:function(t,e){var r=this.checkBargainPrice(t,e);if(r.result){var a={priceChangeFlag:"1",unitRefundReasonNo:t.reasonOption.reasonID,reasonNo:t.reasonOption.reasonID,refunderID:t.account,competitorAmt:t.competitorAmt,competitorNo:t.competitorNo};return t.shopItem.price.normalAmt=t.inputPrice,Object.assign(t.shopItem.refund,a),{result:!0,msg:"變價成功",data:t}}return r}},{key:"checkBargainPrice",value:function(t,e){var r,a=t.product;return"service"===e?{result:!0,msg:""}:(void 0!==t.competitorAmt&&1*t.competitorAmt>=0?(r=1*t.competitorAmt,r>0&&(r-=1)):r=void 0!==a.minPrice&&1*a.minPrice>0?1*a.minPrice:1*t.reasonOption.disLimit>0?Math.ceil(a.price*(1*t.reasonOption.disLimit/100)):void 0!==a.vipPrice&&1*a.vipPrice>0?1*a.vipPrice:a.price,1*t.inputPrice>=r?{result:!0,msg:""}:{result:!1,msg:"金額不得低於".concat(r)})}}]),t}();function be(t,e,r){var a=0,o=!1,n=!1,i=!1,s=!1,c=t.items.length,l="";t.items.forEach((function(t){t.quantity<=0?i=!0:t.quantity>99999?n=!0:isNaN(t.quantity)&&(s=!0),e?t.price.vipAmt*t.quantity>9999999&&(o=!0):t.price.normalAmt*t.quantity>9999999&&(o=!0),a+=Number(e?t.price.vipAmt*t.quantity:t.price.normalAmt*t.quantity)})),s?l="購物車中 有商品數量不為數字":c>99?l="品項數量不得超過９９項":i?l="購物車中 有商品數量小於１":n?l="單項商品數量大於十萬":a>99999999?l="商品金額總計大於一億":0===a&&"agent"!==r?l="商品金額總計不得為0":o?l="單項商品金額大於一千萬":0===t.items.length&&(l="無結帳商品");var u={result:!0,Msg:""};return""!==l&&(u.result=!1,u.Msg=l),u}function ve(t,e,r,a,o){var n=new tt["f"],i=0,s=0;t.items.forEach((function(t,r){var a=ge(t,e,r,o);n.data.push(a.detail),i+=a.promotionDiscountAmount,"T"!==a.detail.mmType&&(s+=a.promotionDiscountAmount)})),console.log(t),n.header.payment.promotionDiscountAmount=i,n.header.payment.totalDiscountAmount=s,n.opFunc="agent"===o?"P":"4",n.header.deliverNo=t.deliverNo.toString(),n.header.itemQty=n.data.length,n.header.receipt.receiptCounter=1,n.header.receipt.taxFreeReceiptCounter=1,n.header.sellerNo=t.saler.id,n.header.receipt.GUINo=t.VAT_Number,e.CustNo&&(n.header.customer.customerCount=1,n.header.customer.memberID=e.CustNo,n.header.customer.memberTel=e.MobileNo),n.header.customer.name=e.CustName,n.header.customer.mobile=e.MobileNo,n.header.customer.address=e.address,n.header.customer.address2=e.address2,n.header.payment.subtotal=_e(e.status,t.items),n.header.receipt.receiptAmt=n.header.payment.subtotal;var c=n.header.payment.subtotal;r.forEach((function(t){if(n.header.payment.hasOwnProperty(t.type))switch(t.type){case"creditCard":n.header.payment[t.type]=t.detail,c-=t.amount;break;case"cashChange":n.header.payment[t.type]=t.amount;break;default:n.header.payment[t.type]=t.amount,c-=t.amount;break}})),n.header.payment.cash+=c;var l=0;r.forEach((function(t){if(n.header.payment.hasOwnProperty(t.type)&&!we(t.type)){var e;switch(t.type){case"creditCard":e=n.header.payment[t.type].creditCardAmt;break;default:e=n.header.payment[t.type];break}var r=Math.round(e/1.05);n.header.receipt.tax+=e-r,l+=Number(t.amount)}})),void 0!==a&&(n.header.receipt.donateReceipt=a.donate?"Y":"N",n.header.receipt.printReceipt=!0!==a.print||a.donate?"N":"Y",0===l&&(n.header.receipt.printReceipt="N"),"agent"===o&&(n.header.receipt.donateReceipt="N",n.header.receipt.printReceipt="N"),n.printerNo=a.printerNo,n.termNo=a.termNo,n.storeNo=a.storeNo,n.header.cashierNo=a.cashierNo,n.header.receipt.receiptNo=a.receiptNo,n.header.receipt.commCode=a.commcode,n.header.receipt.MOICANo=a.MOICANo,n.header.receipt.passportNo=a.passportNo,n.header.receipt.heartCode=a.heartcode,n.serialNo=(Array(5).join("0")+1*a.serialNo).slice(-5),n.header.repairNo=a.serviceNo,n.header.opFuncSub=a.opFunc),n.data=ye(n);var u=n.header.receipt.tax-n.data.reduce((function(t,e){return(void 0===t.price?t:t.price.qtyTaxAmt)+e.price.qtyTaxAmt}));return isNaN(u)||(n.data[0].price.qtyTaxAmt+=u),n}function ye(t){var e=t.data,r=t.header.receipt.tax,a=t.header.payment.subtotal,o={},n={},i={},s={};e.forEach((function(t){void 0===o[t.promoteID]?o[t.promoteID]=[t]:o[t.promoteID].push(t)}));var c=function(t){n[t]=0,i[t]=0,o[t].forEach((function(e){"T"!==e.taxFreeFlag&&"促銷"!==e.pluNo||(n[t]+=e.price.taxIncludeAmt,"促銷"!==e.pluNo&&(i[t]+=e.price.taxIncludeAmt+e.price.mmShareDiscountAmt))})),n[t]<0&&(n[t]=0),s[t]=Math.round(r*n[t]/a)};for(var l in o)c(l);var u=r;for(var d in s)u>s[d]?u-=s[d]:(s[d]=u,r=0);var p=function(t){var r=s[t];e.forEach((function(e){e.promoteID===t&&"T"===e.taxFreeFlag&&"促銷"!==e.pluNo&&(e.price.qtyTaxAmt=Math.round(s[t]*(e.price.taxIncludeAmt+e.price.mmShareDiscountAmt)/i[t]),r>e.price.qtyTaxAmt?r-=e.price.qtyTaxAmt:(e.price.qtyTaxAmt=r,r=0))}))};for(var m in o)p(m);return e}function ge(t,e,r,a){var o=new tt["e"],n=0;for(var i in t)if("object"===Object(st["a"])(t[i])&&o.hasOwnProperty(i))for(var s in t[i])o[i].hasOwnProperty(s)&&(o[i][s]=t[i][s]);else o.hasOwnProperty(i)&&(o[i]=t[i]);return"促銷"===t.pluNo?(n+=t.price.taxIncludeAmt,o.storeBounds=t.storeBounds*t.quantity):(!t.mmType&&"D"===t.priceType||"F"===t.mmType||"F"===t.mmGroupType)&&(n+=(t.price.vipAmt-t.price.normalAmt)*t.quantity,o.price.vipAmt=0),t.price.mmShareDiscountAmt||(o.price.mmShareDiscountAmt=0),Object.assign(o.refund,t.refund),e.CustNo&&!o.refund.priceChangeFlag?"F"!==t.mmGroupType&&"D"!==t.priceType&&(o.price.normalAmt=o.price.vipAmt):o.priceType="N",o.price.vipAmt=0,"促銷"===t.pluNo&&"T"===t.mmType||(o.price.taxIncludeAmt=o.price.normalAmt*o.quantity),"N"!==t.mmType&&t.mmType||0!==t.price.mmShareDiscountAmt||("促銷"!==t.pluNo&&t.promoteID&&"T"!==t.mmType?o.price.salesPromotionAmt=o.price.taxIncludeAmt+o.price.mmShareDiscountAmt:o.salesPromotionQuantity=0),"T"!==o.taxFreeFlag||o.promoteID||(o.price.qtyTaxAmt=o.price.taxIncludeAmt-Math.round(o.price.taxIncludeAmt/1.05)),"agent"===a?(o.barcode1=t.barcode1,o.barcode2=t.barcode2,o.barcode3=t.barcode3):(o.barcode1="",o.barcode2=""),o.detailCode=t.detailCode,o.detailID=Ne(r+1,3),Array.isArray(t.warranty)||null===t.warranty?o.warranty={}:o.warranty.warrantyPluSeq=Ne(t.warranty.warrantyPluSeq,3),{promotionDiscountAmount:n,detail:o}}function we(t){switch(t){case"cash":case"PGAmt":case"shoppingAmt":case"creditAmt":case"creditCard":case"ecPaymentAmt":return!1;case"TKGoodsAmt":case"otherGoodsAmt":case"bankPointsAmt":case"discountAmt":case"FBAmt":return!0;default:return!0}}function _e(t,e){var r=0,a=e.map((function(e){return!0===t&&"1"!==e.refund.priceChangeFlag?Number(e.price.vipAmt)*Number(e.quantity):Number(e.price.normalAmt)*Number(e.quantity)}));return a.every((function(t){return isNaN(t)}))||(r=a.reduce((function(t,e){var r=Number(e);return isNaN(r)?t:t+e}),0)),r}function ke(t,e){var r=!1,a=!1,o=!1,n=!1,i=!1,s={},c="",l="",u=t.items.length;t.items.forEach((function(t){t.quantity<1&&(r=!0),t.quantity>99999&&(o=!0),e>9999999&&(n=!0),isNaN(t.quantity)&&(a=!0),!t.mmType&&"D"===t.priceType&&t.limitQTY>0&&(i=!0,s=t,c="1"===s.limitType?"門市":"總部",l="1"===s.limited?"（一卡一品） ":" ")}));var d={errorMsg:"",errorType:"",errorTitle:""};return e>99999999?(d.errorMsg="單筆交易 金額總計不得超過一億",d.errorType="error",d.errorTitle="商品輸入錯誤"):o?(d.errorMsg="單項數量不得大於９９９９９項",d.errorType="error",d.errorTitle="商品輸入錯誤"):u>99?(d.errorMsg="品項數量不得大於９９項",d.errorType="error",d.errorTitle="商品輸入錯誤"):r&&e>99999999?(d.errorMsg="單品項 數量不得小於１，單筆交易 金額總計不得超過一億",d.errorType="error",d.errorTitle="商品輸入錯誤"):r?(d.errorMsg="單品項 數量不得小於１",d.errorType="error",d.errorTitle="商品輸入錯誤"):a?(d.errorMsg="數量 不得填入０～９以外之字元",d.errorType="error",d.errorTitle="商品輸入錯誤"):n?(d.errorMsg="單項金額 不得大於一千萬",d.errorType="error",d.errorTitle="商品輸入錯誤"):i?(d.errorMsg="".concat(c,"限量").concat(l,"<").concat(s.limitQTY,"/").concat(s.limitQTY,">"),d.errorType="warning",d.errorTitle="限量特價"):(d.errorMsg="",d.errorType="",d.errorTitle=""),d}function Ne(t,e){return t.length>=e?t:Ne("0"+t,e)}var Ce=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"轉櫃台結帳",visible:t.dialogVisible,"before-close":t.beforeClose,"show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("div",[r("el-row",{staticStyle:{overflow:"auto","padding-bottom":"20px"}},[r("el-col",{attrs:{shadow:"never",span:24}},[r("span",{staticStyle:{color:"white","font-size":"20px"}},[t._v("訂單保留時間")]),t._v(" "),r("el-date-picker",{attrs:{type:"date",placeholder:"選擇到期時間","picker-options":t.pickerOptions},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)],1),t._v(" "),r("el-row",{staticStyle:{overflow:"auto","padding-bottom":"20px"}},[r("el-col",{attrs:{shadow:"never",span:24}},[r("span",{staticStyle:{color:"#ffe30a","font-size":"14px"}},[t._v("訂單保留時間預設為當營業日，保留時間無法超過訂單內促銷商品時間")])])],1),t._v(" "),r("el-row",{staticStyle:{overflow:"auto"}},[r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"large"},on:{click:function(e){return t.submit()}}},[t._v("確認送出")])],1),t._v(" "),r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",size:"large"},on:{click:function(e){return t.beforeClose()}}},[t._v("取消")])],1)],1)],1)])},De=[],Ie=r("50c1"),Pe=r("b656"),Oe={inject:["reload"],name:"TransoDialog",props:{dialogVisible:{type:Boolean,required:!1},clearPayInfo:{type:Function,default:function(){}},payData:{type:Array,default:function(){return[]}},shopCart:{type:Object,default:function(){return new tt["c"]}}},data:function(){return{showModel:"",testModel:!1,finish:!1,date:"",pickerOptions:{}}},computed:Object(n["a"])({},Object(i["c"])({memberInfo:function(t){return t.member},user:function(t){return t.user},products:function(t){return t.product.salesProducts},payInfo:function(t){return t.payInfo}}),{},Object(i["b"])(["pos_tab","termNo","serialNo","memberInfo","invoice","storeNo","businessDate"])),created:function(){this.date=this.businessDate},mounted:function(){this.pickerOptions.disabledDate=this.dateRange},methods:{submit:function(){var t=this,e=ve(this.shopCart,this.memberInfo,this.payData,{donate:this.donate,print:this.print,printerNo:"2",termNo:this.termNo,storeNo:this.storeNo,cashierNo:this.user.userId,receiptNo:this.invoice,serialNo:this.serialNo},this.pos_tab);e.header.payment.creditCard.bankNo=this.payInfo.info.credit.bankNo,e.header.payment.creditCard.installmentID=this.payInfo.info.credit.installmentID,e.header.payment.creditCard.installmentNumber=this.payInfo.info.credit.installmentNumber,"string"===typeof this.date?e.expiryDate=this.date:e.expiryDate="".concat(this.date.getFullYear()).concat((Array(2).join("0")+(1*this.date.getMonth()+1)).slice(-2)).concat((Array(2).join("0")+this.date.getDate()).slice(-2)),e.expiryDate=e.expiryDate.replaceAll("/",""),this.testModel?(this.showModel=e,this.donate=!1,this.print=null,this.$store.dispatch("order/clearData"),this.clearPayInfo(),this.finish=!0):(this.$nextTick((function(){t.checkout(e)})),this.$emit("update:dialogVisible",!1))},beforeClose:function(){this.$emit("update:dialogVisible",!1),this.finish&&this.reload()},checkout:function(t){var e=this;return new Promise((function(r,a){Object(Pe["d"])(JSON.stringify(t)).then((function(t){e.$message({showClose:!0,message:"轉SO單成功\n配達單號:".concat(t.deliverNo.toString()),duration:15e3,type:"success"}),e.finish=!0,e.reload(),r()})).catch((function(t){e.$message({type:"error",message:t.message,closable:"true"}),a(t.message)})).finally((function(){e.donate=!1,e.print=null,e.clearPayInfo()}))}))},dateRange:function(t){var e,r=new Date(this.businessDate),a=Object(Ie["f"])(this.shopCart);return a.forEach((function(t){var r=new Date(t.endDate.replace(/(\d{4})(\d{2})(\d{2})/g,"$1/$2/$3"));(void 0===e||e.getTime()>r.getTime())&&(e=r)})),t.getTime()<r.getTime()||void 0!==e&&t.getTime()>e.getTime()}}},xe=Oe,je=Object(q["a"])(xe,Ce,De,!1,null,null,null),Se=je.exports,Te=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"配達資料",visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("div",[r("el-card",[r("el-form",{attrs:{"label-position":"left"},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}},[r("el-form-item",{attrs:{label:"姓名"}},[r("el-input",{staticStyle:{width:"50%"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"聯絡市話"}},[r("el-input",{staticStyle:{width:"50%"},attrs:{inputmode:"numeric",type:"number"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"聯絡手機"}},[r("el-input",{staticStyle:{width:"50%"},attrs:{inputmode:"numeric",type:"number"},model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"地址"}},[r("el-select",{attrs:{placeholder:"請選擇"},on:{change:t.cityOnChange},model:{value:t.form.city,callback:function(e){t.$set(t.form,"city",e)},expression:"form.city"}},t._l(t.citydata,(function(t,e){return r("el-option",{key:e,attrs:{label:t.city,value:e}})})),1),t._v(" "),r("el-select",{attrs:{placeholder:"請選擇"},on:{change:t.areaOnChange},model:{value:t.form.area,callback:function(e){t.$set(t.form,"area",e)},expression:"form.area"}},[t._v(">\n            "),t._l(t.tempAreaData,(function(t,e){return r("el-option",{key:e,attrs:{label:t.city_area,value:e}})}))],2),t._v(" "),r("el-select",{attrs:{placeholder:"請選擇"},on:{change:t.streetOnChange},model:{value:t.form.street,callback:function(e){t.$set(t.form,"street",e)},expression:"form.street"}},[t._v(">\n            "),t._l(t.tempStreetData,(function(t,e){return r("el-option",{key:e,attrs:{label:t.city_area_street,value:e}})}))],2),t._v(" "),r("el-input",{staticStyle:{width:"50%"},model:{value:t.form.address2,callback:function(e){t.$set(t.form,"address2",e)},expression:"form.address2"}})],1)],1)],1),t._v(" "),r("el-row",{staticStyle:{overflow:"auto"}},[r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"large"},on:{click:function(e){return t.submit()}}},[t._v("確認送出")])],1),t._v(" "),r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",size:"large"},on:{click:function(e){return t.beforeClose()}}},[t._v("略過")])],1)],1)],1)])},$e=[],Ae={name:"DeliverData",props:{dialogVisible:{type:Boolean,required:!0},checkData:{type:Boolean,required:!0},fetchSo:{type:Function,default:function(){}}},data:function(){return{citydata:[],tempAreaData:[],tempStreetData:[],form:{area:void 0,city:void 0,street:void 0,address2:void 0,mobile:void 0,name:void 0,phone:void 0}}},computed:Object(n["a"])({},Object(i["c"])({memberInfo:function(t){return t.member}})),watch:{memberInfo:{handler:function(t){this.form.mobile=this.memberInfo.MobileNo,this.form.name=this.memberInfo.CustName,this.form.phone=this.memberInfo.MobileNo},deep:!0}},created:function(){this.fetchCity(),this.form.mobile=this.memberInfo.MobileNo,this.form.name=this.memberInfo.CustName,this.form.phone=this.memberInfo.MobileNo},methods:{submit:function(){var t={address:this.$data.form.city+this.$data.form.area+this.$data.form.street,address2:this.$data.form.address2,CustName:this.$data.form.name,MobileNo:this.$data.form.mobile,memberTel:this.$data.form.phone};this.$store.dispatch("member/memberUpdate",t),console.log(this.memberInfo),this.beforeClose(),this.fetchSo()},fetchCity:function(){var t=this;T().then((function(e){t.citydata=e.ReturnList})).catch((function(t){console.log(t)}))},beforeClose:function(){this.$emit("update:dialogVisible",!1),this.$emit("update:checkData",!0),this.fetchSo()},cityOnChange:function(t){this.tempAreaData=this.citydata[t].area,this.$data.form.city=this.citydata[t].city,this.$data.form.area=void 0,this.$data.form.street=void 0},areaOnChange:function(t){this.tempStreetData=this.tempAreaData[t].street,this.$data.form.area=this.tempAreaData[t].city_area,this.$data.form.street=void 0},streetOnChange:function(t){this.$data.form.street=this.tempStreetData[t].city_area_street}}},Me=Ae,Fe=Object(q["a"])(Me,Te,$e,!1,null,null,null),Ee=Fe.exports,Le=r("ecbd"),qe=new Le["a"]("order","data"),Ve={inject:["reload"],name:"CheckoutDrawer",components:{ticketDialog:Z,invoiceDialog:ot,paybackDialog:Dt,paymentInputDialog:St,creditCard:fe,SoDialog:Se,DeliverDataDialog:Ee},props:{showDrawer:{type:Boolean,default:!1},openPromotion:{type:Function,default:function(){}},shopCart:{type:Object,default:function(){return new tt["c"]}},posType:{type:String,default:""}},data:function(){return{memberID:null,phone:null,idCardNum:null,form:{ticket:!0,app:!1,payback:!1},formData:[],dialog:{showTicketDialog:!1,showInvoiceDialog:!1,showPaybackDialog:!1,showInputDialog:!1,showCreditCardDialog:!1,inputType:"cash"},ticketInfo:{},payableAmt:0,remainAmt:0,errorMsg:"",postmessage:{},showTranSoDialog:!1,checkInstall:!0,showDeliverDataDialog:!1,checkDeliverData:!1,popoverVisible:!1,opFunc:"",canUseCreditCard:!0}},computed:Object(n["a"])({},Object(i["c"])({user:function(t){return t.user},systemInfo:function(t){return t.systemInfo},memberInfo:function(t){return t.member},payInfo:function(t){return t.payInfo},creditPercent:function(t){return t.systemInfo.creditPercent},invoiceInfo:function(t){return t.order.invoice},payback:function(t){return t.payback},privilege:function(t){return t.permission.modulesPrivilege.modules.payment}}),{},Object(i["b"])(["pos_tab","termNo","businessDate","storeNo","invoice","serialNo","serviceNo","opFuncSub","agentInfo"])),watch:{"shopCart.items":{handler:function(t){this.payableAmt=_e(this.memberInfo.status,t),this.remainAmt=this.calcRemainingAmount()},deep:!0},memberInfo:{handler:function(t){this.payableAmt=_e(t.status,this.shopCart.items),this.remainAmt=this.calcRemainingAmount()},deep:!0},payInfo:{handler:function(){this.payableAmt=_e(this.memberInfo.status,this.shopCart.items),this.remainAmt=this.calcRemainingAmount(),1===this.payInfo.info.credit.installmentNumber?this.checkInstall=!0:this.checkInstall=!1},deep:!0},remainAmt:function(t){var e=this;this.showDrawer&&this.$nextTick((function(){e.autoSubmit()}))},showDrawer:function(){var t=this;this.showDrawer&&this.$nextTick((function(){t.payableAmt=_e(t.memberInfo.status,t.shopCart.items),t.remainAmt=t.calcRemainingAmount(),t.autoSubmit(),"agent"!==t.pos_tab&&(t.dialog.showInvoiceDialog=!0)}))}},created:function(){var t=this;if("Y"===this.shopCart.isPaid){if(this.shopCart.payment.ecPaymentAmt>0){var e=new Y["e"];e.type="ecPaymentAmt",e.name="網銷信用卡",e.amount=Math.abs(this.shopCart.payment.ecPaymentAmt),this.addPayInfo(e),this.canUseCreditCard=!1,this.checkInstall=!1}if(this.shopCart.payment.pointsAmt>0){var r=new Y["e"];r.type="pointsAmt",r.name="網銷購物金",r.amount=Math.abs(this.shopCart.payment.pointsAmt),this.addPayInfo(r)}}"0"===this.agentInfo.allowCreditCard&&(this.canUseCreditCard=!1);var a={label:"支付方式",item:[]};if("FoodPanda"!==this.pos_tab)for(var o in this.privilege)if(this.privilege[o])switch(o){case"Coupon":this.formData.push({label:"優惠券",item:[{name:"他店提貨券",event:function(){return t.ticket(0)}},{name:"折價券",event:function(){return t.ticket(1)}},{name:"提貨券",event:function(){return t.ticket(2)}},{name:"他店禮券",event:function(){return t.ticket(3)}}]});break;case"Payback":this.formData.push({label:"還元金",item:[{name:"還元金",visible:!0,event:function(){return t.onPayback()}}]});break;case"CreditCard":this.canUseCreditCard&&a.item.push({name:"信用卡",visible:!0,event:function(){t.dialog.showCreditCardDialog=!0}});break;case"Cash":a.item.push({name:"現金",visible:!0,event:function(){t.dialog.showInputDialog=!0,t.dialog.inputType="cash"}});break}"delivery"!==this.pos_tab&&"FoodPanda"!==this.pos_tab||a.item.push({name:"賒帳",event:function(){if("FoodPanda"!==t.pos_tab){var e=[46,49],r=1*t.businessDate.split("/")[2];if(25===r&&""!==t.shopCart.VAT_Number&&!e.includes(1*t.termNo))return void t.$message({type:"error",message:"25號打統編不可賒帳,特殊機台除外(46,49,35)",closable:"true"})}t.dialog.showInputDialog=!0,t.dialog.inputType="creditAmt"}}),this.formData.push(a)},methods:{calcAmount:_e,drawerHandleClose:function(){this.$emit("update:showDrawer",!1)},calcRemainingAmount:function(){var t=_e(this.memberInfo.status,this.shopCart.items);return this.payInfo.data.forEach((function(e){"cashChange"===e.type?t+=e.amount:t-=e.amount})),t},ticket:function(t){this.ticketInfo={name:this.formData[0].item[t].name},this.dialog.showTicketDialog=!0},appDiscount:function(){},onPayback:function(){this.memberInfo.status?this.dialog.showPaybackDialog=!0:this.errorMsg="無登入會員"},addPayInfo:function(t){switch(t.amount=Number(t.amount),t.type){case"FBAmt":if(!1===this.checkInstall&&t.amount>this.remainAmt-1)return this.$message({type:"error",message:"已使用分期不可全額使用還原金折抵",closable:"true"}),!1;if(t.amount>this.remainAmt)return this.$message({type:"error",message:"使用還元金不得超出剩餘金額",closable:"true"}),!1;break;case"creditAmt":if(this.shopCart.payment.debit>0){if(this.shopCart.payment.debit<t.amount)return this.$message({type:"error",message:"超出賒帳比例",closable:"true"}),!1}else if(this.creditPercent/100<t.amount/_e(this.memberInfo.status,this.shopCart.items))return this.$message({type:"error",message:"超出賒帳比例",closable:"true"}),!1;break}this.$store.dispatch("payInfo/insertPayData",t),this.remainAmt=this.calcRemainingAmount()},clearPayInfo:function(){this.$store.dispatch("payInfo/clearPayData")},submit:function(){var t=this;if(1!==this.payInfo.info.credit.installmentNumber&&void 0!==this.payInfo.info.credit.installmentNumber){var e=this.payInfo.data.filter((function(t){if("creditCard"===t.type&&void 0!==t.detail.installmentID)return!0}));if(0===e.length)return void(this.errorMsg="未使用信用卡分期")}this.calcRemainingAmount()>0?this.errorMsg="金額未收足":this.$nextTick((function(){var e=ve(t.shopCart,t.memberInfo,t.payInfo.data,{donate:t.invoiceInfo.donate,print:t.invoiceInfo.print,printerNo:t.systemInfo.printerNo,termNo:t.termNo,storeNo:t.storeNo,cashierNo:t.user.userId,receiptNo:t.invoice,commcode:t.invoiceInfo.commcode,MOICANo:t.invoiceInfo.MOICANo,passportNo:t.invoiceInfo.passportNo,heartcode:t.invoiceInfo.heartcode,serialNo:t.serialNo,serviceNo:t.serviceNo,opFunc:t.opFuncSub},t.pos_tab);if(void 0!==t.payback.UseAmt){var r=t.usePayback();r.then((function(){t.checkout(e)}))}else t.checkout(e)}))},giveChange:function(){var t=new Y["e"];t.type="cashChange",t.name="找零",t.amount=Math.abs(this.remainAmt),this.addPayInfo(t),this.remainAmt=this.calcRemainingAmount()},autoSubmit:function(){this.showDrawer&&0===this.remainAmt&&(this.$message({type:"success",message:"金額已收足，請等待結帳程序完成",closable:"true"}),this.submit())},alertClose:function(){this.errorMsg=""},remove:function(t){"payback"===this.payInfo.data[t].type&&this.$store.dispatch("payback/clearPayback"),this.$store.dispatch("payInfo/removePayDataByIdx",t)},toggleTransSoDrawer:function(){var t=be(this.shopCart,this.memberInfo.status,this.pos_tab);t.result?0===this.payInfo.data.length?this.showTranSoDialog=!0:this.$message({showClose:!0,message:"已使用其他付款方式",type:"warning"}):this.$message({showClose:!0,message:t.Msg,type:"warning"})},toggleDeliverDataDialog:function(){this.showDeliverDataDialog=!0},usePayback:function(){var t=this;return new Promise((function(e,r){void 0!==t.payback.pincode?pt(JSON.stringify(t.payback)).then((function(t){1===t.result?e():r(t.message)})).catch((function(e){t.$message({type:"error",message:e.message,closable:"true"}),r(e.message)})):ut(JSON.stringify(t.payback)).then((function(t){1===t.result?e():r(t.message)})).catch((function(e){t.$message({type:"error",message:e.message,closable:"true"}),r(e.message)}))}))},checkout:function(t){var e=this;return new Promise((function(r,a){Object(Pe["g"])(JSON.stringify(t)).then((function(t){var a=vt["Loading"].service({fullscreen:!0,lock:!0,background:"rgba(0, 0, 0, 0.8)",text:"交易進行中"});t.transactionStatus?(qe.set(t.serialNo,e.memberInfo.CustNo),e.$message({type:"success",message:"結帳成功",closable:"true"}),e.finish=!0,e.clearPayInfo(),e.$store.dispatch("order/update",{invoice:{donate:!1,print:!1,heartcode:"",commcode:"",ecInvoice:"",MOICANo:"",passportNo:""}}),e.reload()):alert(t.message),a.close(),e.drawerHandleClose(),e.reload(),"FoodPanda"===e.pos_tab&&F.Login("77978996"),r()})).catch((function(t){e.$message({type:"error",message:t.message,closable:"true"}),a(t.message)}))}))}}},Re=Ve,ze=(r("b615"),Object(q["a"])(Re,z,B,!1,null,"c0e555d4",null)),Be=ze.exports,Ue=function(){var t=this,e=this,r=e.$createElement,a=e._self._c||r;return a("div",[a("el-drawer",{attrs:{title:"新增商品",visible:e.showDrawer,"with-header":!1,direction:"ttb",size:"auto",modal:!0,"before-close":e.drawerHandleClose},on:{"update:visible":function(t){e.showDrawer=t}}},[a("div",[""!=e.productError?a("el-alert",{attrs:{title:e.productError,type:"error",center:"","show-icon":"",closable:!1}}):e._e(),e._v(" "),a("el-form",[a("el-form-item",[a("el-input",{ref:"pidInput",staticStyle:{width:"50%"},attrs:{inputmode:"numeric",placeholder:"貨號/國際碼/店內碼",maxlength:13},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.getProduct())}},model:{value:e.inputPid,callback:function(t){e.inputPid=t},expression:"inputPid"}}),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(){e.inputPid="",t.$refs.pidInput.focus()}}},[e._v("清除")])],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.getProduct()}}},[e._v("確定")])],1)],1)],1)]),e._v(" "),a("ParaDialog",{attrs:{"dialog-visible":e.onParaDialog,callback:e.ParaDialogCallback,regulation:e.regulation,pid:e.inputPid},on:{"update:dialogVisible":function(t){e.onParaDialog=t},"update:dialog-visible":function(t){e.onParaDialog=t}}})],1)},Ge=[],Qe=(r("6c7b"),r("f576"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),r("el-form",{ref:"inputForm",attrs:{"label-position":"left"}},[r("el-row",[r("el-col",{attrs:{span:23,offset:0}},[void 0!==t.parastore.renderWord?r("el-form-item",{attrs:{label:t.parastore.renderWord}},[r("el-input",{ref:"para_ipt",staticStyle:{width:"70%"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submit(e))}},model:{value:t.inputCardNo,callback:function(e){t.inputCardNo=e},expression:"inputCardNo"}}),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clear()}}},[t._v("清除")])],1):t._e(),t._v(" "),void 0!==t.socket3.renderWord?r("el-form-item",{attrs:{label:t.socket3.renderWord}},[r("el-input",{ref:"para_ipt",staticStyle:{width:"70%"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submit(e))}},model:{value:t.inputPluSerialNo,callback:function(e){t.inputPluSerialNo=e},expression:"inputPluSerialNo"}}),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clear()}}},[t._v("清除")])],1):t._e()],1)],1),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("確認")])],1)],1)],1)],1)}),Ye=[],He={name:"ParaDialog",props:{dialogVisible:{type:Boolean,required:!1},callback:{type:Function,default:function(){}},regulation:{type:Array,default:function(){return[]}},pid:{type:String,default:function(){return""}}},data:function(){return{socket3:{},parastore:{},inputCardNo:"",inputPluSerialNo:"",errorMsg:"",postdata:{SeqNo:"",ItemNo:""},ShopCart:null}},computed:Object(n["a"])({},Object(i["c"])({salesShopCart:function(t){return t.order.salesOrder}})),watch:{regulation:function(t){this.filter()}},created:function(){this.shopCart=this.salesShopCart},updated:function(){this.$nextTick((function(){this.dialogVisible&&this.$refs.para_ipt.focus()}))},methods:{beforeClose:function(){this.inputCardNo="",this.inputPluSerialNo="",this.socket3={},this.parastore={},this.callback(this.inputCardNo,this.inputPluSerialNo),this.$emit("update:dialogVisible",!1)},clear:function(){this.inputCardNo="",this.inputPluSerialNo=""},filter:function(){var t=this;this.regulation.forEach((function(e){!1===e.checkSeq&&(t.parastore=e),!0===e.checkSeq&&(t.socket3=e)}))},checkSerialNoExist:function(t){var e=!1;return this.shopCart.items.forEach((function(r){r.keyinSeq1===t&&(e=!0)})),!!e},checkCardNoExist:function(t){var e=!1;return this.shopCart.items.forEach((function(r){r.keyinSeq3===t&&(e=!0)})),!!e},submit:function(){var t=this;if("215840"===this.pid){var e=new RegExp(/^\S{4}-\S{4}$/);if(!e.test(this.inputCardNo))return void this.$message({showClose:!0,message:'FoodPanda訂單編號輸入錯誤，訂單編號第5碼為"-"且長度為9碼',duration:6e3,type:"warning"})}if(this.postdata.SeqNo=this.inputPluSerialNo,this.postdata.ItemNo=this.pid,void 0!==this.socket3.checkSeq&&this.checkSerialNoExist(this.inputPluSerialNo))return this.$message({showClose:!0,message:"序號已存在",type:"warning"}),this.inputPluSerialNo="",!1;if(void 0!==this.parastore.checkSeq){if(""===this.inputCardNo)return this.$message({showClose:!0,message:"請輸入序號",type:"warning"}),this.inputCardNo="",!1;if(this.checkCardNoExist(this.inputCardNo))return this.$message({showClose:!0,message:"序號已存在",type:"warning"}),this.inputCardNo="",!1}void 0!==this.socket3.checkSeq&&Object(C["d"])(this.postdata).then((function(e){null===e?t.errorMsg="查無序號":(t.callback(t.inputCardNo,t.inputPluSerialNo,"checkPluSerialNo"),t.inputCardNo="",t.inputPluSerialNo="",t.socket3={},t.parastore={})})).catch((function(){t.inputPluSerialNo=""})),void 0!==this.parastore.checkSeq&&(this.callback(this.inputCardNo,this.inputPluSerialNo,"checkCardNo"),this.inputCardNo="",this.inputPluSerialNo="",this.socket3={},this.parastore={})}}},We=He,Je=Object(q["a"])(We,Qe,Ye,!1,null,null,null),Ze=Je.exports,Xe={name:"AddGoodsDrawer",components:{ParaDialog:Ze},props:{showDrawer:{type:Boolean,default:!1},addGoods:{type:Function,default:function(){}},promote:{type:Function,default:function(){}},pid:{type:String,default:""}},data:function(){return{inputPid:"",selectVal:1,productError:"",onParaDialog:!1,regulation:[],product:null,promotionQueueNo:1}},computed:Object(n["a"])({},Object(i["b"])(["memberInfo"])),watch:{pid:function(t){""!==t&&this.$nextTick((function(){this.inputPid=t,this.getProduct()}))}},updated:function(){this.$nextTick((function(){this.showDrawer&&!this.onParaDialog&&this.$refs.pidInput.focus()}))},methods:{calcMMQty:function(t){if(0===t.length)return 0;var e=0;return t.forEach((function(t){"F"!==t.mmType&&(e+=1)})),Number(e)},getProduct:function(){var t=this;this.$refs.pidInput.focus(),""!==this.inputPid.trim()&&(this.inputPid.length>6&&this.inputPid.length<13&&(this.inputPid=this.inputPid.padStart(13,"0")),Object(C["a"])(this.inputPid,"").then((function(e){null===e.data?t.productError="商品代碼錯誤":(t.productError="",0===e.regulation.length?(t.addGoods(e,1,t.promotionQueueNo++),t.$message({showClose:!0,message:"商品已加入購物車",type:"success"}),t.inputPid="",t.memberInfo.status&&t.calcMMQty(e.mm)>0&&t.promote(e,t.promotionQueueNo-1)):(t.regulation=e.regulation,t.onParaDialog=!0,t.product=e))})).finally((function(){t.$emit("update:pid","")})))},drawerHandleClose:function(t){this.$emit("update:showDrawer",!1),this.productError=""},getNumbers:function(t,e){return new Array(e-t+1).fill(t).map((function(t,e){return t+e}))},clear:function(){this.inputPid=""},ParaDialogCallback:function(t,e,r){this.onParaDialog=!1,""===t&&"checkCardNo"===r||""===e&&"checkPluSerialNo"===r||""===t&&""===e?this.$message({showClose:!0,message:"商品取消",type:"warning"}):(this.product.keyinSeq1=e,this.product.keyinSeq3=t,this.addGoods(this.product,1,this.promotionQueueNo++)),this.inputPid="",this.product=null}}},Ke=Xe,tr=Object(q["a"])(Ke,Ue,Ge,!1,null,null,null),er=tr.exports,rr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"取消交易退款確認",visible:t.dialogVisible,"before-close":t.beforeClose,center:"",modal:!0,"modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-form",[t._l(t.payInfo.data,(function(e){return r("el-form-item",{key:e.id,attrs:{label:e.name}},[r("span",{staticStyle:{"font-size":"20px",color:"white"}},[t._v(t._s(t._f("toCurrency")(e.amount)))]),t._v(" "),r("el-divider")],1)})),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("取消交易")])],1)],2)],1)},ar=[],or={name:"PaymentRefund",props:{dialogVisible:{type:Boolean,required:!1}},computed:Object(n["a"])({},Object(i["c"])({payInfo:function(t){return t.payInfo}})),update:function(){},methods:{submit:function(){this.beforeClose()},beforeClose:function(){this.$emit("update:dialogVisible",!1)}}},nr=or,ir=(r("41bd"),Object(q["a"])(nr,rr,ar,!1,null,"55d831b3",null)),sr=ir.exports,cr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"分期設定",visible:t.showDialog,"before-close":t.beforeClose,width:"70%",center:"",modal:!0,"modal-append-to-body":!1},on:{"update:visible":function(e){t.showDialog=e}}},[0===t.installmentOptions.length?r("div",[!0===t.installment?r("el-card",{staticClass:"box-card",staticStyle:{height:"500px","overflow-y":"scroll"}},t._l(t.bankList,(function(e){return r("el-row",{key:e.key,staticClass:"row-bg",attrs:{type:"flex"}},t._l(e.item,(function(e){return r("el-col",{key:e.bankID,attrs:{span:8}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",label:e.bankName,border:""},on:{click:function(r){return t.settingInstallment(e.bankID)}}},[t._v("\n            "+t._s(e.bankName)+"\n          ")])],1)})),1)})),1):r("el-card",{staticClass:"box-card"},[r("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[r("el-col",{attrs:{span:24}},[r("el-button-group",{staticStyle:{width:"100%"}},[r("el-button",{staticStyle:{width:"50%"},attrs:{type:"primary"},on:{click:function(e){return t.selectInstallment(!1)}}},[t._v("不分期")]),t._v(" "),r("el-button",{staticStyle:{width:"50%"},attrs:{type:"primary"},on:{click:function(e){return t.selectInstallment(!0)}}},[t._v("分期")])],1)],1)],1)],1)],1):r("div",[r("el-card",{staticClass:"box-card"},t._l(t.installmentOptions,(function(e){return r("el-row",{key:e.installmentID,staticClass:"row-bg",attrs:{type:"flex"}},[r("el-col",{attrs:{span:24}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(r){return t.submit(e)}}},[t._v(t._s(e.installmentName))])],1)],1)})),1)],1)])},lr=[],ur={name:"Installment",props:{showDialog:{type:Boolean,required:!1},updatePayInfo:{type:Function,default:function(){}}},data:function(){return{installment:null,bankList:[],radio:"",installmentOptions:[]}},created:function(){var t=this;ct().then((function(e){var r=null;for(var a in e)1*a%3===0||1*a===0?(null!==r&&t.bankList.push(r),r={key:a,item:[e[a]]}):r.item.push(e[a]),1*a===e.length-1&&t.bankList[t.bankList.length-1].key!==r.key&&t.bankList.push(r)})).catch((function(t){console.error(t)}))},methods:{selectInstallment:function(t){if(this.installment=t,!t){var e=new Y["a"];this.updatePayInfo(e),this.$emit("update:showDialog",!1)}},settingInstallment:function(t){var e=this;lt(t).then((function(t){e.installmentOptions=t})).catch((function(t){console.error(t)}))},submit:function(t){var e=new Y["a"];e.installmentID=t.installmentID,e.bankNo=t.bankID,e.bankName=t.bankName,e.installmentNumber=1*t.installmentNumber,e.installmentName=t.installmentName,this.updatePayInfo(e),this.beforeClose()},beforeClose:function(){var t=this.$options.data();delete t.bankList,Object.assign(this.$data,t),this.$emit("update:showDialog",!1)}}},dr=ur,pr=Object(q["a"])(dr,cr,lr,!1,null,null,null),mr=pr.exports,fr=function(){var t=this,e=this,r=e.$createElement,a=e._self._c||r;return a("el-drawer",{ref:"drawer",attrs:{title:"MenuProduct","with-header":!1,visible:e.showDrawer,direction:"ltr","before-close":function(){return t.$emit("update:showDrawer",!1)},size:e.size,modal:!1},on:{"update:visible":function(t){e.showDrawer=t}}},[a("el-row",{staticClass:"menu-drawer",staticStyle:{overflow:"auto"},attrs:{gutter:0}},e._l(e.btn,(function(t){return a("el-col",{key:t.pluNo,attrs:{shadow:"hover",span:8,"body-style":{padding:"1px"}}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(r){return e.getProduct(t.pluNo)}}},[e._v(e._s(t.pluName))])],1),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n          售價:"+e._s(e._f("toCurrency")(t.price))+"\n        ")])])],1)})),1)],1)},hr=[],br={name:"MenuDrawer",props:{showDrawer:{type:Boolean,required:!1},products:{type:Object,default:function(){return{}}},menukey:{type:String,default:""},addGoods:{type:Function,default:function(){}}},data:function(){return{memberID:null,phone:null,idCardNum:null,size:"0px",promotionQueueNo:1,btn:{}}},watch:{menukey:function(t){this.btn=this.products[this.menukey].products}},mounted:function(){var t=this;this.$nextTick((function(){t.size="".concat(t.$parent.$refs.paneContainer.$refs.leftPane.clientWidth,"px")}))},created:function(){},methods:{getProduct:function(t){var e=this;Object(C["a"])(t,"").then((function(t){null===t.data?e.productError="商品代碼錯誤":(e.productError="",e.addGoods(t,1,e.promotionQueueNo++),e.inputPid="")}))}}},vr=br,yr=(r("e4ab"),Object(q["a"])(vr,fr,hr,!1,null,"05d3f528",null)),gr=yr.exports,wr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-dialog",{attrs:{width:"fit-content",visible:t.showDrawer,"before-close":t.beforeClose},on:{"update:visible":function(e){t.showDrawer=e}}},[r("el-card",{staticClass:"box-card",attrs:{width:"fit-content"}},[r("span",{staticStyle:{"font-size":"24px"}},[t._v("是否執行滿額促銷?")]),t._v(" "),r("span",{staticStyle:{color:"#222933"}},[t._v("---")]),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.switchPromotionDrawer}},[t._v("確認")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.beforeClose}},[t._v("取消")])],1)],1),t._v(" "),r("el-dialog",{attrs:{visible:t.showPromotionDrawer,"before-close":t.beforeClose,width:"fit-content","show-close":!0}},[r("el-card",{staticClass:"box-card",style:"height:"+t.size+";overflow:scroll;"},[r("span",{staticStyle:{"font-size":"24px"}},[t._v("滿額促銷")]),t._v(" "),r("div",[r("br")]),t._v(" "),t._l(t.products,(function(e,a){return r("div",{key:a},[r("el-row",[r("el-col",{staticStyle:{margin:"3px"}},[t.errorMsg[a]?r("el-alert",{attrs:{title:t.errorMsg[a],type:t.errorType[a],closable:!1,"show-icon":""}}):t._e(),t._v(" "),r("el-tag",{attrs:{type:"info"}},[t._v(t._s(a.substr(0,8)))]),t._v(" "),r("el-button",{attrs:{type:"primary",width:"fit-content"},on:{click:function(e){return t.addToCart(a)}}},[r("span",{staticStyle:{color:"#fed000"}},[t._v("促銷價："+t._s(e.dmPrice))]),t._v(" 貨號："+t._s(e.pluNo)+" 商品名稱："+t._s(e.pluName))]),t._v(" "),r("span",{staticStyle:{color:"#222933"}},[t._v("---")]),t._v(" "),e.quantity>1?r("el-input",{staticStyle:{width:"15%"},attrs:{placeholder:"預設數量："+e.quantity},model:{value:t.quantity[a],callback:function(e){t.$set(t.quantity,a,e)},expression:"quantity[index]"}}):t._e()],1)],1)],1)})),t._v(" "),r("div",[r("el-button",{attrs:{type:"danger",width:"fit-content"},on:{click:t.beforeClose}},[t._v("不選擇滿額促銷方案")])],1),t._v(" "),r("div",[r("br")])],2)],1)],1)},_r=[],kr=(r("20d6"),r("2fdb"),{name:"PromotionDrawer",props:{showDrawer:{type:Boolean,required:!1},products:{type:Object,default:function(){return{}}},addGoods:{type:Function,default:function(){}},addPromote:{type:Function,default:function(){}},clearPromotionOption:{type:Function,default:function(){}},clearProductAndPromotion:{type:Function,default:function(){}},promotionInfo:{type:Object,default:function(){return{}}},callBack:{type:Function,default:function(){}}},data:function(){return{size:"0px",quantity:{},quantityQualified:{},errorMsg:{},errorType:{},showPromotionDrawer:!1,mmTypeFwatchList:{}}},computed:Object(n["a"])({},Object(i["c"])({salesOrder:function(t){return t.order.salesOrder},memberInfo:function(t){return t.member}})),watch:{showDrawer:function(){this.size="".concat(.7*this.$parent.$el.offsetHeight,"px"),this.showPromotionDrawer&&this.$emit("update:showDrawer",!1)},products:{handler:function(t){"{}"===JSON.stringify(t)&&(this.showPromotionDrawer=!1)},deep:!0},quantity:{handler:function(){for(var t in this.quantity)this.quantity[t]<1?(this.errorMsg[t]="數量不得小於１",this.errorType[t]="error",this.quantityQualified[t]=!1):isNaN(this.quantity[t])?(this.errorMsg[t]="不得填入０～９以外之字元",this.errorType[t]="error",this.quantityQualified[t]=!1):Number(this.quantity[t])>Number(this.products[t].quantity)?(this.errorMsg[t]="不得超過主商品的數量： ".concat(this.products[t].quantity),this.errorType[t]="error",this.quantityQualified[t]=!1):(this.errorMsg[t]="",this.errorType[t]="",this.quantityQualified[t]=!0)},deep:!0},"salesOrder.items":{handler:function(t,e){var r=this;if(this.showPromotionDrawer){var a=this.calcDegreeAmt();for(var o in a){var n=a[o],i=n.key;if(n.amt<n.promoteAmt){this.$message({type:"warning",message:"促代".concat(this.mmTypeFwatchList[i].mm.promoteNo,"，商品總金額低於滿額條件，刪除加購品項"),closable:!0,duration:6e3});var s=t.filter((function(t){return!e.includes(t)}));s.forEach((function(t){r.$store.dispatch("order/clearProductAndPromotionInSales",{pid:t.pluNo,queueNo:t.queueNo,mmType:t.mmType})})),this.showPromotionDrawer=!1}}}},deep:!0}},mounted:function(){var t=this;this.$nextTick((function(){t.size="".concat(.7*t.$parent.$el.offsetHeight,"px")}))},created:function(){},methods:{switchPromotionDrawer:function(){this.$emit("update:showDrawer",!1),this.showPromotionDrawer=!0},addToCart:function(t){var e=this;if(this.quantityQualified[t]||void 0===this.quantityQualified[t]){var r=this.quantity[t]?this.quantity[t]:this.products[t].quantity,a=this.salesOrder.items.findIndex((function(r){return r.queueNo===e.products[t].queueNo&&"F"===r.mmType&&r.pluNo===e.products[t].pluNo}));if(-1!==a&&(r-=this.salesOrder.items[a].quantity),r<=0)this.$message({type:"error",message:"商品超過可加購數量",closable:"true"});else{var o=t.substr(0,t.length-this.products[t].pluNo.length),n=this.promotionInfo[o],i=this.products[t].dmPrice;void 0!==n?(Object(C["b"])(this.products[t].pluNo).then((function(a){if(a){var s={};Object.assign(s,a),s.pluName="*".concat(s.pluName),Object.assign(s,{dmPrice:i,groupNo:"0",mmShareDiscountAmt:0}),void 0!==n&&Object.assign(s,{mmType:n.mmType,amtType:n.amtType,promoteID:n.promoteNo}),e.addGoods(s,r,e.products[t].queueNo,e.memberInfo),e.clearPromotionOption(o,t)}})),void 0!==n&&(this.mmTypeFwatchList[t]={mm:n,degreeAmt:this.promotionInfo[o].degreeAmt1,pid:this.products[t].pluNo,queueNo:this.products[t].queueNo,mmType:n.mmType})):this.$message({type:"error",message:"促銷檔案遺失",closable:!0})}}},beforeClose:function(){this.$emit("update:showDrawer",!1),this.showPromotionDrawer=!1,this.quantity={},this.quantityQualified={},this.errorMsg={},this.errorType={},this.callBack()},calcDegreeAmt:function(){var t=this,e={},r=function(r){var a=0;t.mmTypeFwatchList[r].mm.mmPlu.forEach((function(e){t.salesOrder.items.forEach((function(o){o.pluNo===e.pluNo&&(o.hasOwnProperty("PromoteCount")||(a+=t.mmTypeFwatchList[r].degreeAmt))}))}));var o=t.mmTypeFwatchList[r].mm.promoteNo;e.hasOwnProperty(o)?e[o].promoteAmt+=a:e[o]={key:r,amt:t.mmTypeFwatchList[r].mm.discProductAmt,promoteAmt:a}};for(var a in this.mmTypeFwatchList)r(a);return e}}}),Nr=kr,Cr=(r("8ed5"),Object(q["a"])(Nr,wr,_r,!1,null,null,null)),Dr=Cr.exports,Ir=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"components-container"},[r("split-pane",{attrs:{"default-percent":t.topPercent,split:"horizontal"},on:{resize:function(e){return t.resize()}}},[r("template",{slot:"paneL"},[r("div",{ref:"TopPane",staticClass:"top-container"},[t._t("Top")],2)]),t._v(" "),r("template",{slot:"paneR"},[r("split-pane",{ref:"pane-center",attrs:{"default-percent":t.centerPercent,split:"horizontal","allow-resize":!1},on:{resize:function(e){return t.resize()}}},[r("template",{slot:"paneL"},[r("div",{staticClass:"left-container"},[r("split-pane",{attrs:{"default-percent":t.leftPercent,split:"vertical"}},[r("template",{slot:"paneL"},[r("div",{ref:"leftPane",staticClass:"center-container"},[t._t("Left")],2)]),t._v(" "),r("template",{slot:"paneR"},[r("div",{ref:"rightPane",staticClass:"right-container"},[t._t("Right")],2)])],2)],1)]),t._v(" "),r("template",{slot:"paneR"},[r("div",{ref:"bottomPane",staticClass:"bottom-container"},[t._t("Bottom")],2)])],2)],1)],2)],1)},Pr=[],Or=r("19ab"),xr=r.n(Or),jr={name:"PosSplitPane",components:{splitPane:xr.a},props:{resize:{type:Function,default:function(){}},topPercent:{type:Number,default:14},centerPercent:{type:Number,default:83},leftPercent:{type:Number,default:85}},mounted:function(){var t=this;window.onresize=function(){t.resize()}},methods:{}},Sr=jr,Tr=(r("293e"),Object(q["a"])(Sr,Ir,Pr,!1,null,"324c3290",null)),$r=Tr.exports,Ar=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-row",{attrs:{gutter:0}},t._l(t.paneData,(function(e){return r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"item.show"}],key:e.name,attrs:{shadow:"never",span:8,"body-style":{padding:"0px"}}},[r("el-col",[r("el-button-group",{staticStyle:{width:"100%"}},[r("el-button",t._g({style:[!1!==e.labelVisible?{width:"50%"}:{width:"100%"}],attrs:{type:"primary",disabled:e.disabled}},null!=e.event?{click:e.event}:{}),[t._v(t._s(e.name))]),t._v(" "),!1!==e.labelVisible?r("el-input",{staticStyle:{width:"50%"},attrs:{disabled:!0},model:{value:e.label,callback:function(r){t.$set(e,"label",r)},expression:"item.label"}}):t._e()],1)],1)],1)})),1)],1)},Mr=[],Fr={name:"TopPane",props:{paneData:{type:Array,default:function(){return[]}}},created:function(){},updated:function(){},mounted:function(){}},Er=Fr,Lr=Object(q["a"])(Er,Ar,Mr,!1,null,null,null),qr=Lr.exports,Vr=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"shopCartTbl"},[a("el-table",{ref:"eltable",attrs:{data:t.shopCart.items,border:!0,fit:!0,"show-summary":!0,"sum-text":"小計","summary-method":t.getSummaries,size:"medium",height:t.tblHeight,"row-class-name":t.getRowColor}},[a("el-table-column",{attrs:{label:""}},[a("template",{slot:"header"},["service"!==t.posType&&"agent"!==t.posType?a("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"large"},on:{click:function(e){return t.toggleGoodsDrawer()}}},[t._v("新增商品")]):t._e()],1),t._v(" "),a("el-table-column",{attrs:{type:"index",index:t.getIndex,label:"No"}}),t._v(" "),!0===t.memberInfo.status?a("el-table-column",{attrs:{prop:"warranty",label:"AMG",width:"90%",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.elementCondition("warranty",e.row.warranty)?a("div",[a("img",{staticClass:"icons ",class:{image:t.checkHasAmg(e.$index+1,e.row.quantity,"1")},attrs:{src:r("b579")},on:{click:function(r){return t.onWarranty(e)}}})]):t._e()]}}],null,!1,523493641)}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"pluNo",label:"貨號",width:"80%"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"商品名稱"}}),t._v(" "),a("el-table-column",{attrs:{prop:"unitPrice",label:"單價",width:"110%",sortable:"",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.elementCondition("unitPrice",e.row)&&void 0===e.row.warranty.warrantyPluNo&&"agent"!==t.posType?a("el-button",{staticStyle:{width:"100%"},attrs:{slot:"reference"},on:{click:function(r){return t.onBargainDialog(e)}},slot:"reference"},[t._v("\n            "+t._s(t._f("toCurrency")(t.unitPrice(e.row)))+"\n          ")]):a("span",[t._v("\n            "+t._s(t._f("toCurrency")(t.unitPrice(e.row)))+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"quantity",label:"數量",sortable:"",width:"90%",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[(e.row.mmType||"D"!==e.row.priceType)&&""!==e.row.promoteID||"service"===t.posType||"agent"===t.posType||void 0!==e.row.warranty.warrantyPluNo||0!==e.row.regulation.length||t.checkHasAmg(e.$index+1,e.row.quantity,"1")?a("span",{staticStyle:{"text-align":"right"}},[t._v(t._s(e.row.quantity))]):a("el-input",{staticStyle:{width:"100%","text-align":"right"},attrs:{type:"number",max:99999,min:1},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:e.row.quantity,callback:function(r){t.$set(e.row,"quantity",r)},expression:"scope.row.quantity"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"AMT.AMOUNT",label:"金額",width:"90%",sortable:"",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"text item"},[t._v("\n            "+t._s(t._f("toCurrency")(t.subTotal(e.row)))+"\n          ")])]}}])}),t._v(" "),t.shopCart.items.length>0?a("el-table-column",{attrs:{label:"清除",width:"50%"},scopedSlots:t._u([{key:"default",fn:function(e){return"agent"!==t.posType?[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"small",circle:""},nativeOn:{click:function(r){r.preventDefault(),t.clearProductAndPromotion(e.row.pluNo,e.row.queueNo,e.row.mmType),t.checkHasAmg(e.$index+1,"2")}}})]:void 0}}],null,!0)}):t._e()],2)],1),t._v(" "),a("Bargain",{attrs:{"dialog-visible":t.showBargainDialog,"shop-item":t.selectRow},on:{"update:dialogVisible":function(e){t.showBargainDialog=e},"update:dialog-visible":function(e){t.showBargainDialog=e}}}),t._v(" "),a("Warranty",{attrs:{"dialog-visible":t.showWarrantyDialog,"shop-item":t.selectRow,"shop-itemid":t.selectId},on:{"update:dialogVisible":function(e){t.showWarrantyDialog=e},"update:dialog-visible":function(e){t.showWarrantyDialog=e}}})],1)},Rr=[],zr=function(){var t=this,e=this,r=e.$createElement,a=e._self._c||r;return a("el-dialog",{attrs:{title:"變價",visible:e.dialogVisible,"before-close":e.beforeClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",[void 0===e.form.reasonOptions?a("el-card",[!1===e.form.confirm?a("el-form",{attrs:{"label-position":"left"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[a("el-form-item",{attrs:{label:"輸入價格"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{inputmode:"numeric",type:"number"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.permissionCheck(t))}},model:{value:e.form.input,callback:function(t){e.$set(e.form,"input",t)},expression:"form.input"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.permissionCheck}},[e._v("確認")])],1)],1):a("el-form",{attrs:{"label-position":"left"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[a("el-form-item",{attrs:{label:"輸入價格"}},[a("el-input",{staticStyle:{width:"75%"},attrs:{disabled:!0,inputmode:"numeric"},nativeOn:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}},model:{value:e.form.input,callback:function(t){e.$set(e.form,"input",t)},expression:"form.input"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店長帳號"}},[a("el-input",{staticStyle:{width:"75%"},attrs:{inputmode:"numeric",type:"number"},nativeOn:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"店長密碼"}},[a("el-input",{ref:"inputPwd",staticStyle:{width:"75%"},attrs:{inputmode:"numeric",type:"number"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.getReasonList(t))}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.getReasonList}},[e._v("確認")])],1)],1)],1):a("el-card",[a("el-form",{attrs:{"label-position":"left"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[a("el-form-item",{attrs:{label:"輸入價格"}},[a("el-input",{staticStyle:{width:"75%"},attrs:{disabled:!0,inputmode:"numeric"},nativeOn:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;t.preventDefault()}},model:{value:e.form.input,callback:function(t){e.$set(e.form,"input",t)},expression:"form.input"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"變價原因"}},[a("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.form.selected,callback:function(t){e.$set(e.form,"selected",t)},expression:"form.selected"}},e._l(e.form.reasonOptions,(function(t,e){return a("el-option",{key:t.reasonID,attrs:{label:t.reasonName,value:e}})})),1)],1),e._v(" "),void 0!==e.form.selected&&"4"===e.form.reasonOptions[e.form.selected].reasonID?a("el-form-item",{attrs:{label:"競爭廠商"}},[a("el-select",{attrs:{placeholder:"請選擇"},on:{change:function(){t.$refs.competitorAmtIpt.focus()}},model:{value:e.form.competitor,callback:function(t){e.$set(e.form,"competitor",t)},expression:"form.competitor"}},e._l(e.form.reasonOptions[e.form.selected].competitor,(function(t){return a("el-option",{key:t.competitorNo,attrs:{label:t.competitorName,value:t.competitorNo}})})),1)],1):e._e(),e._v(" "),void 0!==e.form.selected&&"4"===e.form.reasonOptions[e.form.selected].reasonID?a("el-form-item",{attrs:{label:"廠商價格"}},[a("el-input",{ref:"competitorAmtIpt",staticStyle:{width:"75%"},attrs:{inputmode:"numeric"},model:{value:e.form.competitorAmt,callback:function(t){e.$set(e.form,"competitorAmt",t)},expression:"form.competitorAmt"}})],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.submit}},[e._v("確認")])],1)],1)],1)],1)])},Br=[],Ur=r("ed08"),Gr={name:"Bargain",props:{dialogVisible:{type:Boolean,required:!0},shopItem:{type:Object,default:function(){return{}}}},data:function(){return{form:{input:void 0,account:"",password:"",confirm:!1,reasonOptions:void 0,selected:void 0,competitor:"",competitorAmt:void 0}}},computed:Object(n["a"])({},Object(i["c"])({user:function(t){return t.user},salesProducts:function(t){return t.product.salesProducts},serviceProducts:function(t){return t.product.serviceProducts}}),{},Object(i["b"])(["pos_tab"])),watch:{"form.selected":{handler:function(t){void 0!==this.form.selected&&"4"!==this.form.reasonOptions[this.form.selected].reasonID&&(this.form.competitor="")},deep:!0}},created:function(){},methods:{permissionCheck:function(){var t=new tt["a"];"StoreManager-token"===this.user.token?"service"!==this.pos_tab?(t.bargainType=0,t.userID=this.user.userId,t.userPassword=this.user.password,this.form.account=this.user.userId,this.fetchReason(t)):(t.bargainType=2,t.userID=this.user.userId,t.userPassword=this.user.password,this.form.account=this.user.userId,this.fetchReason(t)):this.form.confirm=!0},getReasonList:function(){var t=new tt["a"];"service"!==this.pos_tab?t.bargainType=0:t.bargainType=2,t.userID=this.form.account,t.userPassword=this.form.password,this.fetchReason(t)},submit:function(){var t,e;switch(this.pos_tab){case"service":e="order/updateServiceOrderItem",t=this.serviceProducts[this.shopItem.row.pluNo+this.shopItem.row.queueNo];break;default:e="order/updateSalesOrderItem",t=this.salesProducts[this.shopItem.row.pluNo+this.shopItem.row.queueNo];break}if(void 0!==t){if(void 0===this.form.selected)return this.$message({type:"error",message:"未選擇變價原因",duration:1e4,showClose:!0}),!1;if("4"===this.form.reasonOptions[this.form.selected].reasonID&&""===this.form.competitor)return this.$message({type:"error",message:"未選擇競爭廠商",duration:1e4,showClose:!0}),!1;var r={idx:this.shopItem.$index,shopItem:Object(Ur["a"])(this.shopItem.row),reasonOption:this.form.reasonOptions[this.form.selected],account:this.form.account,inputPrice:1*this.form.input,product:t,competitorAmt:this.form.competitorAmt,competitorNo:this.form.competitor},a=he.bargain(r,this.pos_tab),o="error";a.result?(a.data.shopItem.mm=[],a.data.shopItem.name=a.data.shopItem.pluName,a.data.shopItem.priceType="",a.data.shopItem.promoteID="",o="success",this.$store.dispatch(e,a.data,{root:!0})):o="error",this.$message({type:o,message:a.msg,duration:1e4,showClose:!0}),this.beforeClose()}else this.$message({type:"error",message:"商品檔錯誤",duration:1e4,showClose:!0})},fetchReason:function(t){var e=this;Object(Pe["a"])(t).then((function(t){e.form.reasonOptions=t})).catch((function(t){console.log(t)}))},beforeClose:function(){this.$data.form=this.$options.data().form,this.$emit("update:dialogVisible",!1)}}},Qr=Gr,Yr=Object(q["a"])(Qr,zr,Br,!1,null,null,null),Hr=Yr.exports,Wr=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"AMG加購",visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("div",[""!=t.productError?r("el-alert",{attrs:{title:t.productError,type:"error",center:"","show-icon":"",closable:!1}}):t._e(),t._v(" "),null===t.warranty?r("el-card",t._l(t.shopItem.row?t.shopItem.row.warranty:[],(function(e){return r("el-card",{key:e.id,staticClass:"box-card"},[r("div",{staticClass:"text item",staticStyle:{"font-size":"18px"}},[t._v(t._s(e.name)+"("+t._s(e.id)+")")]),t._v(" "),""!==e.remark?r("div",{staticClass:"text item",staticStyle:{"font-size":"18px"}},[t._v("備註:"+t._s(e.remark))]):t._e(),t._v(" "),r("div",{staticClass:"text item",staticStyle:{"font-size":"18px"}},[t._v("合約售價:"+t._s(t._f("toCurrency")(e.price)))]),t._v(" "),r("div",{staticClass:"text item"},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",size:"mini"},on:{click:function(r){t.buying(e.id,e.price)}}},[r("span",[t._v("加購")])])],1)])})),1):r("el-card",[r("el-input",{attrs:{inputmode:"numeric",maxlength:"20"},model:{value:t.warranty.warrantyAccNo,callback:function(e){t.$set(t.warranty,"warrantyAccNo",e)},expression:"warranty.warrantyAccNo"}},[r("template",{slot:"prepend"},[t._v("有賞條碼")]),t._v(" "),r("template",{slot:"append"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.addToCart()}}},[r("span",[t._v("確定")])])],1)],2)],1)],1)])},Jr=[],Zr={name:"Warranty",props:{addGoods:{type:Function,default:function(){}},dialogVisible:{type:Boolean,required:!0},shopItem:{type:Object,required:!0},shopItemid:{type:Number,required:!0}},data:function(){return{inputAccNo:!1,warranty:null,warrantyId:null,warrantyPrice:0,productError:"",ShopCart:null}},computed:Object(n["a"])({},Object(i["c"])({salesShopCart:function(t){return t.order.salesOrder}})),created:function(){this.shopCart=this.salesShopCart},methods:{beforeClose:function(){Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},buying:function(t,e){this.warrantyId=t,this.warrantyPrice=e,this.warranty={warrantyPluNo:this.shopItem.row.pluNo,warrantyPluSeq:this.shopItemid,warrantyAccNo:""}},checkAccNoExist:function(t){var e=!1;return this.shopCart.items.forEach((function(r){r.warranty.warrantyAccNo===t&&(e=!0)})),!!e},addToCart:function(){var t=this;""===this.warranty.warrantyAccNo?this.productError="有賞條碼不得為空白":isNaN(this.warranty.warrantyAccNo)?this.productError="有賞條碼只能為純數字":this.checkAccNoExist(this.warranty.warrantyAccNo)?this.productError="此條碼已存在":Object(C["a"])(this.warrantyId,"").then((function(e){if(null===e)t.productError="商品代碼錯誤";else{t.productError="";var r=Object.assign({},e,{warranty:t.warranty,price:t.warrantyPrice,vipPrice:t.warrantyPrice});t.$store.dispatch("order/addGoodsToSales",{product:r,count:1,queueNo:""}),t.$message({showClose:!0,message:"商品已加入購物車",type:"success"}),t.beforeClose()}}))}}},Xr=Zr,Kr=Object(q["a"])(Xr,Wr,Jr,!1,null,null,null),ta=Kr.exports,ea=r("8975"),ra={name:"LeftPane",components:{Bargain:Hr,Warranty:ta},props:{leftPaneSize:{type:Number,default:0},toggleGoodsDrawer:{type:Function,default:function(){}},handleDelete:{type:Function,default:function(){}},dataCount:{type:Number,default:0},posType:{type:String,default:""},clearProductAndPromotion:{type:Function,default:function(){}},shopCart:{type:Object,default:function(){return{}}}},data:function(){return{clientWidth:0,tblHeight:"200px",showBargainDialog:!1,showWarrantyDialog:!1,selectRow:{},selectId:0,warrantyData:{mainProductId:null,warrantyList:[],shopcartItemIdx:null}}},computed:Object(n["a"])({},Object(i["c"])({memberInfo:function(t){return t.member}}),{},Object(i["b"])(["opFuncSub"])),watch:{leftPaneSize:function(t){this.tblHeight="".concat(t,"px")},dataCount:function(){this.$refs.eltable.doLayout()},errorMsg:function(){var t=this;this.$nextTick((function(){var e=t.leftPaneSize-t.$refs.elalert.clientHeight;t.tblHeight="".concat(e,"px")}))}},mounted:function(){var t=this;this.$nextTick((function(){t.tblHeight="".concat(t.leftPaneSize,"px")}))},methods:{getSummaries:function(t){var e=this,r=t.columns,a=t.data,o=[];return r.forEach((function(t,r){var n;if(0!==r)switch(r){case 4:n=a.map((function(t){return Number(t.quantity)})),n.every((function(t){return isNaN(t)}))?o[r]="":o[r]=n.reduce((function(t,e){var r=Number(e);return isNaN(r)?t:t+e}),0);break;case 5:o[r]=Object(ea["toCurrency"])(_e(e.memberInfo.status,a));break}else o[r]="小計"})),o},elementCondition:function(t,e){switch(t){case"unitPrice":return void 0!==e.regulation&&(!e.promoteID&&"1"!==e.refund.priceChangeFlag||""===e.mmType&&"D"===e.priceType);case"warranty":return!!(Array.isArray(e)&&e.length>0);default:return!1}},onBargainDialog:function(t){this.selectRow=t,this.showBargainDialog=!0},getRowColor:function(t){var e=t.row;t.rowIndex;if(e.promoteID)return"promote-plu"},getIndex:function(t){if("促銷"===this.shopCart.items[t].pluNo)switch(this.shopCart.items[t].mmType){case"N":switch(this.shopCart.items[t].amtType){case"F":return"固".concat(t+1);case"C":return"讓".concat(t+1);case"D":return"扣".concat(t+1);default:return t+1}case"B":return"門".concat(t+1);case"T":return"貼".concat(t+1)}else{if("F"===this.shopCart.items[t].mmType||"F"===this.shopCart.items[t].mmGroupType)return"滿".concat(t+1);if(!this.shopCart.items[t].mmType&&"D"===this.shopCart.items[t].priceType)return"*".concat(t+1)}return t+1},unitPrice:function(t){return!0===this.memberInfo.status&&"1"!==t.refund.priceChangeFlag?t.price.vipAmt:t.price.normalAmt},subTotal:function(t){return!0===this.memberInfo.status&&"1"!==t.refund.priceChangeFlag?t.price.vipAmt*t.quantity:t.price.normalAmt*t.quantity},checkHasAmg:function(t,e,r){var a=this,o=!1,n=0;return this.shopCart.items.forEach((function(e){void 0!==e.warranty.warrantyPluSeq&&e.warranty.warrantyPluSeq===t&&("1"===r?(o=!0,n++):a.clearProductAndPromotion(e.pluNo,e.queueNo,e.mmType))})),!!(o&&n>=e)},onWarranty:function(t){this.checkHasAmg(t.$index+1,t.row.quantity,"1")?this.showWarrantyDialog=!1:(this.showWarrantyDialog=!0,this.selectRow=t,this.selectId=t.$index+1)}}},aa=ra,oa=(r("124a"),Object(q["a"])(aa,Vr,Rr,!1,null,null,null)),na=oa.exports,ia=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticStyle:{overflow:"auto",height:"100%"}},[r("el-row",{ref:"rightBlock",staticStyle:{overflow:"auto"},attrs:{gutter:0}},t._l(t.paneData,(function(e){return r("el-col",{key:e.name,attrs:{shadow:"never",label:e.label,name:e.name,span:24,"body-style":{padding:"0px"}}},[r("el-button",t._g({staticStyle:{width:"100%"},attrs:{type:e.type}},null!=e.event?{click:e.event}:{}),[t._v(t._s(e.name))])],1)})),1)],1)},sa=[],ca={name:"RightPane",props:{paneData:{type:Array,default:function(){return[]}}},watch:{paneData:{immediate:!0,handler:function(t,e){var r=this;this.$nextTick((function(){if(r.$refs.rightBlock){var t=r.$refs.rightBlock.$el.scrollWidth;r.$emit("update",t)}}))}}},created:function(){},updated:function(){},mounted:function(){}},la=ca,ua=Object(q["a"])(la,ia,sa,!1,null,null,null),da=ua.exports,pa=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-row",{attrs:{gutter:0}},t._l(t.paneData,(function(e){return r("el-col",{key:e.name,attrs:{shadow:"never",label:e.label,name:e.name,span:t.span,"body-style":{padding:"0px"}}},[r("el-button",t._g({staticStyle:{width:"100%"},attrs:{type:e.type}},null!=e.event?{click:e.event}:{}),[t._v(t._s(e.name))])],1)})),1)],1)},ma=[],fa={name:"BottomPane",props:{paneData:{type:Array,default:function(){return[]}}},data:function(){return{span:24/this.paneData.length}}},ha=fa,ba=Object(q["a"])(ha,pa,ma,!1,null,null,null),va=ba.exports,ya=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-dialog",{ref:"PromoteDialog",style:{overflow:"auto"},attrs:{visible:t.dialogVisible,"before-close":t.beforeClose,width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[0===t.checkList.length?r("div",[r("el-card",{staticClass:"box-card",style:{height:t.dialogHeight+"px",overflow:"auto"}},[r("el-button",{attrs:{type:"danger"},on:{click:t.noPromote}},[t._v("不選擇促銷方案")]),t._v(" "),r("el-divider"),t._v(" "),r("el-checkbox-group",{model:{value:t.checkList,callback:function(e){t.checkList=e},expression:"checkList"}},t._l(t.promotionInfo,(function(e,a){return r("div",{key:e.promoteNo},["mainProduct"!==a&&"mainProductGroupNo"!==a&&"queueNo"!==a&&"F"!==e.mmType?r("div",[r("div",[r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v(t._s(e.promoteNo))]),t._v(" "),"mainProduct"!==a?r("el-checkbox",{attrs:{label:e.promoteName,"true-label":e.promoteNo+t.promotionInfo.queueNo,border:""},on:{change:t.handleCheckedChange}}):t._e()],1),t._v(" "),r("el-divider")],1):t._e()])})),0)],1)],1):t._e(),t._v(" "),t.checkList.length>0?r("div",[r("div",[r("span",{staticStyle:{color:"#eeeeee","font-size":"24px"}},[t._v("促銷方案數量：")]),t._v(" "),r("span",{staticStyle:{color:"#eeeeee","font-size":"24px"}},[t._v(t._s(t.quantity))]),t._v(" "),r("span",{staticStyle:{color:"#304156"}},[t._v("---")]),t._v(" "),r("br")]),t._v(" "),r("el-divider"),t._v(" "),r("el-tag",{attrs:{type:"info",size:"medium"}},[t._v(t._s(t.promotionInfo[t.checkList[0]].promoteNo))]),t._v(" "),r("el-tag",{attrs:{size:"medium"}},[t._v(t._s(t.promotionInfo[t.checkList[0]].promoteName))]),t._v(" "),r("el-divider"),t._v(" "),""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:t.errorType,closable:!1,"show-icon":""}}):t._e(),t._v(" "),r("div",t._l(t.PLU_Group,(function(e,a){return r("div",{key:a},[t.lockSelect===a?r("el-row",{staticClass:"row-bg",staticStyle:{overflow:"auto"},attrs:{gutter:0}},[r("el-col",{attrs:{span:2}},[r("el-tag",{attrs:{size:"medium"}},[t._v("商品"+t._s(a))])],1),t._v(" "),r("el-col",{attrs:{span:22}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"未選擇",disabled:""},model:{value:t.selectValue[a],callback:function(e){t.$set(t.selectValue,a,e)},expression:"selectValue[id]"}},t._l(e,(function(t){return r("el-option",{key:t.pluNo,attrs:{label:t.pluName+"("+t.pluNo+")",value:t.pluNo}})})),1)],1)],1):r("el-row",{staticClass:"row-bg",staticStyle:{overflow:"auto"},attrs:{gutter:0}},[r("el-col",{attrs:{span:2}},[r("el-tag",{attrs:{size:"medium"}},[t._v("商品"+t._s(a))])],1),t._v(" "),r("el-col",{attrs:{span:22}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"未選擇"},model:{value:t.selectValue[a],callback:function(e){t.$set(t.selectValue,a,e)},expression:"selectValue[id]"}},t._l(e,(function(t){return r("el-option",{key:t.pluNo,attrs:{label:t.pluName+"("+t.pluNo+")",value:t.pluNo}})})),1)],1)],1)],1)})),0),t._v(" "),r("el-divider"),t._v(" "),r("el-row",{staticStyle:{overflow:"auto"},attrs:{gutter:0}},[r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"large"},on:{click:function(e){return t.submit()}}},[t._v("確認送出")])],1),t._v(" "),r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",size:"large"},on:{click:function(e){return t.MMReset()}}},[t._v("重新選擇促銷方案")])],1)],1)],1):t._e()]),t._v(" "),r("el-dialog",{attrs:{visible:t.showPromotionDrawer,"before-close":t.clearDrawer,width:"fit-content","show-close":!0}},[r("el-card",{staticClass:"box-card"},[r("span",{staticStyle:{"font-size":"24px"}},[t._v("滿額促銷")]),t._v(" "),r("div",[r("br")]),t._v(" "),""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",closable:!1,"show-icon":""}}):t._e(),t._v(" "),t._l(t.promotionDrawerProduct,(function(e,a){return r("div",{key:e.pluNo},[r("el-row",[r("el-col",{staticStyle:{margin:"3px"}},[r("el-button",{attrs:{type:"primary",width:"fit-content"},on:{click:function(e){return t.submitDrawerCheckList(a)}}},[r("span",{staticStyle:{color:"#fed000"}},[t._v("促銷價："+t._s(e.dmPrice))]),t._v(" 貨號："+t._s(e.pluNo)+" 商品名稱："+t._s(e.pluName))]),t._v(" "),r("span",{staticStyle:{color:"#222933"}},[t._v("---")]),t._v(" "),t.quantity>1?r("el-input",{staticStyle:{width:"15%"},attrs:{placeholder:"預設數量："+t.quantity},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.drawerQuantity[a],callback:function(e){t.$set(t.drawerQuantity,a,e)},expression:"drawerQuantity[index]"}}):t._e()],1)],1)],1)})),t._v(" "),r("div",[r("el-button",{attrs:{type:"danger",width:"fit-content"},on:{click:t.clearDrawer}},[t._v("不選擇滿額促銷方案")])],1),t._v(" "),r("div",[r("br")])],2)],1)],1)},ga=[],wa=(r("456d"),{name:"PromoteDialog",props:{dialogVisible:{type:Boolean,required:!1},promotionInfo:{type:Object,default:function(){return{}}},addGoods:{type:Function,default:function(){}},addPromote:{type:Function,default:function(){}},checkoutLaunch:{type:Boolean,required:!1}},data:function(){return{quantity:1,quantityQualified:!0,quantityConfirmed:!1,dialogHeight:0,checkList:[],onlyDmFlag:"",cheapestDmMM:{},PLU_Group:{},selectValue:{},lockSelect:0,showPromotionDrawer:!1,promotionDrawerProduct:[],drawerQuantity:[],drawerCheckList:[],waitingPromotion:{},mmTypeTWatchList:[],errorMsg:"",errorType:"error",shopCart:null}},computed:Object(n["a"])({},Object(i["c"])({salesOrder:function(t){return t.order.salesOrder},memberInfo:function(t){return t.member}}),{},Object(i["b"])(["pos_tab"])),watch:{dialogVisible:function(t){t&&(this.dialogHeight=.7*this.$parent.$el.clientHeight)},quantity:function(t){var e=this;if(this.quantity=Number(this.quantity),this.errorMsg="",this.errorType="",this.quantityQualified=!0,"[]"!==JSON.stringify(this.checkList)){for(var r=1;r<7;r++)t*this.promotionInfo[this.checkList[0]]["group"+String(r)+"Qty"]>99999&&(this.errorMsg="單品項數量不得大於９９９９９",this.errorType="error",this.quantityQualified=!1);if(t>99999&&(this.errorMsg="單品項數量不得大於９９９９９",this.errorType="error",this.quantityQualified=!1),t<1)this.errorMsg="單品項數量不得小於１",this.errorType="error",this.quantityQualified=!1;else if(isNaN(t))this.errorMsg="不得輸入０～９以外的字元",this.errorType="error",this.quantityQualified=!1;else if("0"!==this.promotionInfo[this.checkList[0]].limitQTY&&null!==this.promotionInfo[this.checkList[0]].limitQTY)if("1"===this.promotionInfo[this.checkList[0]].limited)this.quantity>1&&(this.errorMsg="該促銷方案限制一卡一品，數量不得超過 1",this.errorType="error",this.quantityQualified=!1);else if(this.quantity>Number(this.promotionInfo[this.checkList[0]].limitQTY))this.errorMsg="該促銷方案為限量，總數量不得超過 ".concat(this.promotionInfo[this.checkList[0]].limitQTY),this.errorType="error",this.quantityQualified=!1;else{var a=0;this.shopCart.items.forEach((function(t){t.pluNo===e.promotionInfo.mainProduct&&t.promoteID===e.promotionInfo[e.checkList[0]].promoteNo&&(a+=Number(t.quantity))})),a+this.quantity>Number(this.promotionInfo[this.checkList[0]].limitQTY)&&(this.errorMsg="該促銷方案為限量，總數量不得超過 ".concat(this.promotionInfo[this.checkList[0]].limitQTY),this.errorType="error",this.quantityQualified=!1)}}},promotionInfo:{handler:function(){var t=this;this.onlyDmFlag="0";var e=function(e){if("mainProduct"!==e&&"mainProductGroupNo"!==e&&"queueNo"!==e)if("D"!==t.promotionInfo[e].mmType||"0"!==t.promotionInfo[e].limitType&&"0"===t.promotionInfo[e].limitQTY)"D"!==t.promotionInfo[e].mmType&&(t.onlyDmFlag="-1");else{var r=0;if("0"!==t.promotionInfo[e].limitType&&(t.shopCart.items.forEach((function(a){a.pluNo===t.promotionInfo.mainProduct&&a.promoteID===t.promotionInfo[e].promoteNo&&(r+=Number(a.quantity))})),r>=Number(t.promotionInfo[e].limitQTY)||"1"===t.promotionInfo[e].limited&&r>=1))return"continue";if("{}"===JSON.stringify(t.cheapestDmMM))Object.assign(t.cheapestDmMM,t.promotionInfo[e]),"0"===t.onlyDmFlag&&(t.onlyDmFlag="1");else{var a=t.promotionInfo[e].mmPlu.findIndex((function(e){return e.pluNo===t.promotionInfo.mainProduct})),o=t.cheapestDmMM.mmPlu.findIndex((function(e){return e.pluNo===t.promotionInfo.mainProduct}));t.cheapestDmMM.mmPlu[o].dmPrice>t.promotionInfo[e].mmPlu[a].dmPrice&&Object.assign(t.cheapestDmMM,t.promotionInfo[e])}}};for(var r in this.promotionInfo)e(r);"1"===this.onlyDmFlag&&(this.checkList[0]=this.cheapestDmMM.promoteNo+String(this.promotionInfo.queueNo),this.errorMsg="該商品只有特價促銷，直接帶入最低價促銷",this.errorType="success",this.getProductList())},deep:!0},checkoutLaunch:function(){var t=this;if(this.checkoutLaunch){if(this.mmTypeTWatchList.length>0){var e=_e(this.memberInfo.status,this.shopCart.items);this.mmTypeTWatchList.forEach((function(r,a){e+r.promote.price.taxIncludeAmt<0?(r.promote.price.taxIncludeAmt=-1*e,r.promote.price.normalAmt=r.promote.price.taxIncludeAmt/r.promote.quantity,r.promote.price.vipAmt=r.promote.price.taxIncludeAmt/r.promote.quantity,e=0):e+=r.promote.price.taxIncludeAmt,t.addPromote(r.promote,r.pid,r.queueNo),t.mmTypeTWatchList.splice(a,1)}))}this.$emit("update:checkoutLaunch",!1)}},"salesOrder.items":{handler:function(t){var e=this,r=!1;if("{}"!==JSON.stringify(this.waitingPromotion)){r=!0;var a=this.salesOrder.items.findIndex((function(t){return t.pluNo===e.waitingPromotion.pid[0]&&t.queueNo===e.waitingPromotion.queueNo}));if(-1===a)return alert(JSON.stringify(this.waitingPromotion)),alert(JSON.stringify(this.salesOrder.items)),this.waitingPromotion={},void(this.selectValue={});var o=function(a){var o=t.findIndex((function(t){return t.queueNo===e.promotionInfo.queueNo&&t.pluNo===e.selectValue[a]}));-1===o&&(r=!1)};for(var n in this.selectValue)o(n);r&&(this.addPromote(this.waitingPromotion.promote,this.waitingPromotion.pid,this.waitingPromotion.queueNo),this.waitingPromotion={},this.selectValue={})}},deep:!0}},created:function(){this.shopCart=this.salesShopCart,this.productList=this.salesProducts},mounted:function(){},methods:{handleCheckedChange:function(t){this.checkList[0]=t,this.getProductList()},MMReset:function(){"{}"===JSON.stringify(this.cheapestDmMM)||"1"!==this.onlyDmFlag?(this.errorMsg="",this.errorType="",this.checkList=[],this.PLU_Group={},this.selectValue={},this.quantityConfirmed=!1,this.quantity=1,this.promotionDrawerProduct=[],this.drawerQuantity=[]):(this.errorMsg="直接帶入最低價促銷",this.errorType="success")},noPromote:function(){"{}"===JSON.stringify(this.cheapestDmMM)?this.$emit("update:dialogVisible",!1):(this.checkList[0]=this.cheapestDmMM.promoteNo+String(this.promotionInfo.queueNo),this.errorMsg="未選擇促銷方案，直接代入最低特價促銷",this.errorType="success",this.getProductList())},getProductList:function(){var t=this,e={},r=this.promotionInfo[this.checkList[0]].shareEquFlag;if("0"===this.promotionInfo[this.checkList[0]].limited&&Number(this.promotionInfo[this.checkList[0]].limitQTY)>0){var a=0;if(this.shopCart.items.forEach((function(e){e.pluNo===t.promotionInfo.mainProduct&&e.promoteID===t.promotionInfo[t.checkList[0]].promoteNo&&(a+=Number(e.quantity))})),a===Number(this.promotionInfo[this.checkList[0]].limitQTY))return this.checkList=[],void this.$notify({title:"促銷",message:"該促銷方案為限量，數量不得超過 ".concat(this.promotionInfo[this.checkList[0]].limitQTY),type:"error"})}else if("1"===this.promotionInfo[this.checkList[0]].limited){var o=this.shopCart.items.findIndex((function(e){return e.pluNo===t.promotionInfo.mainProduct&&e.promoteID===t.promotionInfo[t.checkList[0]].promoteNo}));if(-1!==o)return this.checkList=[],void this.$notify({title:"促銷",message:"該促銷方案限制一卡一品",type:"error"});this.quantity=1,this.quantityQualified=!0,this.quantityConfirmed=!0,this.errorMsg="該促銷方案限制一卡一品",this.errorType="warning"}this.promotionInfo[this.checkList[0]].mmPlu.forEach((function(a){if("0"===r)"F"===a.mmGroupType?t.promotionDrawerProduct.push(a):e.hasOwnProperty(a.groupNo)?e[a.groupNo].push(a):e[a.groupNo]=[a],t.promotionInfo.mainProduct===a.pluNo&&null!==a.groupNo&&(t.selectValue[a.groupNo]=t.promotionInfo.mainProduct,Object.assign(t.promotionInfo,{mainProductGroupNo:a.groupNo}),t.lockSelect=a.groupNo);else if("D"!==t.promotionInfo[t.checkList[0]].mmType){"F"===a.mmGroupType&&t.promotionDrawerProduct.push(a);for(var o=1;o<=t.promotionInfo[t.checkList[0]]["group"+a.groupNo+"Qty"];o++){var n=t.promotionInfo[t.checkList[0]]["group"+a.groupNo+"Qty"]>1?a.groupNo+"-"+String(o):a.groupNo;e.hasOwnProperty(n)?e[n].push(a):e[n]=[a]}if(t.promotionInfo.mainProduct===a.pluNo&&null!==a.groupNo){var i=t.promotionInfo[t.checkList[0]]["group"+a.groupNo+"Qty"]>1?a.groupNo+"-1":a.groupNo;t.selectValue[i]=t.promotionInfo.mainProduct,Object.assign(t.promotionInfo,{mainProductGroupNo:i}),t.lockSelect=i}}else t.promotionInfo.mainProduct===a.pluNo&&(e["1"]=[a],t.selectValue["1"]=t.promotionInfo.mainProduct,Object.assign(t.promotionInfo,{mainProductGroupNo:"0"}),t.lockSelect="1")})),void 0===this.promotionInfo.mainProductGroupNo&&Object.assign(this.promotionInfo,{mainProductGroupNo:"0"}),Object.assign(this.PLU_Group,e),this.promotionInfo[this.checkList[0]].promoteNo===this.cheapestDmMM.promoteNo&&"{}"!==JSON.stringify(this.cheapestDmMM)&&(this.submit(),this.$notify({title:"促銷",message:"直接帶入最低價促銷",type:"info"}))},submitDrawerCheckList:function(t){var e=this;this.quantity=Number(this.quantity),this.errorMsg="";var r=this.quantity>1?this.drawerQuantity[t]:1;if(void 0===r&&(r=Number(this.quantity)),r>this.quantity)return this.errorMsg="數量不得大於原搭配商品數量",void(this.errorType="error");if(isNaN(r)&&void 0!==r)return this.errorMsg="不得輸入０～９以外的字元",void(this.errorType="error");if(r<1)return this.errorMsg="不得輸入小於１的數字",void(this.errorType="error");var a=this.checkList[0].substr(0,this.checkList[0].length-String(this.promotionInfo.queueNo).length),o=this.promotionInfo[this.checkList[0]],n=o.mmType,i=o.amtType,s=this.promotionDrawerProduct[t].mmGroupType,c=this.promotionDrawerProduct[t].dmPrice;Object(C["b"])(this.promotionDrawerProduct[t].pluNo).then((function(t){if(t){var o={};Object.assign(o,t),o.pluName="#".concat(o.pluName),Object.assign(o,{mmType:n,amtType:i,mmGroupType:s,dmPrice:c,promoteID:a,groupNo:"0",mmShareDiscountAmt:0}),e.addGoods(o,r,e.promotionInfo.queueNo)}})),this.promotionDrawerProduct.splice(t,1),this.drawerQuantity.splice(t,1),0===this.promotionDrawerProduct.length&&this.clearDrawer()},submit:function(){var t=this;if(this.errorMsg="",this.cheapestDmMM={},!this.quantityQualified)return this.errorMsg="商品數量不符合規範",void(this.errorType="error");var e=this.checkList[0].substr(0,this.checkList[0].length-String(this.promotionInfo.queueNo).length),r=this.promotionInfo[this.checkList[0]],a=r.shareEquFlag,o=0,n=function(e){var n=r.mmPlu.findIndex((function(r){return r.pluNo===t.selectValue[e]}));o+=r.mmPlu[n].vipPrice*("0"!==a?1:r["group"+e+"Qty"])};for(var i in this.selectValue)n(i);if(Object.keys(this.PLU_Group).length!==Object.keys(this.selectValue).length)return this.errorMsg="促銷商品未選取",void(this.errorType="error");(function(){var n=r.mmType,i=r.amtType,s=[t.promotionInfo.mainProduct],c=t.getMMShareDiscountAmt(a,r,t.selectValue),l=function(o){if(t.promotionInfo.mainProduct===t.selectValue[o])return delete t.PLU_Group[o],"continue";var s=t.PLU_Group[o].filter((function(e){return e.pluNo===t.selectValue[o]}));if(s.length>0){var l="1"===a?o[0]:o,u=t.quantity;"0"===a&&(u*=r["group"+l+"Qty"]),Object(C["b"])(s[0].pluNo).then((function(r){if(r){var a={};Object.assign(a,r),a.pluName="D"===n?"*".concat(a.pluName):"#".concat(a.pluName),Object.assign(a,{mmType:n,amtType:i,promoteID:e,groupNo:l,mmShareDiscountAmt:c[o]}),t.addGoods(a,u,t.promotionInfo.queueNo)}}))}};for(var u in t.selectValue)l(u);var d=Object.assign({},new tt["d"]);d.pluNo="促銷",d.groupNo="0"!==t.promotionInfo.mainProductGroupNo?t.promotionInfo.mainProductGroupNo[0]:"0",d.name=r.promoteName,d.promoteID=e,d.mmType=r.mmType,d.amtType=r.amtType,d.shareEquFlag=a,d.detailCode="M";var p=r.group1Qty+r.group2Qty+r.group3Qty+r.group4Qty+r.group5Qty+r.group6Qty,m=Object(Ie["d"])(r,t.promotionInfo.mainProduct,t.selectValue);if(m>0){var f=0;"D"===r.mmType&&"0"!==r.limitQTY&&(d.limitType=r.limitType,d.limitQTY=Number(r.limitQTY),d.limited=r.limited),f=m-o,d.price.normalAmt=f,d.price.vipAmt=f}else d.price.normalAmt=m,d.price.vipAmt=m;d.quantity=t.quantity,void 0!==r["group"+d.groupNo+"Qty"]&&r["group"+d.groupNo+"Qty"]>0&&(d.groupQty=r["group"+d.groupNo+"Qty"]),d.price.mmShareDiscountAmt=c[d.groupNo]*t.quantity,d.price.taxIncludeAmt=d.price.vipAmt*d.quantity,d.storeBounds=r.storeBounds>0?r.storeBounds:d.price.taxIncludeAmt,"T"===r.mmType?(d.mmType="T1",t.addPromote(d,s,t.promotionInfo.queueNo),d.mmType="T2",t.mmTypeTWatchList.push({promote:d,pid:s,queueNo:t.promotionInfo.queueNo}),t.selectValue={},t.$notify({title:"促銷",message:"《門號可攜》促銷 將在小計後結算",type:"info"})):"D"===r.mmType&&"1"!==t.onlyDmFlag||"N"===r.mmType&&1===p?(t.addPromote(d,s,t.promotionInfo.queueNo),t.selectValue={}):t.waitingPromotion={promote:d,pid:s,queueNo:t.promotionInfo.queueNo},t.initData(),t.$emit("update:dialogVisible",!1),t.promotionDrawerProduct.length>0&&o>=r.degreeAmt1?t.showPromotionDrawer=!0:(t.quantity=1,t.checkList=[])})()},getMMShareDiscountAmt:function(t,e,r){var a={},o=Object(Ie["d"])(e,this.promotionInfo.mainProduct,r),n=0,i=function(t){var a=e.mmPlu.findIndex((function(e){return e.pluNo===r[t]}));n+=e.mmPlu[a].vipPrice};for(var s in r)i(s);if("D"===e.mmType)return a["0"]=0,a;var c=function(i){if("T"===e.mmType)a[i]=0;else if("0"===t)a[i]=-1*e["g"+i+"ShareValue"]/e["group"+i+"Qty"];else if(e["group"+i[0]+"Qty"]>0){var s=e.mmPlu.findIndex((function(t){return t.pluNo===r[i]}));a[i]=Math.round(o*e.mmPlu[s].vipPrice/n)}else if("B"===e.mmType){var c=e.mmPlu.findIndex((function(t){return t.pluNo===r[i]}));a[i]=-1*Math.round(o*e.mmPlu[c].vipPrice/n)}};for(var l in r)c(l);if("T"===e.mmType)return a;if("1"===t)for(var u in n*=-1,a)n<a[u]?n-=a[u]:a[u]=n;return a},initData:function(){this.PLU_Group={},this.lockSelect=0,this.quantityConfirmed=!1,this.showPromotionDrawer=!1,this.cheapestDmMM={},this.errorMsg="",this.errorType=""},beforeClose:function(){"{}"===JSON.stringify(this.cheapestDmMM)?(this.checkList=[],this.initData(),this.$emit("update:dialogVisible",!1)):(this.PLU_Group={},this.selectValue={},this.lockSelect=0,this.checkList[0]=this.cheapestDmMM.promoteNo+String(this.promotionInfo.queueNo),this.errorMsg="未選擇促銷方案，直接代入最低特價促銷",this.errorType="success",this.getProductList())},quantityConfirm:function(){this.quantityConfirmed=!0},quantityClear:function(){for(var t in this.quantity=1,this.quantityConfirmed=!1,this.selectValue)t!==this.lockSelect&&delete this.selectValue[t]},clearDrawer:function(){this.quantity=1,this.checkList=[],this.drawerQuantity=[],this.promotionDrawerProduct=[],this.showPromotionDrawer=!1}}}),_a=wa,ka=(r("1311"),Object(q["a"])(_a,ya,ga,!1,null,"76c828af",null)),Na=ka.exports,Ca=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),!1===t.valid?r("el-form",{ref:"inputForm",attrs:{"label-position":"left"}},[r("el-form-item",{attrs:{label:"統一編號"}},[r("el-input",{ref:"ipt",staticStyle:{width:"50%"},attrs:{inputmode:"numeric"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.verify(e))}},model:{value:t.VAT_Number,callback:function(e){t.VAT_Number=e},expression:"VAT_Number"}}),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clear()}}},[t._v("清除")])],1),t._v(" "),!1===t.valid?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning"},on:{click:t.verify}},[t._v("驗證")])],1):t._e(),t._v(" "),""!==t.errorMsg?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("以此統編繼續交易")])],1):t._e()],1):r("el-form",{ref:"inputForm",attrs:{"label-position":"left"}},[!0===t.valid?r("el-form-item",{attrs:{label:"統一編號"}},[t._v("\n        "+t._s(t.VAT_Number)+"\n      ")]):t._e(),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("確認")])],1)],1)],1)],1)},Da=[],Ia={name:"VATDialog",props:{dialogVisible:{type:Boolean,required:!1}},data:function(){return{VAT_Number:null,valid:!1,errorMsg:""}},computed:Object(n["a"])({},Object(i["b"])(["pos_tab"])),created:function(){},updated:function(){this.$nextTick((function(){this.dialogVisible&&this.$refs.ipt.focus()}))},methods:{verify:function(){this.valid=!0,this.errorMsg="";try{this.valid=Object($["h"])(this.VAT_Number),this.valid?this.submit():!1===this.valid&&(this.errorMsg="統一編號錯誤")}catch(t){this.errorMsg=t}},submit:function(){if(8===this.VAT_Number.toString().length)if("69568009"!==this.VAT_Number){switch(this.pos_tab){case"service":this.$store.dispatch("order/updateServuceOrderVATNumber",{VAT_Number:this.VAT_Number});break;default:this.$store.dispatch("order/updateSalesOrderVATNumber",{VAT_Number:this.VAT_Number});break}Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)}else this.$message({showClose:!0,message:"不可輸入總公司統編",type:"error"});else this.$message({showClose:!0,message:"統一編號需8碼",type:"error"})},beforeClose:function(){Object.assign(this.$data,this.$options.data()),this.$emit("update:dialogVisible",!1)},clear:function(){this.VAT_Number="",this.$refs.ipt.focus()}}},Pa=Ia,Oa=Object(q["a"])(Pa,Ca,Da,!1,null,null,null),xa=Oa.exports,ja=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("el-card",{staticClass:"box-card"},[""!==t.errorMsg?r("el-alert",{attrs:{title:t.errorMsg,type:"error",center:"","show-icon":""}}):t._e(),t._v(" "),r("el-form",{ref:"inputForm",attrs:{"label-position":"left"}},[r("el-form-item",{attrs:{label:"員工編號"}},[r("el-autocomplete",{ref:"ipt",staticClass:"inline-input",staticStyle:{width:"50%"},attrs:{"fetch-suggestions":t.querySearch,placeholder:"請輸入員工編號","trigger-on-focus":!1,inputmode:"numeric"},on:{select:t.handleSelect},model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}}),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.clear()}}},[t._v("清除")])],1),t._v(" "),""!==t.userName?r("el-form-item",{attrs:{label:"員工姓名"}},[r("span",[t._v(t._s(t.userName))])]):t._e(),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.submit}},[t._v("確認")])],1)],1)],1)],1)},Sa=[],Ta=r("c24f"),$a={name:"SalerDialog",props:{dialogVisible:{type:Boolean,required:!1}},data:function(){return{userId:"",userName:"",errorMsg:"",employeeList:[]}},computed:Object(n["a"])({},Object(i["b"])(["pos_tab"])),created:function(){var t=this;Object(Ta["f"])().then((function(e){t.employeeList=e}))},updated:function(){this.$nextTick((function(){this.dialogVisible&&this.$refs.ipt.focus()}))},methods:{submit:function(){var t=this;if(this.errorMsg="",this.employeeList.length>0){var e=this.employeeList.findIndex((function(e){return e.userId===t.userId}));if(e>=0){if("1"!==this.employeeList[e].validationFlag)return this.errorMsg="員工帳號失效",void Object.assign(this.$data,{userId:"",userName:""});var r={id:this.userId,name:this.employeeList[e].userName};switch(this.pos_tab){case"service":this.$store.dispatch("order/setServiceOrderSaler",{saler:r});break;default:this.$store.dispatch("order/setSalesOrderSaler",{saler:r});break}this.$emit("update:dialogVisible",!1)}else this.errorMsg="查無員工"}},beforeClose:function(){this.$emit("update:dialogVisible",!1)},clear:function(){Object.assign(this.$data,{userId:"",userName:"",errorMsg:""}),this.$refs.ipt.focus()},handleSelect:function(t){this.userId=t.userId,this.userName=t.userName},querySearch:function(t,e){var r=this.employeeList,a=t?r.filter(this.createFilter(t)):r;e(a)},createFilter:function(t){return function(e){return 0===e.userId.toLowerCase().indexOf(t.toLowerCase())&&(e.value="[".concat(e.userId,"]").concat(e.userName),!0)}}}},Aa=$a,Ma=Object(q["a"])(Aa,ja,Sa,!1,null,null,null),Fa=Ma.exports,Ea=r("f8b7"),La={inject:["reload"],components:{MemberDialog:R,CheckoutDrawer:Be,AddGoodsDrawer:er,Installment:mr,MenuDrawer:gr,PromotionDrawer:Dr,PosSplitPane:$r,TopPane:qr,LeftPane:na,RightPane:da,BottomPane:va,PromoteDialog:Na,VATDialog:xa,salerDialog:Fa,PaymentRefund:sr},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},props:{type:{type:String,default:"checkout"},serviceData:{type:Array,default:function(){return[]}}},data:function(){return{windowHeight:0,leftPaneSize:{height:0,deep:!0},pid:"",loading:!1,topPaneData:[],rightPaneData:[],bottomPaneData:[],ff_menu_products:{},ff_menu_key:"",promotionProducts:{},promotionInfo:{},typeFpromotionInfo:{},showPayOptionDialog:!1,showMemberDialog:!1,showPaymentRefundDialog:!1,promoteDialogVisible:!1,showCheckoutDrawer:!1,showAddGoodsDrawer:!1,checkoutLaunch:!1,showMenuDrawer:!1,showPromotionDrawer:!1,showVATDialog:!1,showSalerDialog:!1,showTranSoDialog:!1,ShopCart:null,productList:null,leftPercent:85,posType:1}},computed:Object(n["a"])({},Object(i["b"])(["termNo","pos_tab","serviceNo","serviceAmt"]),{},Object(i["c"])({salesProducts:function(t){return t.product.salesProducts},salesShopCart:function(t){return t.order.salesOrder},serviceProducts:function(t){return t.product.serviceProducts},serviceShopCart:function(t){return t.order.serviceOrder},memberInfo:function(t){return t.member},memberID:function(t){return t.member.CustNo},VAT_Number:function(t){return t.order.salesOrder.VAT_Number},systemInfo:function(t){return t.systemInfo},serialNo:function(t){return t.systemInfo.serialNo},payInfo:function(t){return t.payInfo},deliverNo:function(t){return t.order.salesOrder.deliverNo}})),watch:{showCheckoutDrawer:function(t){t||(this.showPromotionDrawer=!1)},windowHeight:function(t,e){console.log("it changed to ".concat(t," from ").concat(e))},VAT_Number:function(t){this.topPaneData.filter((function(e){return"統一編號"===e.name&&(e.label=t),!0}))},memberID:function(t){this.topPaneData.filter((function(e){return"會員"===e.name&&(e.label=t),!0})),this.$nextTick((function(){"FoodPanda"===this.pos_tab&&"2990779789962"===t&&(this.pid="215840",this.showAddGoodsDrawer=!0)}))},systemInfo:{handler:function(t,e){this.topPaneData.filter((function(e){"發票號碼"===e.name&&(e.label=t.invoice),"交易序號"===e.name&&(e.label=(Array(5).join("0")+1*t.serialNo).slice(-5))}))},deep:!0},payInfo:{handler:function(t){this.topPaneData.filter((function(e){if("分期"===e.name)return 1!==t.info.credit.installmentNumber?e.label=t.info.credit.installmentName.replace("商業銀行","").replace("銀行",""):e.label="不分期",!0}))},deep:!0},deliverNo:function(t){this.topPaneData.filter((function(e){return"配達單號"===e.name&&(e.label=t),!0}))},"salesShopCart.saler":{handler:function(t){this.topPaneData.filter((function(e){return"售貨員"===e.name&&(e.label=t.name),!0}))},deep:!0},"serviceShopCart.saler":{handler:function(t,e){"service"===this.pos_tab&&this.topPaneData.filter((function(e){return"售貨員"===e.name&&(e.label=t.name),!0}))},deep:!0},"salesShopCart.VAT_Number":{handler:function(t,e){"checkout"===this.pos_tab&&this.topPaneData.filter((function(e){return"統一編號"===e.name&&(e.label=t),!0}))},deep:!0},"serviceShopCart.VAT_Number":{handler:function(t,e){"service"===this.pos_tab&&this.topPaneData.filter((function(e){return"統一編號"===e.name&&(e.label=t),!0}))},deep:!0},pos_tab:function(t){switch(t){case"service":this.posType=2;break;default:this.posType=1;break}}},mounted:function(){var t=this;this.$nextTick((function(){t.setPaneSize(),"Y"===t.shopCart.isPaid&&t.shopCart.payment.ecPaymentAmt===t.shopCart.payment.subtotal&&t.toggleDrawer()}))},created:function(){1===this.posType?(this.shopCart=this.salesShopCart,this.productList=this.salesProducts):2===this.posType&&(this.shopCart=this.serviceShopCart,this.productList=this.serviceProducts),this.initData()},methods:{initData:function(){var t=this;if("checkout"===this.pos_tab?(this.topPaneData=[{disabled:!1,name:"交易序號",label:(Array(5).join("0")+1*this.systemInfo.serialNo).slice(-5),show:!0,event:null},{disabled:!1,name:"分期",label:"不分期",show:!0,event:function(){return t.openPayOption()}},{disabled:!1,name:"發票號碼",label:this.systemInfo.invoice,show:!0,event:null},{disabled:!1,name:"售貨員",label:"",show:!0,event:function(){return t.openSalerDialog()}},{disabled:!1,name:"統一編號",label:this.shopCart.VAT_Number,show:!0,event:function(){return t.openVATDialog()}},{disabled:!1,name:"會員",label:this.memberID,show:!0,event:function(){return t.openMemberLogin()}}],this.rightPaneData.push({name:"單品快速鍵",show:!0,event:function(){return t.showFFMenu("FFLink")},type:"primary"}),this.bottomPaneData=[{name:"小計",show:!0,event:function(){return t.toggleDrawer()},type:"primary"},{name:"取消交易",show:!0,event:function(){return t.cancelTrans()},type:"danger"}]):"agent"===this.pos_tab?(this.topPaneData=[{disabled:!1,name:"交易序號",label:(Array(5).join("0")+1*this.systemInfo.serialNo).slice(-5),show:!0,event:null},{disabled:!1,name:"分期",label:"不分期",show:!0,event:function(){return t.openPayOption()}},{disabled:!1,name:"發票號碼",label:this.systemInfo.invoice,show:!0,event:null},{disabled:!1,name:"售貨員",label:"",show:!0,event:function(){return t.openSalerDialog()}},{disabled:!1,name:"統一編號",label:this.shopCart.VAT_Number,show:!0,event:function(){return t.openVATDialog()}},{disabled:!1,name:"會員",label:this.memberID,show:!1,event:function(){return t.openMemberLogin()}}],this.bottomPaneData=[{name:"小計",show:!0,event:function(){return t.toggleDrawer()},type:"primary"},{name:"取消交易",show:!0,event:function(){return t.cancelTrans()},type:"danger"}]):"service"===this.pos_tab?(this.topPaneData=[{disabled:!1,name:"交易序號",label:(Array(5).join("0")+1*this.systemInfo.serialNo).slice(-5),show:!0,event:null},{disabled:!1,name:"維修單號",label:this.serviceNo,show:!0,event:null},{disabled:!1,name:"發票號碼",label:this.systemInfo.invoice,show:!0,event:null},{disabled:!1,name:"售貨員",label:"",show:!0,event:function(){return t.openSalerDialog()}},{disabled:!1,name:"統一編號",label:this.shopCart.VAT_Number,show:!0,event:function(){return t.openVATDialog()}},{disabled:!1,name:"會員",label:this.memberID,show:!0,event:function(){return t.openMemberLogin()}}],this.bottomPaneData=[{name:"小計",show:!0,event:function(){return t.toggleDrawer()},type:"primary"},{name:"取消交易",show:!0,event:function(){return t.reload()},type:"danger"}]):(this.topPaneData=[{disabled:!1,name:"配達單號",label:this.deliverNo,show:!0,event:null},{disabled:!1,name:"分期",label:"不分期",show:!0,event:function(){return t.openPayOption()}},{disabled:!1,name:"發票號碼",label:this.systemInfo.invoice,show:!0,event:null},{disabled:!1,name:"售貨員",label:"",show:!0,event:function(){return t.openSalerDialog()}},{disabled:!1,name:"統一編號",label:this.shopCart.VAT_Number,show:!0,event:function(){return t.openVATDialog()}},{disabled:!1,name:"會員",label:this.memberID,show:!0,event:function(){return t.openMemberLogin()}}],this.rightPaneData.push({name:"單品快速鍵",show:!0,event:function(){return t.showFFMenu("FFLink")},type:"primary"}),this.bottomPaneData=[{name:"小計",show:!0,event:function(){return t.toggleDrawer()},type:"primary"},{name:"取消交易",show:!0,event:function(){return t.reload()},type:"danger"}],""===this.deliverNo&&Object(Ea["a"])(this.termNo).then((function(e){t.$store.dispatch("order/updateSalesOrder",{deliverNo:e.deliverNo})}))),"service"!==this.pos_tab&&"agent"!==this.pos_tab)N().then((function(e){var r=[];e.menu.forEach((function(e){var a=[];e.items.forEach((function(t){a.push(Object.assign(new tt["b"],t))})),t.ff_menu_products[e.categoryNo]={products:a};var o={name:e.categoryName,show:!0,event:function(){return t.showFFMenu("".concat(e.categoryNo))},type:"primary"};r.push(o)})),t.rightPaneData=t.rightPaneData.concat(r);var a=[];e.link.forEach((function(e){e.items.forEach((function(t){var e=Object.assign(new tt["b"],t);a.push(e)})),t.ff_menu_products["FFLink"]={products:a}})),t.ff_menu_products["FFLink"]={products:a}})).catch((function(t){console.error(t)}));else{var e=[];this.serviceData.forEach((function(r){var a={name:r.pluName,show:!0,event:function(){return t.getProduct(r.pluNo)},type:"primary"};e.push(a)})),this.rightPaneData=this.rightPaneData.concat(e)}},handleEdit:function(t,e){console.log(t,e)},handleDelete:function(t,e){e.splice(t,1)},resize:function(){this.setPaneSize()},setPaneSize:function(){this.leftPaneSize.height=this.$refs.paneContainer.$refs.leftPane.clientHeight},openMemberLogin:function(){this.showMemberDialog=!0},openPayOption:function(){0===this.shopCart.items.length?this.showPayOptionDialog=!0:this.$message({showClose:!0,message:"變更分期設定需清除商品",type:"warning"})},openPromotion:function(){if(!this.memberInfo.status)return!1;var t=_e(this.memberInfo,this.shopCart.items),e=Object(Ie["e"])({MM_Type:"F",totalAmount:t},this.productList,this.shopCart.items);return this.promotionProducts=e.promotionProducts,this.typeFpromotionInfo=e.promotionInfo,"{}"!==JSON.stringify(this.typeFpromotionInfo)},clearPromotionOption:function(t,e){if(t)for(var r=0,a=Object.entries(this.promotionProducts);r<a.length;r++){var o=w(a[r],1),n=o[0];n===e?this.$delete(this.promotionProducts,n):n.substring(0,8)}},toggleDrawer:function(){var t=be(this.shopCart,this.memberInfo.status,this.pos_tab);t.result?(this.showPromotionDrawer=this.openPromotion(),this.showPromotionDrawer||(this.showCheckoutDrawer=!0),this.checkoutLaunch=!0):this.$message({showClose:!0,message:t.Msg,type:"warning"})},toggleGoodsDrawer:function(){"1"===this.salesShopCart.allowMoreItems?this.showAddGoodsDrawer=!this.showAddGoodsDrawer:this.$message({showClose:!0,message:"此配達結帳無法加購商品",type:"warning"})},addGoods:function(t,e,r){var a=this;"foodpanda"===this.memberInfo.memo&&(t.mm=[]),1===this.posType?!1!==this.payInfo.info.credit.Installment&&void 0!==this.payInfo.info.credit.Installment?Object(C["c"])(t.pluNo).then((function(o){var n="商品分期不符";o.filter((function(t){1*a.payInfo.data.installmentNumber===1*t.installmentNumber&&(n="")})),""!==n?a.$confirm("確定加入商品嗎?",n,{distinguishCancelAndClose:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then((function(){a.$store.dispatch("order/addGoodsToSales",{product:t,count:e,queueNo:r})})).catch((function(t){a.$message({type:"error",message:"取消商品輸入"})})):a.$store.dispatch("order/addGoodsToSales",{product:t,count:e,queueNo:r})})).catch((function(o){console.log(o),a.$store.dispatch("order/addGoodsToSales",{product:t,count:e,queueNo:r})})):this.$store.dispatch("order/addGoodsToSales",{product:t,count:e,queueNo:r}):2===this.posType&&(void 0!==this.payInfo.info.credit.installmentID?this.fetchProdIns(t.pluNo).then((function(){a.$store.dispatch("order/addGoodsToServiceOrder",{product:t,count:e,queueNo:r})})).catch((function(){a.$store.dispatch("order/addGoodsToServiceOrder",{product:t,count:e,queueNo:r})})):this.$store.dispatch("order/addGoodsToServiceOrder",{product:t,count:e,queueNo:r}));var o=ke(this.shopCart,_e(this.memberInfo,this.shopCart.items));""!==o.errorMsg&&(this.$message({type:o.errorType,message:o.errorMsg,showClose:!0}),this.clearProductAndPromotion(t.pluNo,r,""))},fetchProdIns:function(t){var e=this;return new Promise((function(r,a){Object(C["c"])(t).then((function(t){var a="商品分期不符";t.filter((function(t){1*e.payInfo.data.installmentNumber===1*t.installmentNumber&&(a="")})),""!==a?e.$confirm("確定加入商品嗎?",a,{distinguishCancelAndClose:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then((function(){r()})).catch((function(t){e.$message({type:"error",message:"取消商品輸入"})})):r()})).catch((function(t){a(t)}))}))},addPromote:function(t,e,r){this.$store.dispatch("order/addPromoteToSales",{promote:t,pids:e,queueNo:r})},clearProductAndPromotion:function(t,e,r){switch(this.posType){case 1:this.$store.dispatch("order/clearProductAndPromotionInSales",{pid:t,queueNo:e,mmType:r});break;case 2:this.$store.dispatch("order/clearProductAndPromotionInService",{pid:t,queueNo:e,mmType:r});break}},updatePayInfo:function(t){this.$store.dispatch("payInfo/updatePayInfo",{info:{credit:t}})},showFFMenu:function(t){this.showMenuDrawer=!0,this.ff_menu_key=t},clearPromoteTemp:function(){this.promotionProducts={},this.promotionInfo={}},promote:function(t,e){var r=this;if(this.promotionInfo={},void 0!==t.mm){var a,o=[];t.mm.forEach((function(e){switch(e.mmType.toUpperCase()){case"N":case"D":case"F":if(a=e.mmPlu.find((function(e){return e.pluNo===t.pluNo})),void 0!==a&&"M"!==e.mmPlu.find((function(e){return e.pluNo===t.pluNo})).mmGroupType)return}o.unshift(e)})),o.forEach((function(t){void 0===r.promotionInfo[t.promoteNo+e]&&"F"!==t.mmType&&(r.promotionInfo[t.promoteNo+e]=t)}))}this.promotionInfo.mainProduct=t.pluNo,this.promoteDialogVisible=!0,this.promotionInfo.queueNo=e},openVATDialog:function(){this.showVATDialog=!0},openSalerDialog:function(){this.showSalerDialog=!0},getProduct:function(t){var e=this;Object(C["a"])(t,"").then((function(r){null===r.data?(e.$message({type:"error",message:"商品代碼錯誤"}),e.productError="商品代碼錯誤"):("service"===e.pos_tab&&(r.pluName=r.pluName+"("+e.serviceNo+")",0!==e.serviceAmt&&""!==e.serviceAmt&&(r.price=e.serviceAmt,r.vipPrice=e.serviceAmt)),e.clearProductAndPromotion(t,1,""),e.addGoods(r,1,1))}))},updateSize:function(t){var e=this.$refs.paneContainer.$el.clientWidth,r=(e-(t+20))/e*100;this.leftPercent=r},cancelTrans:function(){var t=this;if(this.payInfo.data.length>0){var e=_t(this.payInfo.data);Promise.all(e).then((function(e){-1===e.indexOf(!1)?t.$message({showClose:!0,message:"退款處理完成",type:"success"}):t.$message({showClose:!0,message:"退款處理失敗",type:"error"}),t.showPaymentRefundDialog=!0,t.reload()}))}else this.reload()}}},qa=La,Va=(r("0405"),Object(q["a"])(qa,l,u,!1,null,"85ee96bc",null)),Ra=Va.exports,za=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[""===t.deliveryType?r("div",[r("TopPane",{attrs:{"pane-data":t.topPaneData}})],1):t._e(),t._v(" "),"getOrder"===t.deliveryType?r("div",[r("GetOrder")],1):t._e(),t._v(" "),"checkout"===t.deliveryType?r("div",[r("Checkout")],1):t._e()])},Ba=[],Ua=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-card",{staticClass:"box-card"},[r("el-form",{ref:"form",attrs:{"label-width":"80px"}},[r("el-form-item",{attrs:{label:"配達單號"}},[r("el-input",{model:{value:t.ordernum,callback:function(e){t.ordernum=e},expression:"ordernum"}})],1),t._v(" "),r("el-divider"),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("取回配達單")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.reload}},[t._v("清除")])],1)],1)],1)},Ga=[],Qa={inject:["reload"],name:"GetOrder",data:function(){return{activeName:"1",ordernum:"",showMemberDialog:!1}},computed:Object(n["a"])({},Object(i["b"])(["storeNo","opFuncSub"])),methods:{offline:function(t){var e={CustNo:t,CustName:"",EndDate:"",MobileNo:"",UnuseAmt:"",status:!0,level:"01"};this.$store.dispatch("member/memberUpdate",e)},onSubmit:function(){var t=this;""!==this.ordernum?this.storeNo===this.ordernum.substring(0,3)?Object(Ea["b"])(this.ordernum).then((function(e){""!==e.deliverNo?(t.$store.dispatch("order/updateSalesOrder",{deliverNo:e.header.deliverNo,items:e.data,isPaid:e.isPaid,allowMoreItems:e.allowMoreItems,payment:e.header.payment}),""!==e.header.customer.memberID&&null!==e.header.customer.memberID&&S(M.a.stringify({queryType:1,queryData:e.header.customer.memberID})).then((function(r){r.length>0?(t.cardList=r,t.status="online",1===t.cardList.length&&(t.cardList[0].isMember=!0,t.cardList[0].valid=!0,t.$store.dispatch("member/memberUpdate",t.cardList[0]),t.cardList=[])):t.offline(e.header.customer.memberID)})).catch((function(t){console.error(t)})),""!==e.header.payment.creditCard.bankNo&&null!==e.header.payment.creditCard.bankNo&&lt(e.header.payment.creditCard.bankNo).then((function(r){r.forEach((function(r){if(r.installmentID===e.header.payment.creditCard.installmentID){var a=new Y["a"];a.installmentID=r.installmentID,a.bankNo=r.bankID,a.bankName=r.bankName,a.installmentNumber=1*r.installmentNumber,a.installmentName=r.installmentName,t.$store.dispatch("payInfo/updatePayInfo",{info:{credit:a}})}}))})).catch((function(t){console.error(t)})),t.$store.dispatch("pos/setOpFuncSub","DLV_ACC"),t.$store.dispatch("pos/setDeliveryType","checkout")):alert("查無配達單")})):this.$message({showClose:!0,message:"店號不符",type:"warning"}):this.$message({showClose:!0,message:"請輸入配達單號",type:"warning"})}}},Ya=Qa,Ha=Object(q["a"])(Ya,Ua,Ga,!1,null,null,null),Wa=Ha.exports,Ja={inject:["reload"],components:{Checkout:Ra,TopPane:qr,GetOrder:Wa},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},props:{type:{type:String,default:"delivery"}},data:function(){return{loading:!1,toadydata:[]}},computed:Object(n["a"])({},Object(i["b"])(["deliveryType"])),watch:{windowHeight:function(t,e){console.log("it changed to ".concat(t," from ").concat(e))}},mounted:function(){},created:function(){this.initData()},methods:{initData:function(){var t=this;this.topPaneData=[{disabled:!1,name:"配達起單",label:"",show:!0,event:function(){t.$store.dispatch("pos/setDeliveryType","checkout")},labelVisible:!1},{disabled:!1,name:"配達結帳",label:"",show:!0,event:function(){t.$store.dispatch("pos/setDeliveryType","getOrder")},labelVisible:!1}]},chgDeliveryType:function(t){this.deliveryType=t},clear:function(){this.reload(),this.$store.dispatch("pos/setDeliveryType","")}}},Za=Ja,Xa=Object(q["a"])(Za,za,Ba,!1,null,null,null),Ka=Xa.exports,to=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"refundView"},[r("el-form",{ref:"refundForm",attrs:{model:t.refundForm,rules:t.refundRules}},[null===t.shopCart?r("el-form-item",{attrs:{label:"交易序號",prop:"serialNo"}},[r("el-input",{staticStyle:{width:"30%"},attrs:{inputmode:"numeric"},model:{value:t.refundForm.serialNo,callback:function(e){t.$set(t.refundForm,"serialNo",e)},expression:"refundForm.serialNo"}},[r("el-button",{attrs:{slot:"append",type:"danger"},on:{click:t.onClear},slot:"append"},[t._v("清除")])],1),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("取回購買紀錄")])],1):r("div",{staticClass:"refundTable"},[r("el-row",{staticClass:"refundRow",attrs:{gutter:2}},[r("el-col",{attrs:{xs:8,sm:8,lg:8}},[r("el-card",{staticClass:"box-card-component refundCard",style:"height:"+t.contentHeight+"px"},[r("div",[r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("交易序號")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t.shopCart.serialNo))])],1)],1),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("店號")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t.shopCart.storeNo))])],1)],1),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("機號")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t.shopCart.termNo))])],1)],1),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("交易日期")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t.shopCart.dateT))])],1)],1),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("擔當薪號")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t.shopCart.header.cashierNo))])],1)],1),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v("總金額")]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t._f("toCurrency")(t.shopCart.header.payment.subtotal)))])],1)],1),t._v(" "),r("el-divider"),t._v(" "),r("div",{staticStyle:{position:"relative"}},[r("div",{staticClass:"progress-item"},[r("span",[t._v("付款明細")])])]),t._v(" "),t._l(t.shopCart.getPaymentList(),(function(e){return r("div",{key:e.id,staticStyle:{position:"relative"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple"}),t._v(t._s(e.name))]),t._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"grid-content bg-purple-light"}),t._v(t._s(t._f("toCurrency")(e.amount)))])],1)],1)}))],2)])],1),t._v(" "),r("el-col",{attrs:{xs:16,sm:16,lg:16}},[r("orderTable",{attrs:{"cal-height":t.calHeight,height:t.contentHeight,"shop-cart":t.shopCart,"data-count":t.shopCart.data.length}})],1)],1),t._v(" "),r("el-row",{ref:"refundFooter",staticClass:"refundRow",attrs:{gutter:2}},[r("el-col",{attrs:{xs:24,sm:24,lg:24}},[r("el-card",[r("el-button",{staticStyle:{width:"49%"},attrs:{type:"primary"},on:{click:t.refund}},[t._v("退貨")]),t._v(" "),r("el-button",{staticStyle:{width:"49%"},attrs:{type:"danger"},on:{click:t.onClear}},[t._v("取消")])],1)],1)],1)],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"退貨原因",visible:t.showDialog,"before-close":function(){t.showDialog=!1},width:"50%"}},[r("el-card",{staticClass:"box-card"},t._l(t.reason,(function(e){return r("el-row",{key:e.installmentID,staticClass:"row-bg",attrs:{type:"flex"}},[r("el-col",{attrs:{span:24}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(r){return t.refundSubmit(e.reasonID)}}},[t._v(t._s(e.reasonName))])],1)],1)})),1)],1),t._v(" "),r("el-dialog",{attrs:{title:"店長權限驗證",visible:t.showConfirmDialog,"before-close":function(){t.showConfirmDialog=!1}},on:{"update:visible":function(e){t.showConfirmDialog=e}}},[r("div",[r("el-card",[r("el-form",{attrs:{"label-position":"left"},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}},[r("el-form-item",{attrs:{label:"店長帳號"}},[r("el-input",{staticStyle:{width:"75%"},attrs:{inputmode:"numeric",type:"number"},nativeOn:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}},model:{value:t.form.account,callback:function(e){t.$set(t.form,"account",e)},expression:"form.account"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"店長密碼"}},[r("el-input",{staticStyle:{width:"75%"},attrs:{inputmode:"numeric",type:"number"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.getPermission(e))}},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),t._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.getPermission}},[t._v("確認")])],1)],1)],1)],1)])],1)},eo=[],ro=(r("55dd"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-table",{ref:"eltable",attrs:{data:t.shopCart.data,border:!0,fit:!0,size:"medium",height:t.height}},[r("el-table-column",[r("el-table-column",{attrs:{type:"index",label:"No"}}),t._v(" "),r("el-table-column",{attrs:{prop:"pluNo",label:"貨號",width:"100%"}}),t._v(" "),r("el-table-column",{attrs:{prop:"name",label:"商品名稱"}}),t._v(" "),r("el-table-column",{attrs:{prop:"price.normalAmt",label:"單價",width:"110%",sortable:"",align:"right"}}),t._v(" "),r("el-table-column",{attrs:{prop:"quantity",label:"數量",sortable:"",width:"100%",align:"right"}}),t._v(" "),r("el-table-column",{attrs:{prop:"price.taxIncludeAmt",label:"金額",width:"100%",sortable:"",align:"right"}})],1)],1)],1)}),ao=[],oo={name:"OrderTable",props:{shopCart:{type:Object,default:function(){return{}}},dataCount:{type:Number,default:0},calHeight:{type:Function,default:function(){}},height:{type:Number,default:0}},computed:Object(i["c"])({memberInfo:function(t){return t.member}}),watch:{dataCount:function(){this.$refs.eltable.doLayout()}},mounted:function(){var t=this;this.$nextTick((function(){t.calHeight()}))},methods:{}},no=oo,io=Object(q["a"])(no,ro,ao,!1,null,null,null),so=io.exports,co=new Le["a"]("order","data"),lo={inject:["reload"],name:"Refund",components:{orderTable:so},data:function(){var t=function(t,e,r){""===e?r(new Error("請輸入正確交易序號")):r()};return{refundForm:{serialNo:""},shopCart:null,contentHeight:0,refundRules:{serialNo:[{required:!0,trigger:"blur",validator:t}]},showDialog:!1,showConfirmDialog:!1,reason:[],form:{account:"",password:""}}},computed:Object(n["a"])({},Object(i["c"])({user:function(t){return t.user}}),{},Object(i["b"])(["termNo","tab_size"])),mounted:function(){},methods:{onSubmit:function(){var t=this;this.refundForm.serialNo=(Array(5).join("0")+1*this.refundForm.serialNo).slice(-5),Object(Ea["c"])({termNo:this.termNo,serialNo:this.refundForm.serialNo}).then((function(e){1===e.status?(t.shopCart=new he(e.transactionData),t.shopCart.data=t.shopCart.data.sort((function(t,e){return t.detailID<e.detailID?-1:1})),t.reason=e.returnReasonList.filter((function(t){if("R"===t.reasonType)return!0}))):t.$message({showClose:!0,message:e.msg,type:"warning"})})).catch((function(t){console.error(t)}))},onClear:function(){this.$data.form=this.$options.data().form,this.refundForm.serialNo="",this.shopCart=null,this.showDialog=!1,this.reason=[],this.reload()},calHeight:function(){this.contentHeight=this.tab_size.height-this.$refs.refundFooter.$el.clientHeight-60},refund:function(){"StoreManager-token"===this.user.token?(this.showDialog=!0,this.form.account=this.user.userId):this.showConfirmDialog=!0},refundSubmit:function(t){var e=this,r=this.shopCart;this.shopCart.header.refundReasonNo=t,this.shopCart.header.bossNo=this.form.account;var a=r.getPaymentList(),o=_t(a);Promise.all(o).then((function(t){-1===t.indexOf(!1)&&(Object(Ea["e"])(e.shopCart).then((function(t){var e=a.filter((function(t){return"FBAmt"===t.id}));if(e.length>0){var o=new Y["h"];co.get(r.serialNo).then((function(t){o.CardNo=t.substring(4,12)})).catch((function(t){console.log(t),o.CardNo=r.header.customer.memberID})).finally((function(){o.OrdNo=r.serialNo,o.OrdDate=r.dateT,o.OrdAmt=r.header.receipt.receiptAmt,o.UseAmt=-1*e[0].amount,ut(o).then((function(t){console.log(JSON.stringify(t))}))}))}})).catch((function(t){console.log(t)})),e.onClear())}))},getPermission:function(){var t=this;new Promise((function(e,r){Object(Ta["a"])(M.a.stringify({userId:t.form.account,userPassword:t.form.password,termNo:t.termNo})).then((function(r){"1"===r.userinfo.userLevel?(t.showConfirmDialog=!1,t.showDialog=!0):Object(vt["Message"])({message:"薪號".concat(t.user.userId,"無店長權限")||!1,type:"error",duration:5e3}),e()})).catch((function(t){r(t)}))}))}}},uo=lo,po=(r("2aed"),Object(q["a"])(uo,to,eo,!1,null,"270bc2fa",null)),mo=po.exports,fo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[""===t.printType?r("div",[r("TopPane",{attrs:{"pane-data":t.topPaneData}})],1):t._e(),t._v(" "),"unpayreprint"===t.printType?r("div",[r("Reprint")],1):t._e()])},ho=[],bo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"搜尋配達單號"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.reload}},[t._v("返回")]),t._v(" "),r("el-table",{directives:[{name:"show",rawName:"v-show",value:0==t.orderdata.length,expression:"orderdata.length==0 "}],attrs:{data:t.tempArray?t.tempArray:t.todayData,border:!0,size:"medium"}},[r("el-table-column",{attrs:{label:""}},[r("el-table-column",{attrs:{type:"index",label:"No"}}),t._v(" "),r("el-table-column",{attrs:{label:"配達單號"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"primary"},nativeOn:{click:function(r){return r.preventDefault(),t.getDeliverData(e.row.data,e.row.header.deliverNo)}}},[t._v("\n            "+t._s(e.row.header.deliverNo)+"\n          ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"總金額"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(" "+t._s(t._f("toCurrency")(e.row.header.payment.subtotal))+" ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"成立時間"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(" "+t._s(t._f("toDate")(e.row.dateT))+" "+t._s(t._f("toTime")(e.row.timeT))+" ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"過期時間"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(" "+t._s(t._f("toDate")(e.row.expiryDate))+" ")])]}}])})],1)],1),t._v(" "),r("el-table",{directives:[{name:"show",rawName:"v-show",value:t.orderdata.length>0,expression:"orderdata.length>0 "}],attrs:{data:t.orderdata,border:!0,size:"medium"}},[r("el-table-column",{attrs:{label:""}},[r("el-table-column",{attrs:{type:"index",label:"No"}}),t._v(" "),r("el-table-column",{attrs:{prop:"pluNo",label:"貨號",width:"100%"}}),t._v(" "),r("el-table-column",{attrs:{prop:"name",label:"商品名稱"}}),t._v(" "),r("el-table-column",{attrs:{prop:"price.normalAmt",label:"單價",width:"110%",sortable:"",align:"right"}}),t._v(" "),r("el-table-column",{attrs:{prop:"quantity",label:"數量",sortable:"",width:"100%",align:"right"}}),t._v(" "),r("el-table-column",{attrs:{label:"金額",width:"100%",sortable:"",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("div",{staticClass:"text item"},[t._v("\n            "+t._s(t._f("toCurrency")(t.subTotal(e.row)))+"\n          ")])]}}])})],1)],1),t._v(" "),r("el-card",{directives:[{name:"show",rawName:"v-show",value:t.orderdata.length>0,expression:"orderdata.length>0"}],staticClass:"box-card"},[r("el-button",{attrs:{type:"primary"},on:{click:t.getReprint}},[t._v("重印配達單")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.clearOrderData}},[t._v("取消")])],1)],1)},vo=[],yo={inject:["reload"],name:"GetTodaySo",data:function(){return{activeName:"1",ordernum:"",search:"",orderdata:[],tempArray:void 0,tblHeight:"650px",showMemberDialog:!1,todayData:[]}},watch:{search:{handler:function(t,e){this.querySearch(t)},deep:!0}},created:function(){this.getTodayData()},methods:{onSubmit:function(){},getDeliverData:function(t,e){this.orderdata=t,this.ordernum=e},subTotal:function(t){return t.price.normalAmt*t.quantity},clearOrderData:function(t,e){this.orderdata=[],this.ordernum=e},getReprint:function(t){var e=this,r=this.ordernum;return new Promise((function(t,a){Object(Pe["f"])(r,2,{}).then((function(t){alert("列印成功"),e.reload()})).catch((function(t){e.$message({type:"error",message:t.message,closable:"true"}),a(t.message)})).finally((function(){e.orderdata=[],e.ordernum=""}))}))},querySearch:function(t){var e=this.todayData,r=t?e.filter(this.createFilter(t)):e;this.tempArray=r},createFilter:function(t){return function(e){return 0===e.header.deliverNo.toLowerCase().indexOf(t.toLowerCase())}},getTodayData:function(){var t=this;Object(Pe["e"])().then((function(e){null===e?alert("今日無資料"):(t.todayData=e,console.log(e))}))}}},go=yo,wo=Object(q["a"])(go,bo,vo,!1,null,null,null),_o=wo.exports,ko={inject:["reload"],components:{TopPane:qr,Reprint:_o},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},props:{type:{type:String,default:"delivery"}},data:function(){return{loading:!1}},computed:Object(n["a"])({},Object(i["b"])(["printType"])),watch:{windowHeight:function(t,e){console.log("it changed to ".concat(t," from ").concat(e))}},mounted:function(){},created:function(){this.initData()},methods:{initData:function(){var t=this;this.topPaneData=[{disabled:!1,name:"重印未結單據",label:"",show:!0,event:function(){t.$store.dispatch("print/setPrintType","unpayreprint")},labelVisible:!1}]},clear:function(){this.reload(),this.$store.dispatch("print/setPrintType","")}}},No=ko,Co=Object(q["a"])(No,fo,ho,!1,null,null,null),Do=Co.exports,Io=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[""===t.serviceType&&""===t.serviceNo?r("div",[r("TopPane",{attrs:{"pane-data":t.topPaneData}})],1):t._e(),t._v(" "),"checkout"===t.serviceType?r("div",[r("Checkout",{on:{update:t.selfUpdate}})],1):t._e(),t._v(" "),""!==t.serviceNo?r("div",[r("Poscheckout",{attrs:{"service-data":t.servicedata}})],1):t._e()])},Po=[],Oo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-card",{directives:[{name:"show",rawName:"v-show",value:0==t.orderdata.length,expression:"orderdata.length==0"}],staticClass:"box-card"},[r("el-form",{attrs:{"label-width":"100px"}},[r("el-form-item",{attrs:{label:"維修單號"}},[r("el-input",{attrs:{type:"number"},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}})],1),t._v(" "),r("el-divider"),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.checkServiceNo}},[t._v("查詢")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.onSubmit}},[t._v("返回")])],1)],1),t._v(" "),r("FixOrderDialog",{attrs:{"dialog-visible":t.showFixOrderDialog,inputdata:t.input},on:{"update:dialogVisible":function(e){t.showFixOrderDialog=e},"update:dialog-visible":function(e){t.showFixOrderDialog=e}}})],1)},xo=[],jo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"維修單號確認",visible:t.dialogVisible,"before-close":t.beforeClose,"show-close":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[r("div",[r("span",{staticStyle:{color:"#FFFFFF","font-size":"30px"}},[t._v("單號是否正確("+t._s(t.inputdata)+")")]),t._v(" "),r("el-row",{staticStyle:{overflow:"auto"}},[r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success",size:"large"},on:{click:function(e){return t.submit()}}},[t._v("確認送出")])],1),t._v(" "),r("el-col",{attrs:{shadow:"never",span:12,"body-style":"{ padding: '0px' }"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"warning",size:"large"},on:{click:function(e){return t.beforeClose()}}},[t._v("取消")])],1)],1)],1)])},So=[],To={inject:["reload"],name:"FixOrderDialog",props:{dialogVisible:{type:Boolean,required:!1},inputdata:{type:String,default:function(){return 0}}},data:function(){return{}},computed:Object(n["a"])({},Object(i["b"])(["serviceNo"])),created:function(){},methods:{submit:function(){this.$store.dispatch("service/setServiceNo",this.inputdata),this.$store.dispatch("service/setServiceType","")},beforeClose:function(){this.$emit("update:dialogVisible",!1),this.reload()}}},$o=To,Ao=Object(q["a"])($o,jo,So,!1,null,null,null),Mo=Ao.exports,Fo={inject:["reload"],name:"CheckoutService",components:{FixOrderDialog:Mo},props:{},data:function(){return{activeName:"1",ordernum:"",input:"",orderdata:[],tempArray:void 0,showFixOrderDialog:!1,servicedata:[]}},computed:Object(n["a"])({},Object(i["b"])(["serviceNo"])),watch:{search:{handler:function(t,e){this.querySearch(t)},deep:!0}},methods:{onSubmit:function(){this.$store.dispatch("service/setServiceType","")},clearOrderData:function(t,e){this.orderdata=[],this.ordernum=e},checkServiceNo:function(t){var e=this;if(13===this.input.length)return new Promise((function(t,r){Object(Pe["b"])(e.input).then((function(t){null===t.repairNo?e.showFixOrderDialog=!0:(e.$store.dispatch("service/setServiceNo",e.input),e.$store.dispatch("service/setServiceAmt",t.amt),e.$store.dispatch("service/setServiceType","")),e.servicedata=t.types,e.$emit("update",e.servicedata)})).catch((function(t){e.$message({type:"error",message:t.message,closable:"true"}),r(t.message)})).finally((function(){e.orderdata=[],e.ordernum=""}))}));this.$message({type:"error",message:"維修單號須為13碼",closable:"true"})}}},Eo=Fo,Lo=Object(q["a"])(Eo,Oo,xo,!1,null,null,null),qo=Lo.exports,Vo={inject:["reload"],components:{TopPane:qr,Checkout:qo,Poscheckout:Ra},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},props:{type:{type:String,default:"delivery"}},data:function(){return{loading:!1,servicedata:[]}},computed:Object(n["a"])({},Object(i["b"])(["serviceType","serviceNo"])),watch:{windowHeight:function(t,e){console.log("it changed to ".concat(t," from ").concat(e))}},mounted:function(){},created:function(){this.initData()},methods:{initData:function(){var t=this;this.topPaneData=[{disabled:!1,name:"維修結帳",label:"",show:!0,event:function(){t.$store.dispatch("service/setServiceType","checkout")},labelVisible:!1}]},clear:function(){this.reload(),this.$store.dispatch("service/setServiceType","")},selfUpdate:function(t){this.servicedata=t}}},Ro=Vo,zo=Object(q["a"])(Ro,Io,Po,!1,null,null,null),Bo=zo.exports,Uo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[""===t.agentType&&""===t.agentInfo?r("div",[r("TopPane",{attrs:{"pane-data":t.topPaneData}})],1):t._e(),t._v(" "),"checkout"===t.agentType?r("div",[r("Checkout")],1):t._e(),t._v(" "),""!==t.agentInfo?r("div",[r("Poscheckout")],1):t._e()])},Go=[],Qo=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-card",{staticClass:"box-card"},[r("el-form",{attrs:{"label-width":"100px"}},[r("el-form-item",{attrs:{label:"代收條碼"}},[r("br"),t._v("\n        第一段條碼"),r("el-input",{ref:"codeInput",nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.focuson2(e))}},model:{value:t.input1,callback:function(e){t.input1=e},expression:"input1"}}),t._v("\n        第二段條碼"),r("el-input",{ref:"codeInput2",nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.focuson3(e))}},model:{value:t.input2,callback:function(e){t.input2=e},expression:"input2"}}),t._v("\n        第三段條碼"),r("el-input",{ref:"codeInput3",nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.checkBarcode(e))}},model:{value:t.input3,callback:function(e){t.input3=e},expression:"input3"}})],1),t._v(" "),r("el-divider"),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.checkBarcode}},[t._v("查詢")]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.onSubmit}},[t._v("返回")])],1)],1)],1)},Yo=[];function Ho(t,e,r){return Object(_["a"])({baseURL:Object(k["a"])(),url:"/mPOS/collect?bar1=".concat(t,"&bar2=").concat(e,"&bar3=").concat(r),method:"get"})}var Wo={inject:["reload"],name:"CheckoutService",components:{},props:{},data:function(){return{ordernum:"",input1:"",input2:"",input3:"",agentData:[]}},computed:Object(n["a"])({},Object(i["b"])(["agentInfo","opFuncSub"])),watch:{},created:function(){var t=this;this.$nextTick((function(){t.$refs.codeInput.focus()}))},methods:{onSubmit:function(){this.$store.dispatch("agent/setAgentType","")},focuson2:function(){var t=this;this.$nextTick((function(){t.$refs.codeInput2.focus()}))},focuson3:function(){var t=this;this.$nextTick((function(){t.$refs.codeInput3.focus()}))},checkBarcode:function(t){var e=this;if(""!==this.input1&&""!==this.input2&&""!==this.input3)return new Promise((function(t,r){Ho(e.input1,e.input2,e.input3).then((function(t){if(null!==t){var r=Object.assign({},t,{warranty:[],vipPrice:t.price,regulation:[]});e.agentData={barcode1:e.input1,barcode2:e.input2,barcode3:e.input3,allowCreditCard:t.allowCreditCard,allowCoupon:t.allowCoupon,receiptCopies:t.receiptCopies,receiptRemark:t.receiptRemark},e.$store.dispatch("agent/setAgentInfo",e.agentData),e.$store.dispatch("pos/setOpFuncSub","DYOI_ALL"),e.$store.dispatch("order/addGoodsToSales",{product:r,count:1,queueNo:""}),e.$store.dispatch("agent/setAgentType","")}})).catch((function(t){r(t.message)})).finally((function(){}))}));this.$message({type:"error",message:"條碼不得為空",closable:"true"})}}},Jo=Wo,Zo=Object(q["a"])(Jo,Qo,Yo,!1,null,null,null),Xo=Zo.exports,Ko={inject:["reload"],components:{TopPane:qr,Checkout:Xo,Poscheckout:Ra},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},props:{type:{type:String,default:"agent"}},data:function(){return{loading:!1,servicedata:[]}},computed:Object(n["a"])({},Object(i["b"])(["agentType","agentInfo"])),watch:{windowHeight:function(t,e){console.log("it changed to ".concat(t," from ").concat(e))}},mounted:function(){},created:function(){this.initData()},methods:{initData:function(){var t=this;this.topPaneData=[{disabled:!1,name:"APPLE  CARE",label:"",show:!0,event:function(){t.$store.dispatch("agent/setAgentType","checkout")},labelVisible:!1}]},clear:function(){this.reload(),this.$store.dispatch("agent/setAgentType","")}}},tn=Ko,en=Object(q["a"])(tn,Uo,Go,!1,null,null,null),rn=en.exports,an={inject:["reload"],name:"Tabs",components:{CheckoutContent:Ra,Delivery:Ka,Refund:mo,Print:Do,Service:Bo,Agent:rn},data:function(){return{tabMapOptions:[{label:"銷貨",key:"checkout",content:"CheckoutContent"},{label:"配達",key:"delivery",content:"Delivery"},{label:"FoodPanda",key:"FoodPanda",content:"CheckoutContent"},{label:"維修",key:"service",content:"Service"},{label:"代收",key:"agent",content:"Agent"},{label:"退貨",key:"return",content:"Refund"},{label:"列印",key:"print",content:"Print"}],createdTimes:0}},computed:Object(n["a"])({},Object(i["b"])(["tab_size","termNo"]),{pos_tab:{get:function(){return this.$store.state.pos.tab},set:function(t){var e=this;this.pos_tab!==t&&("FoodPanda"===t?(this.reload(),F.Login("77978996")):("FoodPanda"===this.pos_tab||"agent"===this.pos_tab)&&this.reload(),this.$store.dispatch("pos/SET_TAB",t),Object(Ea["d"])(this.termNo).then((function(t){e.$store.dispatch("systemInfo/setSystemInfo",{serialNo:1*t.serialNo+1})})))}}}),destroyed:function(){this.$destroy()}},on=an,nn=(r("7def"),Object(q["a"])(on,s,c,!1,null,"f3c164e4",null)),sn=nn.exports,cn={name:"Checkout",components:{Tabs:sn},data:function(){return{}},computed:Object(n["a"])({},Object(i["c"])({systemInfo:function(t){return t.systemInfo}})),created:function(){},mounted:function(){if(""!==this.systemInfo.invoice){var t=this.$refs.Tabs.$parent.$parent.$el.clientHeight;this.$store.dispatch("tabLayout/changeSize",{height:t,weight:0})}else this.$router.push("/dashboard")},methods:{}},ln=cn,un=Object(q["a"])(ln,a,o,!1,null,null,null);e["default"]=un.exports},de35:function(t,e,r){t.exports=r.p+"static/img/4.ed095862.jpeg"},de40:function(t,e,r){},df52:function(t,e,r){t.exports=r.p+"static/img/25.5b2a3e29.jpeg"},e4ab:function(t,e,r){"use strict";r("fc07")},eaf7:function(t,e,r){t.exports=r.p+"static/img/1.dd976805.jpeg"},efa8:function(t,e,r){t.exports=r.p+"static/img/10.a0c83af5.jpeg"},f04b:function(t,e,r){t.exports=r.p+"static/img/12.83d3b0df.jpeg"},f67c:function(t,e,r){t.exports=r.p+"static/img/8.1389dd96.jpeg"},f70b:function(t,e,r){t.exports=r.p+"static/img/14.17c283b1.jpeg"},fc07:function(t,e,r){},fea4:function(t,e,r){},ffc1:function(t,e,r){var a=r("5ca1"),o=r("504c")(!0);a(a.S,"Object",{entries:function(t){return o(t)}})}}]);